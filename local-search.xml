<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£RocketMQå¦‚ä½•è§£å†³æ¶ˆæ¯å †ç§¯é—®é¢˜</title>
    <link href="/2025/06/24/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3RocketMQ%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E5%A0%86%E7%A7%AF%E9%97%AE%E9%A2%98/"/>
    <url>/2025/06/24/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3RocketMQ%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E5%A0%86%E7%A7%AF%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>å…ˆå‰æˆ‘ä»¬è®²è¿‡äº†RocketMQæ˜¯å¦‚ä½•è§£å†³é¡ºåºæ¶ˆæ¯é—®é¢˜çš„ï¼Œä»Šå¤©æˆ‘ä»¬è®²ä¸€ä¸‹RocketMQæ˜¯å¦‚ä½•è§£å†³æ¶ˆæ¯å †ç§¯é—®é¢˜çš„ã€‚æ¯ç§MQè§£å†³æ¶ˆæ¯å †ç§¯é—®é¢˜çš„ç­–ç•¥å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œä½†å‘ç”Ÿæ¶ˆæ¯å †ç§¯é—®é¢˜çš„åŸå› å¤§è‡´ä¸€æ ·ï¼Œå³ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿç‡ä¸æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿç‡ä¸åŒ¹é…ï¼Œå¯¼è‡´æ¶ˆæ¯å¤§é‡å †ç§¯åœ¨é˜Ÿåˆ—ä¸­ã€‚</p><h1 id="è°ƒæ•´æ¶ˆè´¹è€…çº¿ç¨‹æ± å¤§å°ğŸ¤“"><a href="#è°ƒæ•´æ¶ˆè´¹è€…çº¿ç¨‹æ± å¤§å°ğŸ¤“" class="headerlink" title="è°ƒæ•´æ¶ˆè´¹è€…çº¿ç¨‹æ± å¤§å°ğŸ¤“"></a>è°ƒæ•´æ¶ˆè´¹è€…çº¿ç¨‹æ± å¤§å°ğŸ¤“</h1><p>é€šè¿‡å¢åŠ æ¶ˆè´¹è€…çš„å¹¶å‘åº¦ï¼Œå¯ä»¥åŠ å¿«æ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚è¿™å¯ä»¥é€šè¿‡ä¿®æ”¹æ¶ˆè´¹è€…é…ç½®ä¸­çš„çº¿ç¨‹æ± å¤§å°å‚æ•°å®ç°ï¼Œé€šè¿‡<strong>å¢åŠ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°</strong>ï¼Œå¯ä»¥è®©æ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†æ›´å¤šçš„æ¶ˆæ¯ï¼Œä»è€ŒåŠ å¿«æ•´ä½“çš„æ¶ˆè´¹é€Ÿåº¦ã€‚</p><p>RocketMQ çš„ Java å®¢æˆ·ç«¯ä¸­ï¼Œä½¿ç”¨ <code>MessageListenerConcurrently</code> æ¥å£ç›‘å¬æ¶ˆæ¯ï¼Œå…¶åº•å±‚æ˜¯çº¿ç¨‹æ± é©±åŠ¨çš„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® <code>consumeThreadMin</code> å’Œ <code>consumeThreadMax</code> æ¥æ§åˆ¶çº¿ç¨‹æ± çš„æœ€å°å’Œæœ€å¤§çº¿ç¨‹æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ¶ˆè´¹è€…å®ä¾‹ï¼Œå¹¶æŒ‡å®šæ¶ˆè´¹è€…ç»„å</span><br>        <span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">&quot;example_consumer_group&quot;</span>);<br><br>        <span class="hljs-comment">// è®¾ç½® NameServer åœ°å€</span><br>        consumer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br><br>        <span class="hljs-comment">// è®¾ç½®çº¿ç¨‹æ± å‚æ•°ï¼šæœ€å°çº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°</span><br>        consumer.setConsumeThreadMin(<span class="hljs-number">20</span>);  <span class="hljs-comment">// é»˜è®¤æ˜¯ 10</span><br>        consumer.setConsumeThreadMax(<span class="hljs-number">64</span>);  <span class="hljs-comment">// é»˜è®¤æ˜¯ 64</span><br><br>        <span class="hljs-comment">// è®¢é˜… Topic å’Œ Tagï¼ˆ* è¡¨ç¤ºè®¢é˜…æ‰€æœ‰ Tagï¼‰</span><br>        consumer.subscribe(<span class="hljs-string">&quot;TestTopic&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);<br><br>        <span class="hljs-comment">// æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨</span><br>        consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> &#123;<br>                <span class="hljs-keyword">for</span> (MessageExt msg : msgs) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody()));<br>                    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†è€—æ—¶</span><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// å‡è®¾æ¯æ¡æ¶ˆæ¯å¤„ç†éœ€è¦ 100ms</span><br>                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                        e.printStackTrace();<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-comment">// å¯åŠ¨æ¶ˆè´¹è€…</span><br>        consumer.start();<br><br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…å·²å¯åŠ¨&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>å¦‚æœä½ çš„æ¶ˆæ¯å¤„ç†é€»è¾‘æ¯”è¾ƒè½»é‡ï¼ˆå¦‚åªæ˜¯è®°å½•æ—¥å¿—ï¼‰ï¼Œå¯ä»¥ä¿æŒé»˜è®¤ã€‚</li><li>å¦‚æœæ¶ˆæ¯å¤„ç†æ¯”è¾ƒé‡ï¼ˆæ¯”å¦‚æ¶‰åŠæ•°æ®åº“æ“ä½œã€è¿œç¨‹è°ƒç”¨ç­‰ï¼‰ï¼Œåˆ™åº”è¯¥é€‚å½“<strong>å¢å¤§çº¿ç¨‹æ± </strong>ã€‚</li><li>æ³¨æ„ä¸è¦è¶…è¿‡ç³»ç»Ÿèµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œå¸¦å®½ç­‰ï¼‰ï¼Œå¦åˆ™å¯èƒ½å¼•å‘èµ„æºç«äº‰æˆ–OOMé—®é¢˜ã€‚</li></ul><h1 id="å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ğŸ˜¶â€ğŸŒ«ï¸"><a href="#å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ğŸ˜¶â€ğŸŒ«ï¸" class="headerlink" title="å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ğŸ˜¶â€ğŸŒ«ï¸"></a>å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ğŸ˜¶â€ğŸŒ«ï¸</h1><p>æ—¢ç„¶ç”Ÿäº§è€…ç”Ÿäº§é€Ÿç‡è¿‡å¿«ï¼Œé‚£æˆ‘ä»¬å°±æé«˜æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿç‡ï¼Œæ¥åŒ¹é…ç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿç‡ã€‚è¿™ä¸ªé€šå¸¸æ˜¯è§£å†³æ¶ˆæ¯å †ç§¯æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ°´å¹³æ‰©å±•å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ï¼Œå¤§ç™½è¯æ¥è¯´å°±æ˜¯åŠ æœºå™¨ã€‚</p><p>å¢åŠ æ¶ˆè´¹è€…å®ä¾‹çš„æ•°é‡ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¹¶è¡Œå¤„ç†æ›´å¤šçš„æ¶ˆæ¯ã€‚ç¡®ä¿æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ä¸‹çš„æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ä¸è¶…è¿‡ä¸»é¢˜ï¼ˆTopicï¼‰çš„<strong>é˜Ÿåˆ—æ•°é‡</strong>ï¼Œä»¥é¿å…èµ„æºæµªè´¹ã€‚</p><h1 id="æ£€æŸ¥æ¶ˆè´¹ç«¯æ¶ˆè´¹é€»è¾‘ğŸ˜£"><a href="#æ£€æŸ¥æ¶ˆè´¹ç«¯æ¶ˆè´¹é€»è¾‘ğŸ˜£" class="headerlink" title="æ£€æŸ¥æ¶ˆè´¹ç«¯æ¶ˆè´¹é€»è¾‘ğŸ˜£"></a>æ£€æŸ¥æ¶ˆè´¹ç«¯æ¶ˆè´¹é€»è¾‘ğŸ˜£</h1><p>å‡å¦‚çº¿ä¸Šæ£€æµ‹åˆ°æ¶ˆè´¹è€…ç«¯æ¶ˆè´¹é€Ÿç‡è¿‡æ…¢ï¼Œç¬¬ä¸€æ—¶é—´ä¸åº”è¯¥æƒ³åˆ°å»åŠ æœºå™¨ï¼Œè€Œæ˜¯åº”è¯¥å…ˆå»æƒ³åˆ°æ˜¯ä¸æ˜¯æ¶ˆè´¹è€…æ¶ˆè´¹å‡ºé”™äº†ï¼Œå¯¼è‡´è¿‡å¤šçš„æ¶ˆæ¯é‡è¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderConsumer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ¶ˆè´¹è€…å®ä¾‹ï¼Œå¹¶æŒ‡å®šæ¶ˆè´¹è€…ç»„å</span><br>        <span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">&quot;order_consumer_group&quot;</span>);<br><br>        <span class="hljs-comment">// è®¾ç½® NameServer åœ°å€</span><br>        consumer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br><br>        <span class="hljs-comment">// è®¢é˜… Topic å’Œ Tagï¼ˆ* è¡¨ç¤ºè®¢é˜…æ‰€æœ‰ Tagï¼‰</span><br>        consumer.subscribe(<span class="hljs-string">&quot;OrderTopic&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);<br><br>        <span class="hljs-comment">// æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨</span><br>        consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> &#123;<br>                <span class="hljs-keyword">for</span> (MessageExt msg : msgs) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†é€»è¾‘</span><br>                        processOrder(msg);<br>                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                        <span class="hljs-comment">// å¦‚æœå¤„ç†å¤±è´¥ï¼Œè¿”å› CONSUME_SUCCESS ä¼šå¯¼è‡´æ¶ˆæ¯è¢«ä¸¢å¼ƒ</span><br>                        <span class="hljs-comment">// åº”è¯¥è¿”å› RECONSUME_LATER è®©æ¶ˆæ¯ç¨åé‡è¯•</span><br>                        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-comment">// å¯åŠ¨æ¶ˆè´¹è€…</span><br>        consumer.start();<br><br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…å·²å¯åŠ¨&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(MessageExt msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿå¤æ‚çš„ä¸šåŠ¡å¤„ç†é€»è¾‘</span><br>        Thread.sleep(<span class="hljs-number">500</span>);  <span class="hljs-comment">// å‡è®¾æ¯æ¡æ¶ˆæ¯å¤„ç†éœ€è¦ 500ms</span><br>        <span class="hljs-keyword">if</span> (Math.random() &lt; <span class="hljs-number">0.1</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;æ¨¡æ‹Ÿå¤„ç†å¤±è´¥&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¼‚å¸¸å¤„ç†ä¸å½“"><a href="#å¼‚å¸¸å¤„ç†ä¸å½“" class="headerlink" title="å¼‚å¸¸å¤„ç†ä¸å½“"></a><strong>å¼‚å¸¸å¤„ç†ä¸å½“</strong></h2><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœ <code>processOrder</code> æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œå½“å‰å®ç°ä¼šç›´æ¥è¿”å› <code>RECONSUME_LATER</code>ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸æ–­é‡è¯•ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™å’Œèµ„æºæµªè´¹ã€‚</p><p><strong>æ”¹è¿›æ–¹æ³•ï¼š</strong></p><ul><li>æ·»åŠ é‡è¯•æ¬¡æ•°é™åˆ¶ï¼Œé¿å…æ— é™é‡è¯•ã€‚</li><li>å°†é¢‘ç¹å¤±è´¥çš„æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œåç»­å¤„ç†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> &#123;<br>        <span class="hljs-keyword">for</span> (MessageExt msg : msgs) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">reconsumeTimes</span> <span class="hljs-operator">=</span> msg.getReconsumeTimes();<br>            <span class="hljs-keyword">if</span> (reconsumeTimes &gt;= <span class="hljs-number">3</span>) &#123;  <span class="hljs-comment">// é‡è¯•è¶…è¿‡3æ¬¡ï¼Œæ”¾å…¥æ­»ä¿¡é˜Ÿåˆ—</span><br>                System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯é‡è¯•è¶…è¿‡3æ¬¡ï¼Œæ”¾å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody()));<br>                <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br>                processOrder(msg);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œå°†ç¨åé‡è¯•ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody()));<br>                <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="ä¸šåŠ¡å¤„ç†è€—æ—¶è¿‡é•¿"><a href="#ä¸šåŠ¡å¤„ç†è€—æ—¶è¿‡é•¿" class="headerlink" title="ä¸šåŠ¡å¤„ç†è€—æ—¶è¿‡é•¿"></a><strong>ä¸šåŠ¡å¤„ç†è€—æ—¶è¿‡é•¿</strong></h2><p>å¦‚æœ <code>processOrder</code> æ–¹æ³•ä¸­çš„ä¸šåŠ¡å¤„ç†é€»è¾‘éå¸¸è€—æ—¶ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è€…æ— æ³•åŠæ—¶å¤„ç†æ–°çš„æ¶ˆæ¯ï¼Œä»è€Œé€ æˆæ¶ˆæ¯å †ç§¯ã€‚</p><p><strong>æ”¹è¿›æ–¹æ³•ï¼š</strong></p><ul><li>ä¼˜åŒ–ä¸šåŠ¡å¤„ç†é€»è¾‘ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’ŒIOæ“ä½œã€‚</li><li>ä½¿ç”¨å¼‚æ­¥å¤„ç†æ–¹å¼ï¼Œå°†è€—æ—¶æ“ä½œæ”¾åˆ°å•ç‹¬çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrderAsync</span><span class="hljs-params">(MessageExt msg)</span> &#123;<br>    executor.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            processOrder(msg);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;å¼‚æ­¥å¤„ç†å¤±è´¥ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody()));<br>        &#125;<br>    &#125;);<br>&#125;<br><br>consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> &#123;<br>        <span class="hljs-keyword">for</span> (MessageExt msg : msgs) &#123;<br>            processOrderAsync(msg);<br>        &#125;<br>        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="æ‰¹é‡æ¶ˆè´¹ğŸ¥±"><a href="#æ‰¹é‡æ¶ˆè´¹ğŸ¥±" class="headerlink" title="æ‰¹é‡æ¶ˆè´¹ğŸ¥±"></a>æ‰¹é‡æ¶ˆè´¹ğŸ¥±</h1><p><strong>æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</strong> æ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„ä¼˜åŒ–æ‰‹æ®µï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ¶ˆæ¯å †ç§¯çš„åœºæ™¯ã€‚é€šè¿‡æ‰¹é‡æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨ä¸€æ¬¡æ‹‰å–ä¸­è·å–å¤šæ¡æ¶ˆæ¯ï¼Œå¹¶ä»¥æ‰¹æ¬¡ä¸ºå•ä½è¿›è¡Œå¤„ç†ï¼Œä»è€Œå‡å°‘ç½‘ç»œå¼€é”€å’Œæé«˜æ•´ä½“ååé‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchConsumerExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MQClientException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ¶ˆè´¹è€…å®ä¾‹ï¼Œå¹¶æŒ‡å®šæ¶ˆè´¹è€…ç»„å</span><br>        <span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">&quot;order_consumer_group&quot;</span>);<br><br>        <span class="hljs-comment">// è®¾ç½® NameServer åœ°å€</span><br>        consumer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br><br>        <span class="hljs-comment">// è®¾ç½®æ¯æ¬¡æœ€å¤šæ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡ï¼ˆé»˜è®¤æ˜¯ 1ï¼‰</span><br>        consumer.setConsumeMessageBatchMaxSize(<span class="hljs-number">10</span>);<br><br>        <span class="hljs-comment">// è®¢é˜… Topic å’Œ Tagï¼ˆ* è¡¨ç¤ºè®¢é˜…æ‰€æœ‰ Tagï¼‰</span><br>        consumer.subscribe(<span class="hljs-string">&quot;OrderTopic&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);<br><br>        <span class="hljs-comment">// æ³¨å†Œç›‘å¬å™¨</span><br>        consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;å¼€å§‹æ¶ˆè´¹ä¸€æ‰¹æ¶ˆæ¯ï¼Œå…± &quot;</span> + msgs.size() + <span class="hljs-string">&quot; æ¡&quot;</span>);<br><br>                <span class="hljs-keyword">for</span> (MessageExt msg : msgs) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;æ”¶åˆ°è®¢å•æ¶ˆæ¯ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody()));<br>                    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘å¤„ç†</span><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        Thread.sleep(<span class="hljs-number">5</span>);  <span class="hljs-comment">// å‡è®¾æ¯æ¡æ¶ˆæ¯å¤„ç†è€—æ—¶ 5ms</span><br>                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                        e.printStackTrace();<br>                    &#125;<br>                &#125;<br><br>                System.out.println(<span class="hljs-string">&quot;æœ¬æ‰¹æ¬¡æ¶ˆæ¯å¤„ç†å®Œæˆ&quot;</span>);<br>                <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-comment">// å¯åŠ¨æ¶ˆè´¹è€…</span><br>        consumer.start();<br><br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…å·²å¯åŠ¨ï¼Œå‡†å¤‡æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>consumeMessageBatchMaxSize</code> æ§åˆ¶çš„æ˜¯<strong>å®é™…ä¼ ç»™ä¸šåŠ¡é€»è¾‘çš„æ‰¹æ¬¡å¤§å°</strong>ã€‚</li><li><code>pullBatchSize</code> æ§åˆ¶çš„æ˜¯<strong>ä» Broker æ‹‰å–çš„æ¶ˆæ¯æ•°</strong>ï¼Œåº”å¤§äºç­‰äº <code>consumeMessageBatchMaxSize</code>ã€‚</li></ul><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è§£å†³æ¶ˆæ¯å †ç§¯é—®é¢˜å¸¸ç”¨æ–¹æ³•å°±æ˜¯ä¸Šé¢è¯´çš„è¿™äº›å•¦ï¼Œå½“ç„¶ä»RocketMQä»ªè¡¨ç›˜ç›‘æµ‹æ¶ˆæ¯æ¶ˆè´¹æƒ…å†µä¹Ÿæ˜¯å¾ˆé‡è¦çš„</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>RocketMQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>RocketMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£RocketMQå¦‚ä½•å®ç°é¡ºåºæ¶ˆæ¯</title>
    <link href="/2025/06/23/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3RocketMQ%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/"/>
    <url>/2025/06/23/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3RocketMQ%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>æ¯ç§MQå¯¹é¡ºåºæ¶ˆæ¯çš„å®ç°éƒ½å„æœ‰å·®å¼‚ï¼Œæˆ‘ä»¬ä»Šå¤©ä¸»è¦æ¥è®²è®²RocketMQæ˜¯å¦‚ä½•å®ç°é¡ºåºæ¶ˆæ¯çš„ã€‚è¯·æ³¨æ„ï¼Œç”±äºå…¨å±€é¡ºåºæ¶ˆæ¯ä¸å¸¸ç”¨ï¼Œæˆ‘ä»¬è¿™é‡Œæåˆ°çš„é¡ºåºæ¶ˆæ¯éƒ½æ˜¯æŒ‡åˆ†åŒºé¡ºåºæ¶ˆæ¯ã€‚</p><h1 id="é¡ºåºæ¶ˆæ¯çš„å®šä¹‰ğŸ˜£"><a href="#é¡ºåºæ¶ˆæ¯çš„å®šä¹‰ğŸ˜£" class="headerlink" title="é¡ºåºæ¶ˆæ¯çš„å®šä¹‰ğŸ˜£"></a>é¡ºåºæ¶ˆæ¯çš„å®šä¹‰ğŸ˜£</h1><p>RocketMQä¸­çš„é¡ºåºæ¶ˆæ¯åˆ†ä¸ºå…¨å±€é¡ºåºæ¶ˆæ¯å’Œåˆ†åŒºé¡ºåºæ¶ˆæ¯ã€‚</p><h2 id="å…¨å±€é¡ºåºæ¶ˆæ¯"><a href="#å…¨å±€é¡ºåºæ¶ˆæ¯" class="headerlink" title="å…¨å±€é¡ºåºæ¶ˆæ¯"></a>å…¨å±€é¡ºåºæ¶ˆæ¯</h2><p>å…¨å±€é¡ºåºæ¶ˆæ¯æ˜¯æŒ‡æŸä¸ªTopicä¸‹çš„æ‰€æœ‰æ¶ˆæ¯éƒ½èƒ½å¤ŸæŒ‰ç…§å‘é€çš„é¡ºåºè¢«æ¶ˆè´¹ã€‚è¿™é‡Œç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå…¨å±€é¡ºåºæ¶ˆæ¯ä¸å¸¸ç”¨ï¼Œå› ä¸º<strong>å…¨å±€é¡ºåºæ¶ˆæ¯é€šå¸¸æ„å‘³ç€åœ¨ä¸€ä¸ª Topic ä¸‹åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—</strong>ã€‚å¦‚æœè¦æ±‚æ•´ä¸ª Topic çš„æ‰€æœ‰æ¶ˆæ¯éƒ½ä¸¥æ ¼æœ‰åºï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿æ‰€æœ‰çš„æ¶ˆæ¯éƒ½å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”ç”±åŒä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æŒ‰åºæ¶ˆè´¹ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥ Topic åªèƒ½é…ç½®ä¸€ä¸ªé˜Ÿåˆ—ã€‚</p><p>ç„¶è€Œï¼Œè¿™ä¹Ÿæ„å‘³ç€æ€§èƒ½å—é™äºå•ä¸ªé˜Ÿåˆ—å’Œå•ä¸ªæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ï¼Œå› ä¸ºä¸èƒ½åˆ©ç”¨å¤šé˜Ÿåˆ—å¸¦æ¥çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚å› æ­¤ï¼Œå…¨å±€é¡ºåºæ¶ˆæ¯é€‚ç”¨äºå¯¹<strong>é¡ºåºè¦æ±‚æé«˜ã€ä½†ååé‡éœ€æ±‚ä¸é«˜</strong>çš„åœºæ™¯</p><p>æ‰€ä»¥å¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œæ›´å¸¸è§çš„æ˜¯ä½¿ç”¨åˆ†åŒºé¡ºåºæ¶ˆæ¯ï¼Œå³ä¿è¯æŸäº›ç±»å‹çš„æ¶ˆæ¯æœ‰åºå³å¯ã€‚</p><h2 id="åˆ†åŒºé¡ºåºæ¶ˆæ¯"><a href="#åˆ†åŒºé¡ºåºæ¶ˆæ¯" class="headerlink" title="åˆ†åŒºé¡ºåºæ¶ˆæ¯"></a>åˆ†åŒºé¡ºåºæ¶ˆæ¯</h2><p>åˆ†åŒºé¡ºåºæ¶ˆæ¯åˆ™æ˜¯æŒ‡åœ¨æ¶ˆæ¯è¢«åˆ’åˆ†åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­æ—¶ï¼Œæ¯ä¸ªé˜Ÿåˆ—å†…éƒ¨çš„æ¶ˆæ¯èƒ½å¤Ÿä¿è¯é¡ºåºæ¶ˆè´¹ã€‚å®é™…åº”ç”¨ä¸­ï¼Œåˆ†åŒºé¡ºåºæ¶ˆæ¯æ›´ä¸ºå¸¸ç”¨ï¼Œå› ä¸ºå®ƒèƒ½åœ¨ä¿è¯ä¸€å®šé¡ºåºçš„åŒæ—¶æä¾›<strong>æ›´å¥½çš„å¹¶å‘æ€§èƒ½</strong>ã€‚</p><p>ä¸ºäº†ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œå¯¹äºéœ€è¦ä¿è¯é¡ºåºçš„æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶å¿…é¡»ç¡®ä¿<strong>ç›¸åŒä¸šåŠ¡é€»è¾‘çš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—</strong>ä¸­ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡æ¶ˆæ¯çš„<strong>Keyè¿›è¡Œå“ˆå¸Œå–æ¨¡</strong>æ¥å†³å®šæ¶ˆæ¯å‘é€åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚åŒæ—¶ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦é‡‡ç”¨<strong>å•çº¿ç¨‹æ¨¡å¼</strong>æ¶ˆè´¹è¯¥é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œé¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç”±äºç«äº‰å¯¼è‡´çš„æ¶ˆæ¯é¡ºåºé”™ä¹±ã€‚</p><h1 id="ç”Ÿäº§è€…ç«¯ğŸ¤“"><a href="#ç”Ÿäº§è€…ç«¯ğŸ¤“" class="headerlink" title="ç”Ÿäº§è€…ç«¯ğŸ¤“"></a>ç”Ÿäº§è€…ç«¯ğŸ¤“</h1><p>RocketMQä»ç”Ÿäº§è€…ç«¯å’Œæ¶ˆè´¹è€…ç«¯ä¸¤ä¸ªæ–¹é¢æ¥ä¿è¯äº†åˆ†åŒºé¡ºåºæ¶ˆæ¯æœºåˆ¶ï¼Œæˆ‘ä»¬ä¹Ÿä»è¿™ä¸¤ä¸ªæ–¹é¢æ¥è®²ã€‚</p><p>RocketMQåœ¨ç”Ÿäº§è€…ç«¯é€šè¿‡<code>MessageQueueSelector</code>æ¥ä¿è¯é¡ºåºæ¶ˆæ¯ï¼Œä¼ å…¥orderIdï¼Œ<code>id % mqs.size()</code>ä¿è¯æ¶ˆæ¯ä¼šä¼ å…¥åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œä»£è¡¨å±äºè¿™ä¸ªè®¢å•idï¼ˆå…·ä½“ä¸šåŠ¡ï¼‰çš„æ¶ˆæ¯éƒ½ä¼ å…¥è¿™ä¸ªé˜Ÿåˆ—ï¼Œè¿™é‡Œå°±å¯ä»¥ä¿è¯é˜Ÿåˆ—å±€éƒ¨æœ‰åº</p><p><strong>MessageQueueSelector æ¥å£ä»‹ç»</strong></p><ul><li><code>mqs</code>: å½“å‰ Topic å¯¹åº”çš„æ‰€æœ‰é˜Ÿåˆ—åˆ—è¡¨ã€‚</li><li><code>msg</code>: å½“å‰è¦å‘é€çš„æ¶ˆæ¯å¯¹è±¡ã€‚</li><li><code>arg</code>: ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°ï¼Œå¯ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶ä¼ å…¥ã€‚</li><li>è¿”å›å€¼ï¼šé€‰æ‹©å‡ºçš„ä¸€ä¸ª <code>MessageQueue</code>ï¼Œå³è¿™æ¡æ¶ˆæ¯å°†è¢«å‘é€åˆ°è¯¥é˜Ÿåˆ—ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MessageQueueSelector</span> &#123;<br>    MessageQueue <span class="hljs-title function_">select</span><span class="hljs-params">(<span class="hljs-keyword">final</span> List&lt;MessageQueue&gt; mqs, <span class="hljs-keyword">final</span> Message msg, <span class="hljs-keyword">final</span> Object arg)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨MessageQueueSelector</strong></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨ <code>MessageQueueSelector</code> æ¥ä¿è¯è®¢å•æ¶ˆæ¯é¡ºåºæ€§çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å‘é€æ¶ˆæ¯æ—¶æŒ‡å®š selector</span><br><span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ORDER_20250623_001&quot;</span>;<br>producer.send(msg, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueueSelector</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> MessageQueue <span class="hljs-title function_">select</span><span class="hljs-params">(List&lt;MessageQueue&gt; mqs, Message msg, Object arg)</span> &#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (Integer) arg;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> id % mqs.size();<br>        <span class="hljs-keyword">return</span> mqs.get(index);<br>    &#125;<br>&#125;, orderId.hashCode());<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰å…·æœ‰ç›¸åŒ <code>orderId</code> çš„æ¶ˆæ¯éƒ½ä¼šè¢«å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä»è€Œä¿è¯äº†è¿™äº›æ¶ˆæ¯åœ¨æ¶ˆè´¹ç«¯æ˜¯æœ‰åºçš„ã€‚</p><h1 id="æ¶ˆè´¹è€…ç«¯ğŸ˜"><a href="#æ¶ˆè´¹è€…ç«¯ğŸ˜" class="headerlink" title="æ¶ˆè´¹è€…ç«¯ğŸ˜"></a>æ¶ˆè´¹è€…ç«¯ğŸ˜</h1><p>å…‰æœ‰ç”Ÿäº§è€…ç”¨ <code>MessageQueueSelector</code> æŠŠæ¶ˆæ¯å‘åˆ°å›ºå®šé˜Ÿåˆ—è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦æ¶ˆè´¹è€…ç«¯é…åˆæ‰èƒ½ä¿è¯é¡ºåºæ¶ˆè´¹ï¼š</p><ul><li>æ¶ˆè´¹è€…å¿…é¡»é‡‡ç”¨ <strong>å•çº¿ç¨‹æ¶ˆè´¹æ¨¡å¼</strong> æ¥æ¶ˆè´¹æ¯ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚</li><li>RocketMQ é»˜è®¤ä½¿ç”¨å¹¶å‘æ¶ˆè´¹ï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½® <code>consumeThreadMin</code> å’Œ <code>consumeThreadMax</code> ä¸º 1ï¼Œæˆ–è€…ä½¿ç”¨ <code>MessageListenerOrderly</code> æ¥ç›‘å¬æ¶ˆæ¯ã€‚</li></ul><p>psï¼š<code>MessageListenerOrderly</code> ä¿è¯çš„æ˜¯ï¼š<strong>åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œåœ¨ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…ï¼Œåªè¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ä¸²è¡Œæ¶ˆè´¹</strong></p><p>å®ƒç¡®ä¿æ¯ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯åªèƒ½è¢«è¯¥æ¶ˆè´¹ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æ¶ˆè´¹ï¼Œå¹¶ä¸”æ˜¯<strong>ä¸²è¡Œæ¶ˆè´¹</strong>ï¼ˆå³ä¸€æ¡ä¸€æ¡åœ°å¤„ç†ï¼Œä¸å¹¶å‘ï¼‰ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</p><p>é‚£ä¹ˆåŒä¸€ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†å®Œè¿™ä¸ªä¸€ç³»åˆ—ä¸šåŠ¡æ¶ˆæ¯ä¹‹å‰ï¼Œä¸èƒ½å¤„ç†å…¶ä»–é˜Ÿåˆ—çš„æ¶ˆæ¯å—ï¼Ÿè™½ç„¶ <code>MessageListenerOrderly</code> ç¡®ä¿äº†å•ä¸ª <code>MessageQueue</code> å†…çš„æ¶ˆæ¯æ˜¯ä¸²è¡Œå¤„ç†çš„ï¼Œä½†å®ƒå¹¶ä¸é™åˆ¶æ•´ä¸ªæ¶ˆè´¹è€…å®ä¾‹åŒæ—¶å¤„ç†å¤šä¸ªä¸åŒçš„ <code>MessageQueue</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒ <code>MessageQueue</code> ä¸Šçš„æ¶ˆæ¯ä»ç„¶å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œåªæ˜¯åœ¨åŒä¸€æ—¶é—´ç‚¹ä¸Šï¼Œæ¯ä¸ª <code>MessageQueue</code> åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ¶ˆè´¹</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerOrderly</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs, MessageListenerOrderly.ConcurrentlyTopicSubSet context)</span> &#123;<br>        <span class="hljs-keyword">for</span> (MessageExt msg : msgs) &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹æ¶ˆæ¯: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody()));<br>        &#125;<br>        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™å°±æ˜¯RocketMQå®ç°é¡ºåºæ¶ˆæ¯çš„è§£æ</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>RocketMQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>RocketMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼è®²è§£æœ¬åœ°ç¼“å­˜Caffeine</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E8%AE%B2%E8%A7%A3%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98Caffeine/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E8%AE%B2%E8%A7%A3%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98Caffeine/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>ä¸Šæ¬¡æˆ‘ä»¬è®²äº†æœ¬åœ°ç¼“å­˜guavaï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ¯”å®ƒæ›´åŠ ä¼˜ç§€çš„æœ¬åœ°ç¼“å­˜å‘¢ï¼Ÿæœ‰çš„ï¼Œå…„å¼Ÿï¼Œæœ‰çš„ã€‚è¿™æ¬¡æˆ‘ä»¬æ¥è®²æœ¬åœ°ç¼“å­˜Caffeineã€‚</p><h1 id="æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤"><a href="#æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤" class="headerlink" title="æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤"></a>æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤</h1><p>ä¸æ˜¯æœ‰äº†åƒredisè¿™æ ·çš„åˆ†å¸ƒå¼ç¼“å­˜äº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ¬åœ°ç¼“å­˜å‘¢ï¼Ÿå› ä¸ºæœ¬åœ°ç¼“å­˜æœ‰è¿™æ ·çš„ä¼˜åŠ¿:</p><ol><li><strong>æå‡æ€§èƒ½</strong></li></ol><ul><li><strong>å‡å°‘å»¶è¿Ÿ</strong>ï¼šé€šè¿‡åœ¨åº”ç”¨å±‚å¼•å…¥æœ¬åœ°ç¼“å­˜ä½œä¸ºç¬¬ä¸€çº§ç¼“å­˜ï¼ˆL1ï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿›ç¨‹å†…éƒ¨å¿«é€Ÿå“åº”æŸ¥è¯¢è¯·æ±‚ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½è®¿é—®æ›´æ…¢çš„å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚è¿œç¨‹ç¼“å­˜æˆ–æ•°æ®åº“ï¼‰ã€‚è¿™æ˜¾è‘—å‡å°‘äº†å“åº”æ—¶é—´ã€‚</li><li><strong>å‡å°‘IO</strong>ï¼šç”±äºæœ¬åœ°ç¼“å­˜å¯ä»¥å‘½ä¸­éƒ¨åˆ†æ•°æ®ï¼Œå‡å°‘äº†ä¸åˆ†å¸ƒå¼ç¼“å­˜çš„äº¤äº’ï¼Œä¹Ÿå°±å‡å°‘äº†IOæ¬¡æ•°ï¼Œè¿›è€Œå‡å°‘äº†ç½‘ç»œå¼€é”€</li></ul><ol start="2"><li><strong>å‡è½»åç«¯å‹åŠ›</strong></li></ol><ul><li><strong>é™ä½è´Ÿè½½</strong>ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥å¯ä»¥æœ‰æ•ˆå‡å°‘å¯¹åç«¯æ•°æ®åº“æˆ–å…¶ä»–å¤–éƒ¨æœåŠ¡çš„ç›´æ¥è®¿é—®æ¬¡æ•°ï¼Œä»è€Œå‡è½»è¿™äº›èµ„æºçš„å‹åŠ›ï¼Œæé«˜æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</li></ul><ol start="3"><li><strong>å¢åŠ ç¼“å­˜å‘½ä¸­ç‡</strong></li></ol><ul><li><strong>ä¼˜åŒ–ç¼“å­˜åˆ©ç”¨ç‡</strong>ï¼šä¸åŒçš„ç¼“å­˜çº§åˆ«å¯ä»¥æ ¹æ®å…¶ç‰¹ç‚¹å­˜å‚¨ä¸åŒçƒ­åº¦çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæœ¬åœ°ç¼“å­˜å¯ä»¥å­˜æ”¾æœ€å¸¸è®¿é—®çš„æ•°æ®ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜åˆ™ç”¨äºå­˜æ”¾ç›¸å¯¹è¾ƒå°‘è®¿é—®ä½†ä»ç„¶é‡è¦çš„æ•°æ®ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæœ€å¤§åŒ–åˆ©ç”¨å„ä¸ªå±‚çº§ç¼“å­˜çš„ä¼˜åŠ¿ï¼Œæé«˜æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡ã€‚</li></ul><ol start="4"><li><strong>å®¹é”™èƒ½åŠ›å¢å¼º</strong></li></ol><ul><li><strong>æä¾›å†—ä½™</strong>ï¼šå½“ä¸€ä¸ªçº§åˆ«çš„ç¼“å­˜å‘ç”Ÿæ•…éšœæˆ–å¤±æ•ˆæ—¶ï¼Œå…¶ä»–çº§åˆ«çš„ç¼“å­˜ä»ç„¶å¯ä»¥æä¾›ä¸€å®šç¨‹åº¦çš„æœåŠ¡ï¼Œé¿å…äº†å•ç‚¹å¤±è´¥å¸¦æ¥çš„ä¸¥é‡å½±å“ï¼Œæé«˜äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›å’Œå¯é æ€§ã€‚</li></ul><ol start="5"><li><strong>çµæ´»æ€§ä¸å¯æ‰©å±•æ€§</strong></li></ol><ul><li><strong>æ˜“äºè°ƒæ•´å’Œæ‰©å±•</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–ï¼Œå¯ä»¥çµæ´»åœ°è°ƒæ•´å„çº§ç¼“å­˜çš„å¤§å°ã€è¿‡æœŸç­–ç•¥ç­‰å‚æ•°ï¼Œç”šè‡³æ·»åŠ æ–°çš„ç¼“å­˜å±‚æ¬¡ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„å·¥ä½œè´Ÿè½½ã€‚</li></ul><h1 id="å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹"><a href="#å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹" class="headerlink" title="å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹"></a>å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹</h1><p>åœ¨<strong>å¤šçº§ç¼“å­˜æ¶æ„</strong>ä¸­ï¼Œä¸€èˆ¬çš„è®¾è®¡æ¨¡å¼æ˜¯ï¼š</p><blockquote><p><strong>å…ˆæŸ¥æœ¬åœ°ç¼“å­˜ï¼ˆL1ç¼“å­˜ï¼‰ â†’ æœªå‘½ä¸­åˆ™æŸ¥åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆL2ç¼“å­˜ï¼‰ â†’ è¿˜æœªå‘½ä¸­æ‰æŸ¥è¯¢æ•°æ®åº“ã€‚</strong></p></blockquote><p>è¿™ç§è®¾è®¡çš„ç›®çš„åœ¨äº<strong>å…¼é¡¾æ€§èƒ½ä¸ä¸€è‡´æ€§</strong></p><p><img src="https://i-blog.csdnimg.cn/direct/5c84a039bc0a4a94963f0efc739c633b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="ä½¿ç”¨Caffeineä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜¶â€ğŸŒ«ï¸"><a href="#ä½¿ç”¨Caffeineä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜¶â€ğŸŒ«ï¸" class="headerlink" title="ä½¿ç”¨Caffeineä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜¶â€ğŸŒ«ï¸"></a>ä½¿ç”¨Caffeineä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜¶â€ğŸŒ«ï¸</h1><p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼ŒCaffeineæœ¬èº«å¹¶ä¸æä¾›æ³¨è§£æ¥ä½¿ç”¨ç¼“å­˜åŠŸèƒ½ã€‚Caffeine æä¾›äº† <code>newBuilder()</code> API æ¥ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®å’Œä½¿ç”¨ç¼“å­˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥ä½¿ç”¨<strong>Spring Cache é›†æˆ Caffeine</strong>çš„æ–¹å¼æ¥ä½¿ç”¨Caffeineçš„æœ¬åœ°ç¼“å­˜åŠŸèƒ½ï¼Œè¿™æ ·éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå…è®¸é€šè¿‡æ³¨è§£æ¥ï¼ˆå¦‚ <code>@Cacheable</code>ã€<code>@CachePut</code> å’Œ <code>@CacheEvict</code>ï¼‰æ¥å£°æ˜æ€§åœ°é…ç½®ç¼“å­˜</p><h2 id="æ·»åŠ Spring-Cache-å’Œ-Guava-ä¾èµ–"><a href="#æ·»åŠ Spring-Cache-å’Œ-Guava-ä¾èµ–" class="headerlink" title="æ·»åŠ Spring Cache å’Œ Guava ä¾èµ–"></a>æ·»åŠ <strong>Spring Cache å’Œ Guava ä¾èµ–</strong></h2><p>åœ¨pomæ–‡ä»¶æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼šç¡®ä¿ç‰ˆæœ¬å·ä¸ä½ çš„é¡¹ç›®å…¼å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="é…ç½®-Caffeine-ç¼“å­˜"><a href="#é…ç½®-Caffeine-ç¼“å­˜" class="headerlink" title="é…ç½® Caffeine ç¼“å­˜"></a>é…ç½® Caffeine ç¼“å­˜</h2><p>å’Œguavaä¸åŒçš„æ˜¯ï¼Œguavaéœ€è¦é…ç½®ç±»æ‰å¯ä»¥ä½¿ç”¨æ³¨è§£å¼€å‘ï¼Œè€Œcaffeineç”±äºå’ŒSpringé«˜åº¦ç»“åˆï¼Œç›´æ¥åœ¨ymlæ–‡ä»¶è¿›è¡Œé…ç½®å³å¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">caffeine</span><br>    <span class="hljs-attr">caffeine:</span><br>      <span class="hljs-attr">spec:</span> <span class="hljs-string">maximumSize=500,expireAfterAccess=60s</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ æƒ³ä½¿ç”¨é…ç½®ç±»æ¥å®ç°æ›´ç»†ç²’åº¦çš„æ§åˆ¶æˆ–è€…æœ‰å¤šä¸ªç¼“å­˜ç®¡ç†å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªé…ç½®ç±»æ¥æŒ‡å®šç¼“å­˜ç®¡ç†å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CaffeineCacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>();<br>        cacheManager.setCaffeine(caffeineCacheBuilder());<br>        <span class="hljs-keyword">return</span> cacheManager;<br>    &#125;<br><br>    Caffeine&lt;Object, Object&gt; <span class="hljs-title function_">caffeineCacheBuilder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Caffeine.newBuilder()<br>                .expireAfterWrite(<span class="hljs-number">60</span>, TimeUnit.SECONDS)<br>                .maximumSize(<span class="hljs-number">100</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªé…ç½®ç±»ä¸­ï¼š</p><ul><li>ä½¿ç”¨äº† <code>@EnableCaching</code> æ³¨è§£å¯ç”¨ç¼“å­˜ã€‚</li><li>å®šä¹‰äº†ä¸€ä¸ª <code>cacheManager()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>CaffeineCacheManager</code> å®ä¾‹ï¼Œå¹¶è®¾ç½®äº† Caffeine ç¼“å­˜æ„å»ºå™¨ã€‚</li><li>åœ¨ <code>caffeineCacheBuilder()</code> æ–¹æ³•ä¸­ï¼Œé…ç½®äº†ç¼“å­˜çš„æœ‰æ•ˆæœŸå’Œæœ€å¤§å®¹é‡ç­‰å‚æ•°ã€‚</li></ul><p>è¿™ç§æ–¹å¼æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå…è®¸ä½ æ ¹æ®åº”ç”¨çš„éœ€æ±‚å®šåˆ¶ç¼“å­˜çš„è¡Œä¸ºã€‚</p><h2 id="å¯ç”¨ç¼“å­˜"><a href="#å¯ç”¨ç¼“å­˜" class="headerlink" title="å¯ç”¨ç¼“å­˜"></a>å¯ç”¨ç¼“å­˜</h2><p>å¦‚æœä½ æ²¡æœ‰è¿›è¡Œåˆ›å»ºé…ç½®ç±»ï¼Œå°±éœ€è¦åœ¨ä½ çš„ä¸»åº”ç”¨ç¨‹åºç±»æˆ–é…ç½®ç±»ä¸Šæ·»åŠ  <code>@EnableCaching</code> æ³¨è§£ä»¥å¯ç”¨ç¼“å­˜åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YourApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(YourApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç¼“å­˜æ³¨è§£"><a href="#ä½¿ç”¨ç¼“å­˜æ³¨è§£" class="headerlink" title="ä½¿ç”¨ç¼“å­˜æ³¨è§£"></a>ä½¿ç”¨ç¼“å­˜æ³¨è§£</h2><p>ç°åœ¨ä½ å¯ä»¥åœ¨ä½ çš„æœåŠ¡å±‚æ–¹æ³•ä¸Šä½¿ç”¨ Spring çš„ç¼“å­˜æ³¨è§£ï¼Œæ¯”å¦‚ <code>@Cacheable</code>, <code>@CachePut</code>, å’Œ <code>@CacheEvict</code> ç­‰ç­‰ï¼Œä»¥ä¾¿æ ¹æ®éœ€è¦æ§åˆ¶ç¼“å­˜çš„è¡Œä¸ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YourService</span> &#123;<br><br>    <span class="hljs-meta">@Cacheable(&quot;books&quot;)</span><br>    <span class="hljs-keyword">public</span> Book <span class="hljs-title function_">findBook</span><span class="hljs-params">(ISBN isbn)</span> &#123;<br>        <span class="hljs-comment">// æ–¹æ³•é€»è¾‘...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦çœ‹è¯¦ç»†çš„Springç¼“å­˜æ³¨è§£ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘çš„å…³äºguavaæœ¬åœ°ç¼“å­˜çš„ä»‹ç»ï¼Œå› ä¸ºå·²ç»è®²è¿‡ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ã€‚</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>åå°ç¼“å­˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>åå°ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•å®˜æ‹·æ‰“æˆ‘çº¿ç¨‹æ± ï¼Œæˆ‘è¿™æ ·å›ç­”....</title>
    <link href="/2025/06/22/%E9%9D%A2%E8%AF%95%E5%AE%98%E6%8B%B7%E6%89%93%E6%88%91%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E6%88%91%E8%BF%99%E6%A0%B7%E5%9B%9E%E7%AD%94/"/>
    <url>/2025/06/22/%E9%9D%A2%E8%AF%95%E5%AE%98%E6%8B%B7%E6%89%93%E6%88%91%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%8C%E6%88%91%E8%BF%99%E6%A0%B7%E5%9B%9E%E7%AD%94/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>å¦‚æœå¤§å®¶åœ¨ç®€å†ä¸­å†™ç†Ÿæ‚‰Javaå¹¶å‘ç¼–ç¨‹æˆ–è€…é¡¹ç›®æœ‰ç‰µæ‰¯åˆ°çº¿ç¨‹æ± ç›¸å…³å†…å®¹ï¼Œé‚£ä¹ˆè¢«æ‹·æ‰“çº¿ç¨‹æ± æ˜¯å¤§æ¦‚ç‡çš„äº‹ã€‚ä¸‹é¢çš„å†…å®¹æ˜¯æœ‰å…³ä»Šå¹´äº”æœˆä»½æŸå¤§å‚é¢è¯•ä¸­æœ‰å…³çº¿ç¨‹æ± çš„æ‹·æ‰“ï¼Œæˆ‘ä»ä¸­æå–ä¸€äº›æ¯”è¾ƒé€šç”¨çš„å†…å®¹è¿›è¡Œè§£ç­”ï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å§ï¼</p><h1 id="çº¿ç¨‹æ± çš„å¥½å¤„ğŸ˜¯"><a href="#çº¿ç¨‹æ± çš„å¥½å¤„ğŸ˜¯" class="headerlink" title="çº¿ç¨‹æ± çš„å¥½å¤„ğŸ˜¯"></a>çº¿ç¨‹æ± çš„å¥½å¤„ğŸ˜¯</h1><p>ç»å…¸èµ·æ‰‹ï¼Œè¿™å°±éå¸¸å…«è‚¡äº†ï¼Œè¿™é‡Œæˆ‘æƒ³è®©å¤§å®¶éƒ½æ˜ç™½ä¸€ä¸ªé“ç†ï¼Œç”Ÿæ´»å’Œå­¦ä¹ ä¸­ï¼Œéƒ½è¦å…ˆæ˜ç™½åšè¿™ä»¶äº‹çš„å¥½å¤„ï¼ˆåå¤„ï¼‰æ˜¯ä»€ä¹ˆï¼Œå†æƒ³å¦‚ä½•åšå¯èƒ½çµæ„Ÿå°±ä¼šå¤šå¾—å¤šï¼Œå¥½çš„ä¸‹é¢è®©æˆ‘ä»¬å›å½’æ­£é¢˜â¤ï¸ã€‚</p><p>åœ¨Javaå¼€å‘ä¸­ï¼Œä½¿ç”¨çº¿ç¨‹æ± ï¼ˆå¦‚é€šè¿‡<code>ThreadPoolExecutor</code>ç±»å®ç°ï¼‰æœ‰å¤šä¸ªå¥½å¤„ï¼š</p><ol><li><strong>é‡ç”¨çº¿ç¨‹</strong>ï¼šé€šè¿‡çº¿ç¨‹æ± å¯ä»¥é‡ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ¯æ¬¡éœ€è¦æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ—¶éƒ½å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œåœ¨ä»»åŠ¡å®Œæˆåé”€æ¯è¯¥çº¿ç¨‹ã€‚è¿™ç§åšæ³•ä¼šå¯¼è‡´å¤§é‡çš„èµ„æºæ¶ˆè€—å’Œæ€§èƒ½æŸè€—ã€‚è€Œçº¿ç¨‹æ± å…è®¸çº¿ç¨‹è¢«é‡å¤åˆ©ç”¨ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ã€‚</li><li><strong>æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°é‡</strong>ï¼šçº¿ç¨‹æ± å¯ä»¥å¸®åŠ©ä½ é™åˆ¶ç³»ç»Ÿä¸­å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡è®¾å®šæœ€å¤§çº¿ç¨‹æ•°ï¼Œä½ å¯ä»¥é¿å…å› ä¸ºè¿‡å¤šçš„çº¿ç¨‹åŒæ—¶è¿è¡Œè€Œå¯¼è‡´ç³»ç»Ÿè¿‡è½½çš„é—®é¢˜ã€‚</li><li><strong>ç®¡ç†é˜Ÿåˆ—</strong>ï¼šå½“æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç¢Œæ—¶ï¼Œæ–°çš„ä»»åŠ¡ä¼šè¢«æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„çº¿ç¨‹æ¥å¤„ç†å®ƒä»¬ã€‚è¿™æœ‰åŠ©äºå¹³æ»‘è´Ÿè½½å³°å€¼ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦</strong>ï¼šç”±äºçº¿ç¨‹å·²ç»è¢«åˆ›å»ºå¹¶å°±ç»ªï¼Œå› æ­¤å½“æœ‰æ–°ä»»åŠ¡åˆ°è¾¾æ—¶å¯ä»¥ç«‹å³å¼€å§‹æ‰§è¡Œï¼Œä¸éœ€è¦ç»å†çº¿ç¨‹åˆ›å»ºçš„å»¶è¿Ÿï¼Œä»è€Œæé«˜äº†åº”ç”¨å¯¹è¯·æ±‚çš„å“åº”é€Ÿåº¦ã€‚</li><li><strong>æ–¹ä¾¿çš„ç®¡ç†åŠŸèƒ½</strong>ï¼š<code>ThreadPoolExecutor</code>æä¾›äº†å¤šç§ç®¡ç†å’Œç›‘æ§çº¿ç¨‹æ± çš„æ–¹æ³•ï¼Œæ¯”å¦‚è·å–å½“å‰æ´»è·ƒçº¿ç¨‹æ•°ã€å…³é—­çº¿ç¨‹æ± ç­‰ã€‚</li><li><strong>è°ƒåº¦èƒ½åŠ›</strong>ï¼šç»“åˆ<code>ScheduledThreadPoolExecutor</code>ï¼Œè¿˜å¯ä»¥å®ç°å®šæ—¶æˆ–å‘¨æœŸæ€§çš„ä»»åŠ¡æ‰§è¡Œã€‚</li></ol><p><code>ThreadPoolExecutor</code>æ˜¯Javaæä¾›çš„ä¸€ä¸ªçµæ´»çš„çº¿ç¨‹æ± å®ç°ï¼Œå®ƒå…è®¸å¼€å‘è€…æ ¹æ®å…·ä½“éœ€æ±‚é…ç½®æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ã€å·¥ä½œé˜Ÿåˆ—ç±»å‹ç­‰å‚æ•°ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—å®ƒæˆä¸ºå¤„ç†å¤§é‡å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç†æƒ³é€‰æ‹©ã€‚</p><h1 id="æ€ä¹ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ğŸ¤—"><a href="#æ€ä¹ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ğŸ¤—" class="headerlink" title="æ€ä¹ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ğŸ¤—"></a>æ€ä¹ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ğŸ¤—</h1><p>åœ¨Javaä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± å¯ä»¥é€šè¿‡<code>java.util.concurrent.Executors</code>å·¥å‚ç±»æˆ–è€…ç›´æ¥å®ä¾‹åŒ–<code>ThreadPoolExecutor</code>æ¥å®ç°ã€‚ä¸‹é¢æ˜¯ä¸¤ç§ä¸åŒçš„æ–¹æ³•ï¼š</p><h2 id="ä½¿ç”¨Executorså·¥å‚ç±»"><a href="#ä½¿ç”¨Executorså·¥å‚ç±»" class="headerlink" title="ä½¿ç”¨Executorså·¥å‚ç±»"></a>ä½¿ç”¨Executorså·¥å‚ç±»</h2><p><code>Executors</code>æä¾›äº†ä¸€ç³»åˆ—é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ï¼Œè¿™äº›æ–¹æ³•åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><p><strong>å›ºå®šå¤§å°çš„çº¿ç¨‹æ± </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ‹¥æœ‰10ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œé¢å¤–çš„ä»»åŠ¡å°†ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</p></li><li><p><strong>ç¼“å­˜å‹çº¿ç¨‹æ± </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†æ˜¯åœ¨ä»¥å‰æ„é€ çš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚å¯¹äºæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™ç±»çº¿ç¨‹æ± æ˜¯ç†æƒ³é€‰æ‹©ã€‚</p></li><li><p><strong>å•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªåªæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä»¥æ— é¡ºåºçš„æ–¹å¼ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œä»»åŠ¡ã€‚</p></li><li><p><strong>è°ƒåº¦çº¿ç¨‹æ± </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledExecutorService</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ”¯æŒå®šæ—¶å’Œå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œçš„çº¿ç¨‹æ± ï¼Œå…·æœ‰æŒ‡å®šçš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</p></li></ul><h2 id="ç›´æ¥ä½¿ç”¨ThreadPoolExecutor"><a href="#ç›´æ¥ä½¿ç”¨ThreadPoolExecutor" class="headerlink" title="ç›´æ¥ä½¿ç”¨ThreadPoolExecutor"></a>ç›´æ¥ä½¿ç”¨ThreadPoolExecutor</h2><p>å¦‚æœä½ æƒ³æ›´ç»†è‡´åœ°æ§åˆ¶çº¿ç¨‹æ± çš„è¡Œä¸ºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>ThreadPoolExecutor</code>çš„æ„é€ å‡½æ•°ï¼Œå®ƒæä¾›äº†æœ€å¤§çš„çµæ´»æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>    <span class="hljs-number">10</span>, <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-number">20</span>, <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°</span><br>    <span class="hljs-number">1</span>, TimeUnit.MINUTES, <span class="hljs-comment">// çº¿ç¨‹ç©ºé—²æ—¶é—´</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;(<span class="hljs-number">100</span>), <span class="hljs-comment">// å·¥ä½œé˜Ÿåˆ—</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()); <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ</p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯æŒ‡çº¿ç¨‹æ± ä¸­çš„å¸¸é©»çº¿ç¨‹æ•°ã€‚</li><li>æœ€å¤§çº¿ç¨‹æ•°æ˜¯æŒ‡çº¿ç¨‹æ± ä¸­å…è®¸å­˜åœ¨çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚</li><li>çº¿ç¨‹ç©ºé—²æ—¶é—´æ˜¯æŒ‡è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°çš„é‚£äº›çº¿ç¨‹ï¼Œåœ¨ç©ºé—²äº†æŒ‡å®šçš„æ—¶é—´åä¼šè¢«ç»ˆæ­¢ã€‚</li><li>å·¥ä½œé˜Ÿåˆ—ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li><li>æ‹’ç»ç­–ç•¥å®šä¹‰äº†å½“ä»»åŠ¡æ— æ³•è¢«æäº¤åˆ°çº¿ç¨‹æ± æ—¶çš„è¡Œä¸ºã€‚</li></ul><p>åˆ›å»ºå¥½çº¿ç¨‹æ± ä¹‹åï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>execute()</code>æˆ–<code>submit()</code>æ–¹æ³•æ¥å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡ã€‚è®°å¾—åœ¨çº¿ç¨‹æ± ä¸å†ä½¿ç”¨æ—¶è°ƒç”¨<code>shutdown()</code>æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œç¡®ä¿ç¨‹åºå¯ä»¥æ­£å¸¸é€€å‡ºã€‚</p><h1 id="çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ğŸ¤“"><a href="#çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ğŸ¤“" class="headerlink" title="çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ğŸ¤“"></a>çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ğŸ¤“</h1><p>åœ¨Javaä¸­ï¼Œå½“çº¿ç¨‹æ± æ— æ³•æ¥å—æ–°ä»»åŠ¡æ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç¢Œä¸”å·¥ä½œé˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œéœ€è¦ä¸€ç§ç­–ç•¥æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚è¿™ç§ç­–ç•¥è¢«ç§°ä¸ºçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ï¼Œå®ƒç”±<code>RejectedExecutionHandler</code>æ¥å£å®šä¹‰ï¼Œå¹¶ä¸”Javaæä¾›äº†å‡ ç§å†…ç½®çš„å®ç°ï¼š</p><ol><li><p><strong>AbortPolicyï¼ˆé»˜è®¤ç­–ç•¥ï¼‰</strong> ï¼š</p><ul><li>æŠ›å‡ºä¸€ä¸ª<code>RejectedExecutionException</code>å¼‚å¸¸ã€‚è¿™å¯ä»¥è®©ä½ æ•è·å¼‚å¸¸å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadPoolExecutor.AbortPolicy()<br></code></pre></td></tr></table></figure></li><li><p><strong>CallerRunsPolicy</strong>ï¼š</p><ul><li>ä¸åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ã€‚è¿™ç§æ–¹å¼æä¾›äº†ä¸€ç§ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œå‡ç¼“äº†æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadPoolExecutor.CallerRunsPolicy()<br></code></pre></td></tr></table></figure></li><li><p><strong>DiscardPolicy</strong>ï¼š</p><ul><li>ç›´æ¥ä¸¢å¼ƒè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œä¸åšä»»ä½•å¤„ç†ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™ç§ç­–ç•¥é€‚ç”¨äºå½“ä½ ä¸éœ€è¦å…³å¿ƒä»»åŠ¡ä¸¢å¤±çš„æƒ…å†µã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadPoolExecutor.DiscardPolicy()<br></code></pre></td></tr></table></figure></li><li><p><strong>DiscardOldestPolicy</strong>ï¼š</p><ul><li>å¦‚æœçº¿ç¨‹æ± æ²¡æœ‰å…³é—­ï¼Œåˆ™å°†å·¥ä½œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼ˆå³æœ€æ—§çš„é‚£ä¸ªæœªå¤„ç†çš„ä»»åŠ¡ï¼‰ä¸¢å¼ƒï¼Œç„¶åå°è¯•é‡æ–°æäº¤è¢«æ‹’ç»çš„ä»»åŠ¡ã€‚æ³¨æ„ï¼Œè¿™ä¸ªç­–ç•¥ä¸ä¼šä¿è¯ä»»åŠ¡çš„é¡ºåºæ‰§è¡Œï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´è¾ƒæ—©æäº¤çš„ä»»åŠ¡è¢«åæ¥çš„ä»»åŠ¡å–ä»£ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadPoolExecutor.DiscardOldestPolicy()<br></code></pre></td></tr></table></figure></li></ol><p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸º<code>ThreadPoolExecutor</code>è®¾ç½®è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>    corePoolSize, <br>    maximumPoolSize, <br>    keepAliveTime, <br>    TimeUnit.MILLISECONDS, <br>    workQueue, <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardPolicy());<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>new ThreadPoolExecutor.DiscardPolicy()</code>å¯ä»¥æ›¿æ¢ä¸ºä½ é€‰æ‹©çš„ä»»ä½•ä¸€ç§æ‹’ç»ç­–ç•¥ã€‚è¿™æ ·åšå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†çº¿ç¨‹æ± çš„è¡Œä¸ºï¼Œå°¤å…¶æ˜¯åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ã€‚</p><h1 id="é¢„çƒ­çº¿ç¨‹æ± ğŸ¤ "><a href="#é¢„çƒ­çº¿ç¨‹æ± ğŸ¤ " class="headerlink" title="é¢„çƒ­çº¿ç¨‹æ± ğŸ¤ "></a>é¢„çƒ­çº¿ç¨‹æ± ğŸ¤ </h1><p>ç†Ÿæ‚‰çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œæµç¨‹çš„éƒ½æ¸…æ¥šï¼Œçº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œé‡Œé¢å¹¶æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°çš„ï¼Œæ˜¯ä¸€ä¸ªä»»åŠ¡æ¥ï¼Œæ‰åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œç›´åˆ°åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</p><p>åœ¨Javaä¸­ï¼Œ<code>ThreadPoolExecutor</code>å…è®¸ä½ é€šè¿‡é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹æ•°æ¥â€œé¢„çƒ­â€çº¿ç¨‹æ± ã€‚è¿™æ„å‘³ç€å³ä½¿æ²¡æœ‰ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¼šè¢«åˆ›å»ºå¹¶ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œå‡†å¤‡ç«‹å³å¤„ç†ä»»åŠ¡ã€‚è¿™æ ·åšå¯ä»¥å‡å°‘é¦–æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶çš„å»¶è¿Ÿï¼Œå› ä¸ºä¸éœ€è¦ç­‰å¾…çº¿ç¨‹çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><p>è¦å®ç°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>prestartCoreThread()</code>æˆ–<code>prestartAllCoreThreads()</code>æ–¹æ³•ï¼š</p><ul><li><strong><code>prestartCoreThread()</code></strong> ï¼šå°è¯•å¯åŠ¨ä¸€ä¸ªå°šæœªå¯åŠ¨çš„æ ¸å¿ƒçº¿ç¨‹ã€‚å¦‚æœå½“å‰å·²ç»æœ‰ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™æ­¤æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦æˆåŠŸå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚</li><li><strong><code>prestartAllCoreThreads()</code></strong> ï¼šå¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œå³æ ¹æ®è®¾å®šçš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸€æ¬¡æ€§å¯åŠ¨å¯¹åº”æ•°é‡çš„çº¿ç¨‹ã€‚æ­¤æ–¹æ³•ä¼šè¿”å›å®é™…å¯åŠ¨çš„çº¿ç¨‹æ•°ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolPreheatExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">corePoolSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maximumPoolSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">keepAliveTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;<br><br>        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>                corePoolSize,<br>                maximumPoolSize,<br>                keepAliveTime,<br>                TimeUnit.MILLISECONDS,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());<br><br>        <span class="hljs-comment">// é¢„å…ˆå¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">prestartedThreads</span> <span class="hljs-operator">=</span> executor.prestartAllCoreThreads();<br>        System.out.println(<span class="hljs-string">&quot;é¢„å…ˆå¯åŠ¨çš„æ ¸å¿ƒçº¿ç¨‹æ•°: &quot;</span> + prestartedThreads);<br><br>        <span class="hljs-comment">// æäº¤ä¸€äº›ä»»åŠ¡ç»™çº¿ç¨‹æ± </span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            executor.submit(() -&gt; &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; æ­£åœ¨æ‰§è¡Œä»»åŠ¡&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œæ—¶é—´</span><br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    Thread.currentThread().interrupt();<br>                &#125;<br>            &#125;);<br>        &#125;<br><br>        <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¯·ç¡®ä¿æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼‰</span><br>        executor.shutdown();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰5ä¸ªæ ¸å¿ƒçº¿ç¨‹å’Œæœ€å¤š10ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå¹¶è°ƒç”¨<code>prestartAllCoreThreads()</code>æ–¹æ³•æ¥é¢„çƒ­çº¿ç¨‹æ± ï¼Œç¡®ä¿æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹éƒ½å·²å‡†å¤‡å¥½å¤„ç†ä»»åŠ¡ã€‚è¿™æ ·ï¼Œå½“ä»»åŠ¡å¼€å§‹æäº¤åˆ°çº¿ç¨‹æ± æ—¶ï¼Œå®ƒä»¬å¯ä»¥ç«‹å³ç”±å·²ç»æ´»è·ƒçš„æ ¸å¿ƒçº¿ç¨‹å¤„ç†ï¼Œæ— éœ€ç­‰å¾…çº¿ç¨‹çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p><h1 id="ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—ğŸ¤©"><a href="#ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—ğŸ¤©" class="headerlink" title="ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—ğŸ¤©"></a>ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—ğŸ¤©</h1><p>åœ¨ Java ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­åˆ›å»ºçš„çº¿ç¨‹åç§°æ˜¯ç”± JVM è‡ªåŠ¨ç”Ÿæˆçš„ï¼ˆå¦‚ <code>pool-1-thread-1</code>ï¼‰ï¼Œä½†ä¸ºäº†æ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è¿½è¸ªï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›è‡ªå®šä¹‰è¿™äº›çº¿ç¨‹çš„åå­—ã€‚</p><h2 id="ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—çš„æ–¹æ³•ï¼š"><a href="#ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—çš„æ–¹æ³•ï¼š" class="headerlink" title="ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—çš„æ–¹æ³•ï¼š"></a>ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æŒ‡å®šåå­—çš„æ–¹æ³•ï¼š</h2><p>ä½ éœ€è¦é€šè¿‡å®ç° <code>ThreadFactory</code> æ¥å£ï¼Œå¹¶ä¼ å…¥åˆ°çº¿ç¨‹æ± ä¸­ã€‚Java æä¾›äº† <code>java.util.concurrent.ThreadFactory</code> æ¥å£ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚æ¥è®¾ç½®çº¿ç¨‹åç§°ã€‚</p><hr><p><strong>ç¤ºä¾‹ï¼šä½¿ç”¨è‡ªå®šä¹‰ ThreadFactory è®¾ç½®çº¿ç¨‹å</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NamedThreadPoolExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">corePoolSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxPoolSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">keepAliveTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>;<br>        <br>        <span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚</span><br>        <span class="hljs-type">ThreadFactory</span> <span class="hljs-variable">namedThreadFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() &#123;<br>            <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> &#123;<br>                <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">&quot;MyCustomThread-&quot;</span> + threadId++);<br>                <span class="hljs-comment">// å¯ä»¥è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–è®¾ç½®ä¼˜å…ˆçº§ç­‰</span><br>                <span class="hljs-comment">// t.setDaemon(true);</span><br>                <span class="hljs-keyword">return</span> t;<br>            &#125;<br>        &#125;;<br><br>        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹æ± </span><br>        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>                corePoolSize,<br>                maxPoolSize,<br>                keepAliveTime,<br>                TimeUnit.SECONDS,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">100</span>),<br>                namedThreadFactory<br>        );<br><br>        <span class="hljs-comment">// æäº¤ä»»åŠ¡</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskNo</span> <span class="hljs-operator">=</span> i;<br>            executor.execute(() -&gt; &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; æ­£åœ¨æ‰§è¡Œä»»åŠ¡ &quot;</span> + taskNo);<br>            &#125;);<br>        &#125;<br><br>        <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± </span><br>        executor.shutdown();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p><strong>è¾“å‡ºç¤ºä¾‹ï¼ˆçº¿ç¨‹åè‡ªå®šä¹‰ï¼‰ï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">æ·±è‰²ç‰ˆæœ¬<br>MyCustomTh<span class="hljs-built_in">read-1</span> æ­£åœ¨æ‰§è¡Œä»»åŠ¡ <span class="hljs-number">0</span><br>MyCustomTh<span class="hljs-built_in">read-2</span> æ­£åœ¨æ‰§è¡Œä»»åŠ¡ <span class="hljs-number">1</span><br>MyCustomTh<span class="hljs-built_in">read-3</span> æ­£åœ¨æ‰§è¡Œä»»åŠ¡ <span class="hljs-number">2</span><br>MyCustomTh<span class="hljs-built_in">read-1</span> æ­£åœ¨æ‰§è¡Œä»»åŠ¡ <span class="hljs-number">3</span><br>MyCustomTh<span class="hljs-built_in">read-2</span> æ­£åœ¨æ‰§è¡Œä»»åŠ¡ <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><hr><h2 id="ä½¿ç”¨-Executors-defaultThreadFactory-çš„å˜ç§ï¼ˆå¯é€‰ï¼‰"><a href="#ä½¿ç”¨-Executors-defaultThreadFactory-çš„å˜ç§ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="ä½¿ç”¨ Executors.defaultThreadFactory() çš„å˜ç§ï¼ˆå¯é€‰ï¼‰"></a>ä½¿ç”¨ <code>Executors.defaultThreadFactory()</code> çš„å˜ç§ï¼ˆå¯é€‰ï¼‰</h2><p>ä½ ä¹Ÿå¯ä»¥åŸºäºé»˜è®¤çš„ <code>ThreadFactory</code> è¿›è¡ŒåŒ…è£…ï¼Œæ¯”å¦‚ Apache Commons æˆ– Google Guava æä¾›çš„å·¥å…·ç±»ï¼ˆå¦‚ <code>ThreadFactoryBuilder</code>ï¼‰ï¼Œå¯ä»¥æ›´ç®€æ´åœ°å‘½åçº¿ç¨‹ã€‚</p><p>ä¾‹å¦‚ä½¿ç”¨ <strong>Guava</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.util.concurrent.ThreadFactoryBuilder;<br><br><span class="hljs-type">ThreadFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactoryBuilder</span>()<br>        .setNameFormat(<span class="hljs-string">&quot;my-pool-%d&quot;</span>)<br>        .setDaemon(<span class="hljs-literal">true</span>)<br>        .build();<br><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>, factory);<br></code></pre></td></tr></table></figure><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>æ–¹æ³•</th><th>æ˜¯å¦æ¨è</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å®ç° <code>ThreadFactory</code> æ¥å£</td><td>æ¨è</td><td>çµæ´»ã€å¯æ§ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td>ä½¿ç”¨ Guava çš„ <code>ThreadFactoryBuilder</code></td><td>æ¨è</td><td>æ›´åŠ ç®€æ´ï¼Œä¾èµ–ç¬¬ä¸‰æ–¹åº“</td></tr><tr><td>é»˜è®¤çº¿ç¨‹å·¥å‚</td><td>ä¸æ¨è</td><td>åç§°ä¸ç›´è§‚ï¼Œä¸åˆ©äºæ’æŸ¥é—®é¢˜</td></tr></tbody></table><h1 id="åœ¨å¹³æ—¶å·¥ä½œä¸­æ€ä¹ˆæ¥åˆ¶å®šä½ çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ğŸ˜¶â€ğŸŒ«ï¸"><a href="#åœ¨å¹³æ—¶å·¥ä½œä¸­æ€ä¹ˆæ¥åˆ¶å®šä½ çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ğŸ˜¶â€ğŸŒ«ï¸" class="headerlink" title="åœ¨å¹³æ—¶å·¥ä½œä¸­æ€ä¹ˆæ¥åˆ¶å®šä½ çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ğŸ˜¶â€ğŸŒ«ï¸"></a>åœ¨å¹³æ—¶å·¥ä½œä¸­æ€ä¹ˆæ¥åˆ¶å®šä½ çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ğŸ˜¶â€ğŸŒ«ï¸</h1><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œåˆç†è®¾ç½®çº¿ç¨‹æ± çš„ <strong>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰</strong> å’Œ <strong>æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰</strong> æ˜¯éå¸¸å…³é”®çš„ã€‚è®¾ç½®ä¸åˆç†ä¼šå¯¼è‡´èµ„æºæµªè´¹ã€ç³»ç»Ÿå“åº”å˜æ…¢ç”šè‡³å´©æºƒã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„æ€è·¯å’Œæ–¹æ³•ã€‚</p><p><strong>1.æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©ç­–ç•¥</strong></p><ol><li><strong>CPUå¯†é›†å‹ä»»åŠ¡</strong></li></ol><ul><li><p>ç‰¹ç‚¹ï¼šä¸»è¦æ¶ˆè€—CPUèµ„æºï¼Œå¦‚è®¡ç®—ã€åŠ å¯†ã€å‹ç¼©ç­‰ã€‚</p></li><li><p>å»ºè®®ï¼š</p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•° â‰ˆ CPUæ ¸æ•°</li><li>æœ€å¤§çº¿ç¨‹æ•° â‰ˆ CPUæ ¸æ•° Ã— 2ï¼ˆè§†æƒ…å†µï¼‰</li><li>ä¸éœ€è¦å¤ªå¤šçº¿ç¨‹ï¼Œé¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€è¿‡å¤§</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">corePoolSize</span> <span class="hljs-operator">=</span> Runtime.getRuntime().availableProcessors();<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>IOå¯†é›†å‹ä»»åŠ¡</strong></li></ol><ul><li><p>ç‰¹ç‚¹ï¼šå¤§é‡ç­‰å¾…IOå®Œæˆï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ã€ç£ç›˜è¯»å†™ï¼‰</p></li><li><p>å»ºè®®ï¼š</p><ul><li>å¯ä»¥é€‚å½“å¢åŠ çº¿ç¨‹æ•°ï¼Œå› ä¸ºå¾ˆå¤šçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€</li><li>æ ¸å¿ƒçº¿ç¨‹æ•° &#x3D; CPUæ ¸æ•° Ã— 2 æˆ–æ›´é«˜</li><li>æœ€å¤§çº¿ç¨‹æ•°å¯è®¾ä¸ºæ›´é«˜çš„å€¼ï¼ˆå¦‚ 50~200ï¼‰</li></ul></li></ul><p><strong>2.ç»“åˆä»»åŠ¡é˜Ÿåˆ—åˆ†æè´Ÿè½½</strong></p><ul><li>å¦‚æœä»»åŠ¡é˜Ÿåˆ—ç»å¸¸ç§¯å‹ â†’ å¢åŠ æ ¸å¿ƒçº¿ç¨‹æ•°æˆ–æœ€å¤§çº¿ç¨‹æ•°</li><li>å¦‚æœçº¿ç¨‹æ± é¢‘ç¹æ‰©å®¹ â†’ å¯èƒ½æ˜¯ corePoolSize è®¾ç½®å¤ªå°</li><li>å¦‚æœ keepAliveTime å¤ªçŸ­ï¼Œéæ ¸å¿ƒçº¿ç¨‹åˆšå¯åŠ¨å°±é”€æ¯äº† â†’ æµªè´¹èµ„æº</li></ul><p><strong>3.ç›‘æ§çº¿ç¨‹æ± </strong><br>å»ºè®®åœ¨çº¿ä¸Šéƒ¨ç½²æ—¶ï¼Œé…åˆä»¥ä¸‹æ‰‹æ®µï¼š</p><ul><li><p>ä½¿ç”¨ <code>ThreadPoolTaskExecutor</code>ï¼ˆSpringä¸­å¸¸ç”¨ï¼‰å¹¶æš´éœ²æŒ‡æ ‡</p></li><li><p>ç»“åˆ Prometheus + Grafana ç›‘æ§ï¼š</p><ul><li>æ´»è·ƒçº¿ç¨‹æ•°</li><li>é˜Ÿåˆ—å¤§å°</li><li>æ‹’ç»ä»»åŠ¡æ•°</li></ul></li><li><p>åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å‚æ•°ï¼ˆåŠ¨æ€çº¿ç¨‹æ± ï¼‰</p></li></ul><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>å¯¹Javaçº¿ç¨‹æ± çš„ç†è§£å’Œä½¿ç”¨ï¼Œæ˜¯æ¯ä½Javaç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½ã€‚</p><p>è¿™æ˜¯åç«¯é¢è¯•å¸¸é—®çš„é—®é¢˜ï¼Œå»ºè®®å„ä½ç»“åˆè‡ªå·±çš„é¡¹ç›®è¿›è¡Œå›ç­”ï¼Œé¢è¯•å®˜é—®ä½ çš„ä¼˜åŒ–æ–¹æ³•ä¹Ÿå¯ä»¥æœ‰æ›´å¤šçš„æ€è·¯ã€‚å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>Javaå¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>Javaå¹¶å‘ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æƒ³ä¸ºSeataç¤¾åŒºè¿›è¡Œè´¡çŒ®ï¼Ÿè¿™å‡ ç‚¹ä½ éœ€è¦äº†è§£</title>
    <link href="/2025/06/22/%E6%83%B3%E4%B8%BASeata%E7%A4%BE%E5%8C%BA%E8%BF%9B%E8%A1%8C%E8%B4%A1%E7%8C%AE%EF%BC%9F%E8%BF%99%E5%87%A0%E7%82%B9%E4%BD%A0%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3/"/>
    <url>/2025/06/22/%E6%83%B3%E4%B8%BASeata%E7%A4%BE%E5%8C%BA%E8%BF%9B%E8%A1%8C%E8%B4%A1%E7%8C%AE%EF%BC%9F%E8%BF%99%E5%87%A0%E7%82%B9%E4%BD%A0%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>å¾ˆå¤šæ–°äººæœ‹å‹éƒ½æƒ³åœ¨Githubä¸Šä¸ºå¼€æºç¤¾åŒºè¿›è¡Œè´¡çŒ®ï¼ˆåŒ…æ‹¬æˆ‘ï¼‰ï¼Œè€Œå…¶ä¸­seataç¤¾åŒºæ˜¯æ´»è·ƒåº¦ç›¸å¯¹è¾ƒé«˜çš„ç¤¾åŒºä¹‹ä¸€ï¼Œä½†æ˜¯ä¸€å¤´æ‰è¿›å»å®¹æ˜“ä¸€è„¸æ‡µï¼Œå¦‚æœä½ ä¹Ÿæƒ³ä¸ºseataè´¡çŒ®ä½ çš„ä»£ç ï¼Œä½ å¯ä»¥çœ‹çœ‹æˆ‘ä»¥ä¸‹æåˆ°çš„å‡ ç‚¹ï¼Œå…´è®¸ä½ ä¼šç”¨åˆ°ğŸ¤“</p><h1 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h1><p>ä½ å…ˆéœ€è¦å°†seataåº“forkä¸‹æ¥ï¼Œç„¶åä½ æ‰å¯ä»¥æäº¤ä»£ç åˆ°è‡ªå·±çš„forkåº“ï¼Œç„¶åè¿›è¡Œcloneï¼Œå°†æœ€æ–°ä»£ç æ‹‰å–åˆ°è‡ªå·±çš„ideaã€‚</p><p>ç„¶åéœ€è¦è®¾ç½®è¿œç¨‹ï¼Œæ–¹ä¾¿æ›´æ–°ä»£ç å·¥ä½œåŒºï¼Œ <strong>è®¾ç½®è¿œç¨‹</strong> å°†ä¸Šæ¸¸è®¾ç½®ä¸º <code>git@github.com:apache/incubator-seata.git</code> ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">git</span> <span class="hljs-string">remote</span> <span class="hljs-string">add</span> <span class="hljs-string">upstream</span> <span class="hljs-string">git</span>@<span class="hljs-string">github</span>.<span class="hljs-string">com:apache/</span><span class="hljs-string">incubator-seata</span>.<span class="hljs-string">git</span><br><span class="hljs-string">git</span> <span class="hljs-string">remote</span> <span class="hljs-built_in">set-url</span> <span class="hljs-built_in">--push</span> <span class="hljs-string">upstream</span> <span class="hljs-string">no-pushing</span><br></code></pre></td></tr></table></figure><h1 id="è¸©å‘ä¸€ğŸ˜¶â€ğŸŒ«ï¸"><a href="#è¸©å‘ä¸€ğŸ˜¶â€ğŸŒ«ï¸" class="headerlink" title="è¸©å‘ä¸€ğŸ˜¶â€ğŸŒ«ï¸"></a>è¸©å‘ä¸€ğŸ˜¶â€ğŸŒ«ï¸</h1><p>å½“ä½ å°†æºç æ‹‰ä¸‹æ¥ä¹‹åï¼Œå‘ç°å¯åŠ¨ä¸äº†ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç‰ˆæœ¬ä¸å¯¹ï¼Œæˆªæ­¢å‘æ–‡æ—¥æœŸï¼Œä½ èƒ½ä»æºç æ‹‰ä¸‹æ¥çš„ç‰ˆæœ¬æ˜¯2.5.0çš„å¿«ç…§ç‰ˆæœ¬ï¼Œè¿™æ ·å‡ºç°ä¾èµ–æ‰¾ä¸åˆ°çš„é—®é¢˜</p><p><img src="https://i-blog.csdnimg.cn/direct/a76fe7dbc27d41b38d1548675fd74f6c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦åœ¨seata-buildæ¨¡å—ä¸‹æ›´æ”¹pomæ–‡ä»¶ï¼Œä¸Šä¸€å›¾çš„ç‰ˆæœ¬æ”¹æˆ2.3.0å³å¯</p><p><img src="https://i-blog.csdnimg.cn/direct/b95cb557e8454f5490bcc2b8f14c3630.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="è¸©å‘äºŒğŸ˜­"><a href="#è¸©å‘äºŒğŸ˜­" class="headerlink" title="è¸©å‘äºŒğŸ˜­"></a>è¸©å‘äºŒğŸ˜­</h1><p>å½“ä½ ä»¥ä¸ºç»ˆäºå¯ä»¥å¯åŠ¨çš„æ—¶å€™ï¼Œç°å®ä¼šç»™ä½ ä¸€æ£’â€¦</p><p>è¿™ä¸ªVersionInfoä¼šæ‰¾ä¸åˆ°ç±»<br><img src="https://i-blog.csdnimg.cn/direct/ceab2837e1e64135ad0800e3874552b9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼€å¯å…¨å±€æœç´¢ï¼Œä½ å¯ä»¥æ‰¾åˆ°seata-coreæ¨¡å—ï¼Œåœ¨org.apache.seata.core.protocolåŒ…ä¸‹ï¼Œä½ å¯ä»¥æ‰¾åˆ°VersionInfo.java.templateè¿™ä¸ªæ–‡ä»¶ï¼Œä½ è¦ç›¸ä¿¡ä»»ä½•ä¸œè¥¿ä¸æ˜¯æ— ç¼˜æ— æ•…çš„å°±ä¼šå‡ºç°åœ¨è¿™çš„ï¼Œå°†å…¶å¤åˆ¶ä¸€ä»½ï¼Œæ”¹æˆVersionInfo.javaï¼Œæ”¾åœ¨åŒä½ç½®å³å¯</p><p><img src="https://i-blog.csdnimg.cn/direct/c23188597fd0409dad67fbab2bd1dfb8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="è¸©å‘ä¸‰ğŸ˜µ"><a href="#è¸©å‘ä¸‰ğŸ˜µ" class="headerlink" title="è¸©å‘ä¸‰ğŸ˜µ"></a>è¸©å‘ä¸‰ğŸ˜µ</h1><p><strong><code>org.apache.seata.core.protocol.generated</code> åŒ…ä¸å­˜åœ¨</strong></p><p>å½“ä½ å†æ¬¡å¯åŠ¨ï¼Œä¼šå‘ç°æ‰¾ä¸åˆ°è¿™ä¸ªç¨‹åºåŒ…ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºGrpcï¼Œéœ€è¦æ’ä»¶ç¼–è¯‘protoæ–‡ä»¶æˆjavaæ–‡ä»¶æ‰å¯ä»¥æ‰¾åˆ°ï¼Œç‚¹å‡»ä¸‹é¢é‚£ä¸ªç¼–è¯‘å³å¯</p><p><img src="https://i-blog.csdnimg.cn/direct/65c77174f40c4c699322627677a121a0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åå°†ç”Ÿæˆç±»çš„javaç›®å½•å³é”®æˆæºç ç›®å½•å³å¯</p><p><img src="https://i-blog.csdnimg.cn/direct/b02bf02762a4487e8acb2eeb1ba1e547.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™å°±æ˜¯ä¸€äº›è¿›è¡Œseataå¼€æºæ—¶ä¼šè¸©åˆ°çš„ä¸€äº›å‘ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>Seata</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>Seata</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•å›ç­”å–œæ¬¢ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œé¢è¯•å®˜å¾ˆæ»¡æ„...</title>
    <link href="/2025/06/22/%E9%9D%A2%E8%AF%95%E5%9B%9E%E7%AD%94%E5%96%9C%E6%AC%A2%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5%EF%BC%8C%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BE%88%E6%BB%A1%E6%84%8F/"/>
    <url>/2025/06/22/%E9%9D%A2%E8%AF%95%E5%9B%9E%E7%AD%94%E5%96%9C%E6%AC%A2%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5%EF%BC%8C%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BE%88%E6%BB%A1%E6%84%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>å¤§å®¶åœ¨SpringBooté¡¹ç›®å¼€å‘ä¸­è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶ï¼Œæ˜¯ä¸æ˜¯éƒ½å–œæ¬¢ç”¨å­—æ®µæ³¨å…¥å‘¢ï¼Ÿå³ä½¿ç”¨<code>@Autowired</code>ï¼Œ<code>@Resource</code>ã€‚æ²¡é”™ï¼Œè¿™ç§æ–¹å¼æœ€ç®€å•ä¸ç®€æ´ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨é¢è¯•ä¸­ï¼Œé¢è¯•å®˜é—®èµ·ä½ æœ‰å…³ä¾èµ–æ³¨å…¥çš„é—®é¢˜æ—¶ï¼Œæœ€å¥½ä¸è¦å›ç­”ç”¨å­—æ®µæ³¨å…¥å‘¢ï¼Ÿè€Œæ˜¯å›ç­”ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€èµ·æ¥æ¢è®¨ä¸€ä¸‹å¸¸è§çš„ä¸‰ç§ä¾èµ–æ³¨å…¥æ–¹å¼ã€‚</p><h1 id="å­—æ®µæ³¨å…¥-Field-Injection-ğŸ˜µ"><a href="#å­—æ®µæ³¨å…¥-Field-Injection-ğŸ˜µ" class="headerlink" title="å­—æ®µæ³¨å…¥(Field Injection)ğŸ˜µ"></a>å­—æ®µæ³¨å…¥(Field Injection)ğŸ˜µ</h1><p>å­—æ®µæ³¨å…¥ï¼ˆField Injectionï¼‰æ˜¯Springæ¡†æ¶ä¸­ä¾èµ–æ³¨å…¥çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒå…è®¸å¼€å‘è€…ç›´æ¥åœ¨ç±»çš„å­—æ®µä¸Šä½¿ç”¨<code>@Autowired</code>æˆ–è€…<code>@Resource</code>æ³¨è§£æ¥è‡ªåŠ¨è£…é…ä¾èµ–ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•ä¾‹å­æ¥ç¤ºä¾‹æ€ä¹ˆä½¿ç”¨å­—æ®µæ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Dependency dependency;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performAction</span><span class="hljs-params">()</span> &#123;<br>        dependency.doSomething();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“è¿™ä¸ªç±»ä¸Šé¢åŠ äº†æ³¨è§£@Serviceï¼ŒSpringå°±ä¼šå°†å…¶å½“æˆä¸€ä¸ªBeanå®ä¾‹åŒ–åˆ°å®¹å™¨ä¸­æ–¹ä¾¿å–ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¤šæ¬¡åˆ›å»ºæˆ–è€…é”€æ¯åŒä¸€ä¸ªç±»å¯¹è±¡ï¼Œæ–¹ä¾¿å¤ç”¨ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyService</code> ç±»æœ‰ä¸€ä¸ª <code>Dependency</code> ç±»å‹çš„ä¾èµ–ï¼Œé€šè¿‡åœ¨å­—æ®µä¸Šæ·»åŠ  <code>@Autowired</code> æ³¨è§£ï¼ŒSpring ä¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸­å¯»æ‰¾Beanï¼Œå°†åˆé€‚çš„ <code>Dependency</code> Bean æ³¨å…¥åˆ°è¿™ä¸ªå­—æ®µä¸­ã€‚</p><p><strong><code>@Autowired</code>å’Œ<code>@Resource</code>çš„åŒºåˆ«</strong></p><p>ç®€å•æ¥è¯´ï¼Œ<code>@Autowired</code>é»˜è®¤æ—¶é€šè¿‡ç±»å‹åŒ¹é…æ¥è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œè€Œ<code>@Resource</code>é»˜è®¤æ˜¯é€šè¿‡åŸºäºåç§°æ¥è¿›è¡Œæ³¨å…¥ï¼ˆæ˜¯æŒ‡beanåœ¨å®¹å™¨é‡Œé¢çš„åç§°ğŸ¥¹ï¼‰ï¼Œæ‰€ä»¥ä½ åœ¨ä½¿ç”¨<code>@Resource</code>æ—¶ï¼Œæœ€å¥½æ¸…æ¥šæŒ‡å®šbeanåœ¨å®¹å™¨ä¸­çš„åç§°å“¦ã€‚</p><ol><li><code>@Resource</code> åªèƒ½ç”¨äºå­—æ®µæˆ– setter æ–¹æ³•ä¸Šï¼Œä¸èƒ½ç”¨åœ¨æ„é€ å™¨ä¸Šã€‚</li><li>å¦‚æœä½ æ²¡æœ‰æŒ‡å®š <code>name</code> å±æ€§ï¼ŒSpring ä¼šå°è¯•ä½¿ç”¨å­—æ®µåæˆ– setter æ–¹æ³•çš„å±æ€§åä½œä¸º Bean åç§°è¿›è¡ŒåŒ¹é…ã€‚</li><li>å½“æ‰¾ä¸åˆ°åç§°åŒ¹é…çš„ Bean æ—¶ï¼Œ<code>@Resource</code> <strong>ä¸ä¼šå›é€€åˆ°æŒ‰ç±»å‹åŒ¹é…</strong></li></ol><h1 id="è®¾å€¼æ–¹æ³•æ³¨å…¥-Setter-Injection-ğŸ¤¤"><a href="#è®¾å€¼æ–¹æ³•æ³¨å…¥-Setter-Injection-ğŸ¤¤" class="headerlink" title="è®¾å€¼æ–¹æ³•æ³¨å…¥ (Setter Injection)ğŸ¤¤"></a>è®¾å€¼æ–¹æ³•æ³¨å…¥ (Setter Injection)ğŸ¤¤</h1><p>Setteræ³¨å…¥é€šè¿‡ç±»çš„setteræ–¹æ³•æ¥ä¸ºç±»æä¾›æ‰€éœ€çš„ä¾èµ–ã€‚è¿™ç§æ–¹å¼ä¸æ„é€ å™¨æ³¨å…¥ç›¸æ¯”ï¼Œå…·æœ‰ä¸€å®šçš„çµæ´»æ€§ï¼Œç‰¹åˆ«é€‚åˆäºé‚£äº›ä¾èµ–é¡¹å¯é€‰æˆ–è€…å¸Œæœ›åœ¨å¯¹è±¡åˆ›å»ºä¹‹åèƒ½å¤Ÿ<strong>ä¿®æ”¹ä¾èµ–</strong>çš„æƒ…å†µã€‚</p><p><strong>Tipsï¼š</strong> Setteræ³¨å…¥é€šå¸¸éµå¾ªJavaBeanè§„èŒƒï¼Œä»¥<code>set</code>å¼€å¤´ï¼Œåè·Ÿå±æ€§åï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªå‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Dependency dependency;<br><br>    <span class="hljs-comment">// Setteræ³¨å…¥</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDependency</span><span class="hljs-params">(Dependency dependency)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dependency = dependency;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performAction</span><span class="hljs-params">()</span> &#123;<br>        dependency.doSomething();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyService</code> ç±»æœ‰ä¸€ä¸ª <code>Dependency</code> ç±»å‹çš„ä¾èµ–ï¼Œé€šè¿‡å¸¦æœ‰ <code>@Autowired</code> æ³¨è§£çš„ setter æ–¹æ³• <code>setDependency</code> æ¥æ³¨å…¥è¿™ä¸ªä¾èµ–</p><ol><li><strong>çµæ´»æ€§</strong>ï¼šå…è®¸åœ¨å¯¹è±¡åˆ›å»ºä¹‹åæ›´æ”¹ä¾èµ–å…³ç³»ï¼Œè¿™å¯¹äºä¸€äº›éœ€è¦åŠ¨æ€æ”¹å˜ä¾èµ–çš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚</li><li><strong>å¯é€‰ä¾èµ–</strong>ï¼šå¦‚æœæŸä¸ªä¾èµ–ä¸æ˜¯å¿…é¡»çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¸ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£ï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰ä¸€ä¸ªæ™®é€šçš„ setter æ–¹æ³•ï¼Œè¿™æ ·å³ä½¿æ²¡æœ‰é…ç½®ç›¸åº”çš„ Beanï¼Œåº”ç”¨ä¹Ÿä¸ä¼šå‡ºé”™</li></ol><p><strong>è¯·æ³¨æ„ï¼š</strong> å³ä½¿Springæ”¯æŒsetteræ³¨å…¥å¯ä»¥å¸®åŠ©è§£å†³æŸäº›ç±»å‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½†åº”å°½é‡é¿å…è®¾è®¡ä¸Šå‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µğŸ˜µ</p><h1 id="æ„é€ å™¨æ³¨å…¥-Constructor-Injection-ğŸ¤©"><a href="#æ„é€ å™¨æ³¨å…¥-Constructor-Injection-ğŸ¤©" class="headerlink" title="æ„é€ å™¨æ³¨å…¥ (Constructor Injection)ğŸ¤©"></a>æ„é€ å™¨æ³¨å…¥ (Constructor Injection)ğŸ¤©</h1><p><strong>æ„é€ å™¨æ³¨å…¥</strong> æ˜¯ Spring ä¸­æœ€æ¨èçš„ä¾èµ–æ³¨å…¥æ–¹å¼ä¹‹ä¸€ã€‚å®ƒé€šè¿‡ç±»çš„æ„é€ å‡½æ•°ï¼ˆæ„é€ å™¨ï¼‰æ¥æ³¨å…¥ä¾èµ–å¯¹è±¡ã€‚Spring å®¹å™¨åœ¨åˆ›å»º Bean å®ä¾‹æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨åˆé€‚çš„æ„é€ å™¨ï¼Œå¹¶å°†æ‰€éœ€çš„ä¾èµ–ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Dependency dependency;<br><br>    <span class="hljs-comment">// æ„é€ å™¨æ³¨å…¥</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyService</span><span class="hljs-params">(Dependency dependency)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dependency = dependency;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performAction</span><span class="hljs-params">()</span> &#123;<br>        dependency.doSomething();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MyService</code> ç±»éœ€è¦ä¸€ä¸ª <code>Dependency</code> ç±»å‹çš„ä¾èµ–ï¼Œä½¿ç”¨æ„é€ å™¨æ³¨å…¥åï¼Œè¯¥ä¾èµ–åœ¨å¯¹è±¡åˆå§‹åŒ–æ—¶å°±è¢«è®¾ç½®å¥½äº†ï¼Œä½†è¯·æ³¨æ„ï¼šä» <strong>Spring 4.3 åŠä»¥ä¸Šç‰ˆæœ¬</strong> å¼€å§‹ï¼Œå¦‚æœç±»åªæœ‰ä¸€ä¸ªæ„é€ å™¨ï¼Œ<strong>å¯ä»¥çœç•¥ <code>@Autowired</code> æ³¨è§£</strong>ï¼ŒSpring ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä½¿ç”¨è¯¥æ„é€ å™¨æ³¨å…¥ä¾èµ–ã€‚</p><h1 id="ä¸ºä»€ä¹ˆè¯´æ„é€ å™¨æ³¨å…¥æ˜¯æœ€æ¨èçš„ä¸€ç§ä¾èµ–æ³¨å…¥æ–¹å¼ğŸ¤“"><a href="#ä¸ºä»€ä¹ˆè¯´æ„é€ å™¨æ³¨å…¥æ˜¯æœ€æ¨èçš„ä¸€ç§ä¾èµ–æ³¨å…¥æ–¹å¼ğŸ¤“" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´æ„é€ å™¨æ³¨å…¥æ˜¯æœ€æ¨èçš„ä¸€ç§ä¾èµ–æ³¨å…¥æ–¹å¼ğŸ¤“"></a>ä¸ºä»€ä¹ˆè¯´æ„é€ å™¨æ³¨å…¥æ˜¯æœ€æ¨èçš„ä¸€ç§ä¾èµ–æ³¨å…¥æ–¹å¼ğŸ¤“</h1><h2 id="ä¿è¯ä¸å¯å˜æ€§"><a href="#ä¿è¯ä¸å¯å˜æ€§" class="headerlink" title="ä¿è¯ä¸å¯å˜æ€§"></a>ä¿è¯ä¸å¯å˜æ€§</h2><p>ä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œå¯ä»¥å°†ä¾èµ–é¡¹å£°æ˜ä¸º<code>final</code>å­—æ®µã€‚è¿™æ„å‘³ç€ä¸€æ—¦å¯¹è±¡è¢«åˆ›å»ºåï¼Œå®ƒçš„ä¾èµ–å°±ä¸ä¼šå†æ”¹å˜ã€‚è¿™ç§ä¸å˜æ€§æœ‰åŠ©äºç¡®ä¿å¯¹è±¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…çš„çŠ¶æ€ä¸€è‡´æ€§ï¼Œä»è€Œå‡å°‘æ½œåœ¨çš„é”™è¯¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Dependency dependency;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyService</span><span class="hljs-params">(Dependency dependency)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dependency = dependency;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>dependency</code> å­—æ®µæ˜¯ <code>final</code> çš„ï¼Œæ„å‘³ç€å®ƒåœ¨å¯¹è±¡è¢«åˆ›å»ºä¹‹åä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™å¢å¼ºäº†ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚è¿™åœ¨å®æˆ˜ä¸­ä¸€èˆ¬é€šè¿‡ä½¿ç”¨ <code>final</code> å…³é”®å­—å®šä¹‰ä¾èµ–ï¼Œé˜²æ­¢å®ƒä»¬åœ¨å¯¹è±¡åˆ›å»ºä¹‹åè¢«ä¿®æ”¹ã€‚</p><h2 id="ä¿è¯ä¾èµ–å®Œæ•´æ€§"><a href="#ä¿è¯ä¾èµ–å®Œæ•´æ€§" class="headerlink" title="ä¿è¯ä¾èµ–å®Œæ•´æ€§"></a>ä¿è¯ä¾èµ–å®Œæ•´æ€§</h2><p>æ‰€æœ‰å¿…é¡»çš„ä¾èµ–éƒ½åœ¨æ„é€ å™¨ä¸­å£°æ˜ï¼Œä¿è¯äº†ç±»åœ¨ä½¿ç”¨å‰å°±å…·å¤‡æ‰€æœ‰å¿…éœ€çš„ä¾èµ–ã€‚è¿™æ ·é”™è¯¯å°±å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ä»¥æ£€æµ‹å‡ºæ¥ï¼Œé˜²æ­¢åº”ç”¨åœ¨è¿è¡Œæ—¶å‡ºç°é”™è¯¯ï¼Œä¹Ÿå°±é¿å…äº†å› ä¾èµ–æœªæ³¨å…¥è€Œå¯¼è‡´çš„ <code>NullPointerException</code> ç­‰è¿è¡Œæ—¶é”™è¯¯ã€‚</p><h2 id="æ˜“äºå•å…ƒæµ‹è¯•"><a href="#æ˜“äºå•å…ƒæµ‹è¯•" class="headerlink" title="æ˜“äºå•å…ƒæµ‹è¯•"></a>æ˜“äºå•å…ƒæµ‹è¯•</h2><p>ç”±äºä¾èµ–æ˜¯é€šè¿‡æ„é€ å™¨ä¼ å…¥çš„ï¼Œä½ å¯ä»¥åœ¨æµ‹è¯•ä¸­è½»æ¾åœ°ä¼ å…¥æ¨¡æ‹Ÿå¯¹è±¡ï¼ˆmockï¼‰ï¼Œè€Œä¸éœ€è¦ä¾èµ– Spring å®¹å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testMyService</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Dependency</span> <span class="hljs-variable">mockDependency</span> <span class="hljs-operator">=</span> Mockito.mock(Dependency.class);<br>    <span class="hljs-type">MyService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyService</span>(mockDependency); <span class="hljs-comment">// æ‰‹åŠ¨æ³¨å…¥</span><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ˜ç¡®APIè®¾è®¡"><a href="#æ˜ç¡®APIè®¾è®¡" class="headerlink" title="æ˜ç¡®APIè®¾è®¡"></a>æ˜ç¡®APIè®¾è®¡</h2><p>æ„é€ å™¨æ¸…æ¥šåœ°è¡¨æ˜äº†ä¸€ä¸ªç±»æ‰€ä¾èµ–çš„å¯¹è±¡ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ï¼ˆè¿™å¯¹äºå›¢é˜Ÿåä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œä½ ä¹Ÿä¸æƒ³è¢«å…¶ä»–å¥½åšç±³æš´æ‰“å§ğŸ¤£ï¼‰</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è™½ç„¶è¯´æ„é€ å™¨æ³¨å…¥ååˆ†æ¨èä½¿ç”¨ï¼Œä½†è¿˜æ˜¯è¦å…·ä½“æƒ…å†µå…·ä½“å®è·µï¼Œå› ä¸ºæ„é€ å™¨æ³¨å…¥ä¹Ÿæœ‰å…¶ä¸è¶³ä¹‹å¤„ï¼Œæ¯”å¦‚è¦å¯é€‰ä¾èµ–æ—¶ï¼Œè¿™ç§æƒ…å†µæ›´é€‚åˆä½¿ç”¨ setter æ³¨å…¥ã€‚å¦‚æœä¾èµ–è¿‡å¤šï¼Œæ„é€ å™¨å‚æ•°åˆ—è¡¨ä¼šå˜å¾—å†—é•¿ï¼Œå½±å“å¯è¯»æ€§ç­‰é—®é¢˜ï¼Œä¹Ÿå¯ä»¥å°è¯•ç”¨å­—æ®µæ³¨å…¥æˆ–è€…Builderæ¨¡å¼ä¼˜åŒ–ã€‚æ€»ä¹‹ä¸€å¥è¯ï¼Œå…·ä½“æƒ…å†µå…·ä½“å®è·µï¼</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•å®˜é—®æˆ‘ï¼šåº“å­˜é¢„æ‰£å‡ä¹‹åï¼Œç”¨æˆ·è®¢å•è¶…æ—¶ä¹‹åæ€ä¹ˆè¡¥å¿åº“å­˜ï¼Ÿæˆ‘çš„æ–¹æ¡ˆè®©ä»–æ»¡æ„...</title>
    <link href="/2025/06/22/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%E6%88%91%EF%BC%9A%E5%BA%93%E5%AD%98%E9%A2%84%E6%89%A3%E5%87%8F%E4%B9%8B%E5%90%8E%EF%BC%8C%E7%94%A8%E6%88%B7%E8%AE%A2%E5%8D%95%E8%B6%85%E6%97%B6%E4%B9%8B%E5%90%8E%E6%80%8E%E4%B9%88%E8%A1%A5%E5%81%BF%E5%BA%93%E5%AD%98%EF%BC%9F%E6%88%91%E7%9A%84%E6%96%B9%E6%A1%88%E8%AE%A9%E4%BB%96%E6%BB%A1%E6%84%8F/"/>
    <url>/2025/06/22/%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%E6%88%91%EF%BC%9A%E5%BA%93%E5%AD%98%E9%A2%84%E6%89%A3%E5%87%8F%E4%B9%8B%E5%90%8E%EF%BC%8C%E7%94%A8%E6%88%B7%E8%AE%A2%E5%8D%95%E8%B6%85%E6%97%B6%E4%B9%8B%E5%90%8E%E6%80%8E%E4%B9%88%E8%A1%A5%E5%81%BF%E5%BA%93%E5%AD%98%EF%BC%9F%E6%88%91%E7%9A%84%E6%96%B9%E6%A1%88%E8%AE%A9%E4%BB%96%E6%BB%A1%E6%84%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åœ¨åç«¯å¼€å‘å’Œé¢è¯•ä¸­ï¼Œå¦‚æœæ˜¯åšç±»ä¼¼ç§’æ€å’Œå•†åŸç­‰ä¸šåŠ¡æ—¶ï¼Œæˆ‘ä»¬éš¾å…ä¼šé‡åˆ°å…³äºè®¢å•è¶…æ—¶äº†ï¼Œä½†æ˜¯Redisé‡Œé¢çš„åº“å­˜å·²ç»é¢„æ‰£å‡äº†ï¼Œé‚£ä¹ˆå¦‚ä½•æŠŠé¢„æ‰£å‡çš„åº“å­˜è¿›è¡Œè¡¥å¿å‘¢ï¼Ÿä¸‹é¢å’Œå¤§å®¶è®¨è®ºå‡ ç§æ¯”è¾ƒå¸¸è§å¸¸ç”¨çš„æ–¹æ¡ˆã€‚</p><h1 id="ä¸ºä»€ä¹ˆè¦è¡¥å¿é¢„æ‰£å‡çš„åº“å­˜ï¼ŸğŸ˜µ"><a href="#ä¸ºä»€ä¹ˆè¦è¡¥å¿é¢„æ‰£å‡çš„åº“å­˜ï¼ŸğŸ˜µ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¡¥å¿é¢„æ‰£å‡çš„åº“å­˜ï¼ŸğŸ˜µ"></a>ä¸ºä»€ä¹ˆè¦è¡¥å¿é¢„æ‰£å‡çš„åº“å­˜ï¼ŸğŸ˜µ</h1><p>å¤äººå¸¸è¯´ï¼Œè¦åšä¸€ä»¶äº‹ä¹‹å‰ï¼Œå…ˆè¦æ¸…æ¥šä¸ºä»€ä¹ˆè¦åšè¿™ä»¶äº‹ï¼Œå†å»æƒ³è§£å†³è¿™ä»¶äº‹çš„æ–¹æ¡ˆã€‚æˆ‘è®¤ä¸ºè¿™ç§è¯´æ³•ä¹Ÿæ˜¯å¯¹çš„ï¼Œåªæœ‰å…ˆæ¸…æ¥šä¸ºä»€ä¹ˆè¦è¡¥å¿é¢„æ‰£å‡çš„åº“å­˜ï¼Œæ‰èƒ½è·å¾—è§£å†³æ–¹æ¡ˆçš„çµæ„Ÿã€‚</p><p>åœ¨ä¸€ä¸ªç§’æ€ä¸šåŠ¡ä¸­ï¼Œå¤§å®¶ä¸€èµ·æ¥æŠ¢è´­è¿™ç§å•†å“ï¼Œä½†æ˜¯å•†å“æ•°é¢æœ‰é™ã€‚ä¸€ä½ç”¨æˆ·ç‡å…ˆæŠ¢åˆ°è¿™ä¸ªå•†å“ï¼Œå·²ç»æˆåŠŸä¸‹å•ï¼ˆå³å·²ç»æœ‰äº†è®¢å•å·ï¼‰ï¼Œä½†æ˜¯å°šæœªç»“æ¬¾ï¼Œä¹Ÿå°±ä»£è¡¨æ•°æ®åº“è¿˜æ²¡æœ‰çœŸæ­£è½åº“æ‰£å‡è¿™ä¸ªå•†å“ï¼Œåªæ˜¯åœ¨Redisè¿›è¡Œé¢„æ‰£å‡äº†è¿™ä»¶åº“å­˜ã€‚è¯¥ç”¨æˆ·åœ¨åæ¥çš„ä¸€æ®µæ—¶é—´å› ä¸ºæŸäº‹å¿˜è®°äº†ä»˜æ¬¾ï¼Œå³è®¢å•è¶…æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æŠŠè¿™ä¸ªRedisä¸­é¢„æ‰£å‡çš„åº“å­˜è¡¥å¿å›Redisä¸­ï¼Œå¦åˆ™å°±ä¼šé€ æˆåæ¥çš„ç”¨æˆ·æ— æ³•ç»§ç»­æŠ¢è´­ï¼Œä¹Ÿå°±æ˜¯å°‘å–ç°è±¡ï¼Œä¼šç»™å•†å®¶åˆ©ç›Šé€ æˆæŸå¤±ã€‚</p><h1 id="æ–¹æ¡ˆä¸€ï¼šRedisçš„è¿‡æœŸç›‘å¬ğŸ¤¤"><a href="#æ–¹æ¡ˆä¸€ï¼šRedisçš„è¿‡æœŸç›‘å¬ğŸ¤¤" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šRedisçš„è¿‡æœŸç›‘å¬ğŸ¤¤"></a>æ–¹æ¡ˆä¸€ï¼šRedisçš„è¿‡æœŸç›‘å¬ğŸ¤¤</h1><p>åœ¨redisé‡Œé¢ä¸­ï¼Œkeyå¯ä»¥è®¾è¿‡æœŸæ—¶é—´ï¼Œè¿™å°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ€è·¯ï¼šæˆ‘ä»¬å¯ä»¥ç»™é¢„æ‰£å‡çš„åº“å­˜é”®è®¾ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨redisçš„å‘å¸ƒè®¢é˜…æœºåˆ¶æ¥ç›‘å¬é”®è¿‡æœŸäº‹ä»¶ï¼Œä»è€Œè‡ªåŠ¨è§¦å‘å›å¢åº“å­˜çš„é€»è¾‘</p><p> åŠŸèƒ½ç›®æ ‡ï¼š</p><ul><li>ç›‘å¬ Redis ä¸­æ‰€æœ‰ä»¥ <code>product:</code> å¼€å¤´çš„å•†å“ key çš„è¿‡æœŸäº‹ä»¶ã€‚</li><li>ä¸€æ—¦æŸä¸ªå•†å“ key è¿‡æœŸï¼ˆæ¯”å¦‚ç”¨æˆ·è¶…æ—¶æœªæ”¯ä»˜ï¼‰ï¼Œè‡ªåŠ¨æ‰§è¡Œåº“å­˜å›è¡¥ï¼ˆ<code>INCR</code>ï¼‰æ“ä½œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonStockExpiredListener</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <br>        <span class="hljs-comment">// æ¨¡æ‹Ÿé¢„æ‰£å‡åº“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">productKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;product:1001:stock&quot;</span>;<br>        <span class="hljs-type">RBatch</span> <span class="hljs-variable">batch</span> <span class="hljs-operator">=</span> redisson.getBatch();<br>        batch.get(productKey).setAsync(<span class="hljs-number">100L</span>);           <span class="hljs-comment">// åˆå§‹åŒ–åº“å­˜</span><br>        batch.get(productKey).decrementAsync();         <span class="hljs-comment">// é¢„æ‰£å‡</span><br>        batch.get(productKey).expireAsync(<span class="hljs-number">5</span>, TimeUnit.SECONDS); <span class="hljs-comment">// è®¾ç½®5ç§’è¿‡æœŸ</span><br>        batch.execute();<br><br>        System.out.println(<span class="hljs-string">&quot;å·²é¢„æ‰£å‡åº“å­˜ï¼Œå¹¶è®¾ç½®5ç§’åè¿‡æœŸ&quot;</span>);<br><br>        <span class="hljs-comment">// è®¢é˜… Redis çš„ key è¿‡æœŸäº‹ä»¶</span><br>        <span class="hljs-type">RTopic</span> <span class="hljs-variable">topic</span> <span class="hljs-operator">=</span> redisson.getTopic(<span class="hljs-string">&quot;__keyevent@*:expired&quot;</span>);<br>        topic.addListener(String.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListener</span>&lt;String&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(CharSequence channel, String key)</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;ç›‘å¬åˆ° key è¿‡æœŸï¼š&quot;</span> + key);<br><br>                <span class="hljs-keyword">if</span> (key != <span class="hljs-literal">null</span> &amp;&amp; key.startsWith(<span class="hljs-string">&quot;product:&quot;</span>)) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;å¤„ç†å•†å“ key è¿‡æœŸï¼Œå‡†å¤‡è¡¥å¿åº“å­˜...&quot;</span>);<br><br>                    <span class="hljs-comment">// è¡¥å¿åº“å­˜ï¼šINCR</span><br>                    <span class="hljs-type">RAtomicLong</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> redisson.getAtomicLong(key);<br>                    <span class="hljs-type">long</span> <span class="hljs-variable">newStock</span> <span class="hljs-operator">=</span> stock.incrementAndGet(); <span class="hljs-comment">// INCR</span><br>                    System.out.println(<span class="hljs-string">&quot;åº“å­˜å·²è¡¥å¿ï¼Œå½“å‰åº“å­˜ï¼š&quot;</span> + newStock);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    System.out.println(<span class="hljs-string">&quot;å¿½ç•¥éå•†å“ keyï¼š&quot;</span> + key);<br>                &#125;<br>            &#125;<br>        &#125;);<br><br>        System.out.println(<span class="hljs-string">&quot;æ­£åœ¨ç›‘å¬ Redis key è¿‡æœŸäº‹ä»¶...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯å®æ—¶æ€§å¼ºï¼Œå¯¹è¦æ±‚å®æ—¶æ€§é«˜çš„ä¸šåŠ¡æ¯”è¾ƒå‹å¥½ï¼Œå¦‚æŠ¢ç¥¨ç­‰ã€‚ç¼ºç‚¹æ˜¯è¿‡äºä¾é Redisï¼Œé£é™©ä¸èƒ½åˆ†æ‘Šã€‚ä¸”å®¹æ˜“é€ æˆå¤§é‡è¿‡æœŸKeyé—®é¢˜ï¼Œå½±å“æ€§èƒ½ã€‚</p><h1 id="æ–¹æ¡ˆäºŒï¼šRedisçš„å»¶æ—¶é˜Ÿåˆ—ğŸ˜‰"><a href="#æ–¹æ¡ˆäºŒï¼šRedisçš„å»¶æ—¶é˜Ÿåˆ—ğŸ˜‰" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šRedisçš„å»¶æ—¶é˜Ÿåˆ—ğŸ˜‰"></a>æ–¹æ¡ˆäºŒï¼šRedisçš„å»¶æ—¶é˜Ÿåˆ—ğŸ˜‰</h1><p>æˆ‘ä»¬å¯ä»¥åŸºäºRedisçš„Sorted Setæ•°æ®ç±»å‹æ¥åšä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—ï¼Œé€šè¿‡scoreæ¥è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬æœåŠ¡ç«¯ä¸‹å•æ—¶åœ¨å½“å‰æ—¶é—´åŠ ä¸Šè¶…æ—¶æ—¶é—´ï¼Œå°†è®¢å•IDæ”¾å…¥è¿›å»ï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡æ¥å®šé‡æ‹¿å–è¶…æ—¶è®¢å•è¿›è¡Œå–æ¶ˆè®¢å•+è¡¥å¿åº“å­˜ã€‚</p><p><strong>æ·»åŠ è®¢å•åˆ°å»¶æ—¶é˜Ÿåˆ—</strong></p><ul><li>å½“ç”¨æˆ·ä¸‹å•ä½†æœªæ”¯ä»˜æ—¶ï¼Œè®¡ç®—å‡ºè®¢å•çš„è¶…æ—¶æ—¶é—´ï¼ˆä¾‹å¦‚ï¼šå½“å‰æ—¶é—´ + 30 åˆ†é’Ÿï¼‰ï¼Œç„¶åå°†è®¢å• ID ä»¥è¿™ä¸ªæ—¶é—´ä¸º score æ·»åŠ åˆ° Redis Sorted Set ä¸­ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">RScoredSortedSet&lt;String&gt; delayedQueue = redisson.getScoredSortedSet(<span class="hljs-string">&quot;delayed:order:queue&quot;</span>);<br><span class="hljs-type">long</span> <span class="hljs-variable">timeoutTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() + TimeUnit.MINUTES.toMillis(<span class="hljs-number">30</span>); <span class="hljs-comment">// 30åˆ†é’Ÿåè¶…æ—¶</span><br>delayedQueue.add(timeoutTime, orderId);<br></code></pre></td></tr></table></figure><p><strong>å®šæ—¶ä»»åŠ¡æ£€æŸ¥å¹¶å¤„ç†è¶…æ—¶è®¢å•</strong></p><ul><li><p>å®šæœŸè¿è¡Œä¸€ä¸ªåå°ä»»åŠ¡ï¼Œä½¿ç”¨ <code>ZRANGEBYSCORE</code> è·å–æ‰€æœ‰å·²ç»åˆ°æœŸçš„è®¢å•ï¼ˆå³ score å°äºç­‰äºå½“å‰æ—¶é—´æˆ³çš„æ‰€æœ‰è®¢å•ï¼‰ã€‚</p></li><li><p>å¯¹äºæ¯ä¸ªæ‰¾åˆ°çš„è®¢å•ï¼Œæ‰§è¡Œå–æ¶ˆè®¢å•å’Œè¡¥å¿åº“å­˜çš„æ“ä½œï¼Œå¹¶ä» Sorted Set ä¸­ç§»é™¤è¿™äº›è®¢å•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>Collection&lt;String&gt; expiredOrders = delayedQueue.valueRange(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, currentTime, <span class="hljs-literal">false</span>);<br><span class="hljs-keyword">for</span> (String orderId : expiredOrders) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// æ‰§è¡Œå–æ¶ˆè®¢å•é€»è¾‘</span><br>        cancelOrder(orderId);<br><br>        <span class="hljs-comment">// è¡¥å¿åº“å­˜é€»è¾‘</span><br>        restoreStock(orderId);<br>        <br>        <span class="hljs-comment">// ä»å»¶è¿Ÿé˜Ÿåˆ—ä¸­åˆ é™¤è¯¥è®¢å•</span><br>        delayedQueue.remove(orderId);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-comment">// å¼‚å¸¸å¤„ç†</span><br>        logger.error(<span class="hljs-string">&quot;å¤„ç†è¶…æ—¶è®¢å•å¤±è´¥: &#123;&#125;&quot;</span>, orderId, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p> è¿™æ ·çš„æ–¹æ¡ˆä¼˜ç‚¹å’Œæ–¹æ¡ˆä¸€å·®ä¸å¤šï¼Œå®æ—¶æ€§å¥½å»¶è¿Ÿå°ï¼Œä½†æ˜¯å°±æ˜¯è¿‡äºä¾é Redisï¼Œæœ‰æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚è€Œä¸”Redisæ˜¯åŸºäºå†…å­˜çš„ï¼Œå¦‚æœè¶…æ—¶è®¢å•è¿‡å¤šå¯¹Rediså‹åŠ›è¿‡å¤§ï¼Œå®¹æ˜“æŒ‚æœºã€‚</p><h1 id="æ–¹æ¡ˆä¸‰ï¼šMQçš„å»¶æ—¶æ¶ˆæ¯ğŸ¤©"><a href="#æ–¹æ¡ˆä¸‰ï¼šMQçš„å»¶æ—¶æ¶ˆæ¯ğŸ¤©" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šMQçš„å»¶æ—¶æ¶ˆæ¯ğŸ¤©"></a>æ–¹æ¡ˆä¸‰ï¼šMQçš„å»¶æ—¶æ¶ˆæ¯ğŸ¤©</h1><p> æˆ‘ä»¬é€šè¿‡RocketMQæ¥è®²è¿™ä¸ªä¾‹å­ï¼Œç”¨æˆ·ä¸‹å•ä¹‹åï¼Œç”Ÿäº§è€…å°†è®¾ç½®å¥½æ—¶é—´çš„æ¶ˆæ¯å‘é€ç»™brokerï¼Œç­‰åˆ°è§„å®šçš„æ¶ˆæ¯ä¹‹åï¼Œè¯¥æ¶ˆæ¯æ‰å¯¹æ¶ˆè´¹è€…å¯è§ï¼Œbrokerå‘é€ç›¸åº”æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…æ‰§è¡Œè®¢å•å–æ¶ˆ+åº“å­˜è¡¥å¿é€»è¾‘å³å¯ï¼ˆæ¶ˆæ¯é‡è¯•æœºåˆ¶ä¿è¯æ¶ˆè´¹è€…ä¸€å®šå¯ä»¥æ¶ˆè´¹ï¼‰</p><p><img src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/a657816af14f4434b9d794ad41f2512d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiNTc4NzgxNjQxOTY4OTcyIn0%253D&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1749190938&x-orig-sign=kibB6GjUR5t9J8I9LtwyUqjsPWw%253D&pos_id=img-ClWo8nz0-1749107416163" alt="å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ "></p><p><strong>ç”Ÿäº§è€…ï¼šç”¨æˆ·ä¸‹å•åå‘é€å»¶æ—¶æ¶ˆæ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RocketMQTemplate rocketMQTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(RocketMQTemplate rocketMQTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.rocketMQTemplate = rocketMQTemplate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(String orderId, String productKey)</span> &#123;<br>        <span class="hljs-comment">// 1. åˆ›å»ºè®¢å•ï¼ˆä¼ªä»£ç ï¼‰</span><br>        System.out.println(<span class="hljs-string">&quot;åˆ›å»ºè®¢å•ï¼š&quot;</span> + orderId);<br><br>        <span class="hljs-comment">// 2. é¢„æ‰£å‡åº“å­˜ï¼ˆå‡è®¾ç”¨ Redissonï¼‰</span><br>        <span class="hljs-comment">// RAtomicLong stock = redisson.getAtomicLong(productKey);</span><br>        <span class="hljs-comment">// stock.decrementAndGet();</span><br><br>        <span class="hljs-comment">// 3. å‘é€å»¶è¿Ÿæ¶ˆæ¯ï¼Œlevel=15 å¯¹åº” 30åˆ†é’Ÿ</span><br>        <span class="hljs-type">OrderTimeoutMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderTimeoutMessage</span>(orderId, productKey);<br>        rocketMQTemplate.convertAndSend(<span class="hljs-string">&quot;ORDER_TIMEOUT_TOPIC&quot;</span>, message, <span class="hljs-literal">null</span>, <span class="hljs-number">15</span>); <span class="hljs-comment">// level=15</span><br>        System.out.println(<span class="hljs-string">&quot;å·²å‘é€å»¶è¿Ÿæ¶ˆæ¯ï¼Œ30åˆ†é’Ÿåå¤„ç†è®¢å•ï¼š&quot;</span> + orderId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ¶ˆè´¹è€…ï¼šç›‘å¬å¹¶å¤„ç†è¶…æ—¶è®¢å•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@RocketMQMessageListener(topic = &quot;ORDER_TIMEOUT_TOPIC&quot;, consumerGroup = &quot;order-timeout-group&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTimeoutConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;OrderTimeoutMessage&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(OrderTimeoutMessage message)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> message.orderId;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">productKey</span> <span class="hljs-operator">=</span> message.productKey;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">expectedExpireTime</span> <span class="hljs-operator">=</span> message.timestamp + TimeUnit.MINUTES.toMillis(<span class="hljs-number">30</span>);<br><br>        <span class="hljs-comment">// 1. åˆ¤æ–­æ˜¯å¦å·²ç»è¿‡æœŸï¼ˆé˜²æ­¢é‡å¤æ¶ˆè´¹æˆ–æå‰æ¶ˆè´¹ï¼‰</span><br>        <span class="hljs-keyword">if</span> (System.currentTimeMillis() &lt; expectedExpireTime) &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ¶ˆæ¯å°šæœªåˆ°æœŸï¼Œè·³è¿‡å¤„ç†ï¼š&quot;</span> + orderId);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼ˆä¼ªä»£ç ï¼‰</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">paid</span> <span class="hljs-operator">=</span> checkIfOrderPaid(orderId);<br>        <span class="hljs-keyword">if</span> (paid) &#123;<br>            System.out.println(<span class="hljs-string">&quot;è®¢å•å·²æ”¯ä»˜ï¼Œæ— éœ€å¤„ç†ï¼š&quot;</span> + orderId);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 3. æœªæ”¯ä»˜ â†’ å–æ¶ˆè®¢å• + è¡¥å¿åº“å­˜</span><br>        cancelOrder(orderId);<br>        restoreStock(productKey);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkIfOrderPaid</span><span class="hljs-params">(String orderId)</span> &#123;<br>        <span class="hljs-comment">// æŸ¥è¯¢æ•°æ®åº“åˆ¤æ–­æ˜¯å¦å·²æ”¯ä»˜ï¼ˆä¼ªé€»è¾‘ï¼‰</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// å‡è®¾æœªæ”¯ä»˜</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(String orderId)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å–æ¶ˆè®¢å•ï¼š&quot;</span> + orderId);<br>        <span class="hljs-comment">// å®é™…æ“ä½œï¼šæ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²å–æ¶ˆ</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">restoreStock</span><span class="hljs-params">(String productKey)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;è¡¥å¿åº“å­˜ï¼š&quot;</span> + productKey);<br>        <span class="hljs-comment">// å®é™…æ“ä½œï¼šINCR productKey</span><br>        <span class="hljs-comment">// RAtomicLong stock = redisson.getAtomicLong(productKey);</span><br>        <span class="hljs-comment">// stock.incrementAndGet();</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„RocketMQæ˜¯5.xçš„ç‰ˆæœ¬å°±å¯ä»¥æ”¯æŒä»»æ„æ—¶åˆ»çš„å»¶æ—¶æ¶ˆæ¯äº†ï¼Œå¦åˆ™å°±æ˜¯å¯¹åº”çº§åˆ«çš„å»¶æ—¶æ¶ˆæ¯ã€‚</p><p>è¿™ç§æ–¹æ¡ˆå¤„ç†é«˜å¹¶å‘æ€§èƒ½å¥½ï¼Œè€Œä¸”å¤„ç†æ¶ˆæ¯ä¸¢å¤±ç­‰æ–¹æ¡ˆæˆç†Ÿã€‚ç¼ºç‚¹å°±æ˜¯ç³»ç»Ÿæ¶æ„æ›´åŠ å¤æ‚äº†ï¼Œéœ€è¦å¤„ç†MQçš„å…¶ä»–é—®é¢˜ï¼Œç»´æŠ¤æˆæœ¬å˜é«˜äº†ã€‚</p><h1 id="æ–¹æ¡ˆå››ï¼šåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ğŸ˜ˆ"><a href="#æ–¹æ¡ˆå››ï¼šåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ğŸ˜ˆ" class="headerlink" title="æ–¹æ¡ˆå››ï¼šåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ğŸ˜ˆ"></a>æ–¹æ¡ˆå››ï¼šåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ğŸ˜ˆ</h1><p>ä½¿ç”¨åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œæ¯”å¦‚<strong>xxl-job æˆ– Quartz</strong>æ˜¯ä¼ä¸šé‡Œé¢éå¸¸å¸¸è§çš„æ–¹æ¡ˆã€‚ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“é‡Œé¢è®°å½•è®¢å•çŠ¶æ€ä¸ºâ€œå¾…æ”¯ä»˜â€ï¼Œç„¶åé€šè¿‡xxl-jobå®šæœŸæ‰«æè¿‡æœŸçš„è®¢å•ï¼Œç­›é€‰å‡ºè¶…æ—¶æœªæ”¯ä»˜çš„è®¢å•ï¼Œè¿›è¡Œå–æ¶ˆè®¢å•+è¡¥å¿åº“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTimeoutJobHandler</span> &#123;<br><br>    <span class="hljs-meta">@XxlJob(&quot;orderTimeoutJob&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderTimeoutJob</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        XxlJobLogger.log(<span class="hljs-string">&quot;å¼€å§‹æ‰§è¡Œè¶…æ—¶è®¢å•æ£€æµ‹ä»»åŠ¡...&quot;</span>);<br><br>        <span class="hljs-comment">// 1. è·å–å½“å‰æ—¶é—´</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br><br>        <span class="hljs-comment">// 2. æŸ¥è¯¢æ‰€æœ‰ timeout_time &lt;= now ä¸” status = 0 çš„è®¢å•</span><br>        List&lt;Order&gt; expiredOrders = orderMapper.findExpiredOrders(now);<br><br>        <span class="hljs-keyword">for</span> (Order order : expiredOrders) &#123;<br>            <span class="hljs-comment">// 3. åŠ é”é˜²æ­¢å¹¶å‘å¤„ç†åŒä¸€è®¢å•ï¼ˆå¯é€‰ Redis åˆ†å¸ƒå¼é”ï¼‰</span><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().setIfAbsent(<br>                <span class="hljs-string">&quot;lock:order:&quot;</span> + order.getId(), <span class="hljs-string">&quot;locked&quot;</span>, <span class="hljs-number">5</span>, TimeUnit.MINUTES);<br><br>            <span class="hljs-keyword">if</span> (!locked) &#123;<br>                <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// å·²è¢«å…¶ä»–èŠ‚ç‚¹å¤„ç†</span><br>            &#125;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 4. å†æ¬¡ç¡®è®¤æ˜¯å¦å·²æ”¯ä»˜ï¼ˆé˜²æ­¢å¹¶å‘é—®é¢˜ï¼‰</span><br>                <span class="hljs-type">Order</span> <span class="hljs-variable">updatedOrder</span> <span class="hljs-operator">=</span> orderMapper.selectById(order.getId());<br>                <span class="hljs-keyword">if</span> (updatedOrder.getStatus() != <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br><br>                <span class="hljs-comment">// 5. æ›´æ–°è®¢å•çŠ¶æ€ä¸ºâ€œå·²å–æ¶ˆâ€</span><br>                orderMapper.updateStatus(order.getId(), <span class="hljs-number">2</span>);<br><br>                <span class="hljs-comment">// 6. è¡¥å¿åº“å­˜ï¼ˆå¦‚ä½¿ç”¨ Redissonï¼‰</span><br>                <span class="hljs-type">RAtomicLong</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> redisson.getAtomicLong(order.getProductKey());<br>                stock.incrementAndGet();<br><br>                XxlJobLogger.log(<span class="hljs-string">&quot;å·²å–æ¶ˆè®¢å•ï¼š&quot;</span> + order.getId() + <span class="hljs-string">&quot;ï¼Œè¡¥å¿åº“å­˜ï¼š&quot;</span> + order.getProductKey());<br><br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// 7. é‡Šæ”¾é”</span><br>                redisTemplate.delete(<span class="hljs-string">&quot;lock:order:&quot;</span> + order.getId());<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬”è€…æ›´åŠ æ¨èxxl-jobæ¥å®ç°åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼Œå› ä¸ºå®ƒè‡ªå¸¦å¯è§†åŒ–ç•Œé¢ï¼Œå…¼é¡¾æ€§èƒ½ä¸ç²¾å‡†ï¼Œæ›´é€‚åˆå¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</p><p>è¿™ç§æ–¹æ¡ˆå¯¹å®æ—¶æ€§æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œä¸”æ¡†æ¶å­¦ä¹ æˆæœ¬é«˜ã€‚</p><h1 id="é‡å¤è¡¥å¿åº“å­˜é—®é¢˜ğŸ˜—"><a href="#é‡å¤è¡¥å¿åº“å­˜é—®é¢˜ğŸ˜—" class="headerlink" title="é‡å¤è¡¥å¿åº“å­˜é—®é¢˜ğŸ˜—"></a>é‡å¤è¡¥å¿åº“å­˜é—®é¢˜ğŸ˜—</h1><p>ç”±äºç½‘ç»œå»¶è¿Ÿæˆ–è€…ç½‘ç»œåˆ†åŒºï¼Œåˆæˆ–è€…æ˜¯RedisæœåŠ¡å™¨é—®é¢˜ï¼Œè¿˜æœ‰å¹¶å‘é—®é¢˜ç­‰ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´é‡å¤è¡¥å¿åº“å­˜çš„æƒ…å†µï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p><strong>1.ä½¿ç”¨åˆ†å¸ƒå¼é”</strong></p><ul><li><p>åœ¨æ‰§è¡Œåº“å­˜è¡¥å¿ä¹‹å‰ï¼Œå°è¯•è·å–ä¸€ä¸ªé’ˆå¯¹ç‰¹å®šå•†å“ ID çš„åˆ†å¸ƒå¼é”ã€‚åªæœ‰æˆåŠŸè·å–é”çš„è¿›ç¨‹æ‰èƒ½æ‰§è¡Œè¡¥å¿æ“ä½œã€‚è¿™æ ·å¯ä»¥é˜²æ­¢å¤šä¸ªå®ä¾‹åŒæ—¶å¤„ç†åŒä¸€ä¸ªè¿‡æœŸäº‹ä»¶ã€‚</p></li><li><p>ç¤ºä¾‹ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisson.getLock(<span class="hljs-string">&quot;lock:product:&quot;</span> + productId);<br><span class="hljs-keyword">if</span> (lock.tryLock()) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// æ‰§è¡Œåº“å­˜è¡¥å¿é€»è¾‘</span><br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>2.çŠ¶æ€æ ‡è®°</strong></p><ul><li><p>åœ¨è¡¥å¿åº“å­˜åï¼Œç»™å¯¹åº”çš„ key æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è¯†ï¼ˆå¦‚ <code>compensated</code> æ ‡è®°ï¼‰ã€‚ä¸‹æ¬¡å†é‡åˆ°è¯¥ key è¿‡æœŸæ—¶ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ ‡è®°ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™è·³è¿‡è¡¥å¿æ­¥éª¤ã€‚</p></li><li><p>ç¤ºä¾‹ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!redissonMap.containsKey(productId + <span class="hljs-string">&quot;:compensated&quot;</span>)) &#123;<br>    <span class="hljs-comment">// æ‰§è¡Œåº“å­˜è¡¥å¿é€»è¾‘</span><br>    redissonMap.put(productId + <span class="hljs-string">&quot;:compensated&quot;</span>, <span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>3.å»¶è¿Ÿé˜Ÿåˆ—ç»“åˆå®šæ—¶ä»»åŠ¡</strong></p><p>åˆšæ‰æ–¹æ¡ˆäºŒå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†éœ€è¦è¡¥å¿çš„è®¢å•ä¿¡æ¯æ”¾å…¥å»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼Œå¹¶è®¾ç½®é€‚å½“çš„å»¶è¿Ÿæ—¶é—´ã€‚é€šè¿‡åå°å®šæ—¶ä»»åŠ¡ç»Ÿä¸€å¤„ç†è¿™äº›è®¢å•ï¼Œç¡®ä¿æ¯ä¸ªè®¢å•åªè¢«å¤„ç†ä¸€æ¬¡</p><p><strong>4.æ•°æ®åº“å”¯ä¸€çº¦æŸ</strong></p><p>é€šè¿‡å»ºç«‹è¡¥å¿åº“å­˜è¡¨ï¼Œä¸šåŠ¡å’Œè®¢å•idä½œä¸ºå”¯ä¸€ç´¢å¼•ï¼Œæ¯æ¬¡è¡¥å¿ä¹‹å‰å°è¯•æ˜¯å¦å¯ä»¥æ’å…¥è¯¥è¡¨ï¼Œå¯ä»¥åˆ™è¡¥å¿ï¼Œåä¹‹åˆ™è·³è¿‡ã€‚</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>å®é™…ä¸šåŠ¡ä¸ä¸€å®šè¦æŒ‰ç…§ä¸Šé¢çš„æ–¹æ¡ˆæ‰§è¡Œï¼Œå¯ä»¥æ ¹æ®å®é™…æ¥ç»„åˆä½¿ç”¨(â—â€™â—¡â€™â—)ã€‚å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offer</p>]]></content>
    
    
    <categories>
      
      <category>åç«¯å¼€å‘é—®é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>åç«¯å¼€å‘é—®é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£æœ¬åœ°ç¼“å­˜Guava</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98Guava/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98Guava/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åœ¨åç«¯å¼€å‘ä¸­æˆ–è€…é¢è¯•ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šè°ˆåˆ°å¤šçº§ç¼“å­˜è¿™ä¸ªæ¦‚å¿µï¼Œé‚£ä¹ˆè¿™é‡Œå°±è¦æ¥è¯´ä¸€è¯´ç¼“å­˜çš„åˆ†ç±»äº†ã€‚ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆæ•°æ®åº“ç¼“å­˜å·²ç»è¢«åºŸå¼ƒäº†ï¼‰ï¼Œæœ¬åœ°ç¼“å­˜å¸¸è§çš„æœ‰Guavaï¼ŒEhcacheï¼ŒCaffeineï¼Œåˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æœ‰Redisï¼ŒMemcachedã€‚é‚£ä¹ˆæˆ‘ä»¬ä»Šå¤©ä¸»è¦æ¥èŠèŠæœ¬åœ°ç¼“å­˜Guavaã€‚</p><h1 id="æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤"><a href="#æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤" class="headerlink" title="æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤"></a>æœ¬åœ°ç¼“å­˜çš„å¿…è¦æ€§ğŸ¤¤</h1><p>ä¸æ˜¯æœ‰äº†åƒredisè¿™æ ·çš„åˆ†å¸ƒå¼ç¼“å­˜äº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ¬åœ°ç¼“å­˜å‘¢ï¼Ÿå› ä¸ºæœ¬åœ°ç¼“å­˜æœ‰è¿™æ ·çš„ä¼˜åŠ¿:</p><ol><li><strong>æå‡æ€§èƒ½</strong></li></ol><ul><li><strong>å‡å°‘å»¶è¿Ÿ</strong>ï¼šé€šè¿‡åœ¨åº”ç”¨å±‚å¼•å…¥æœ¬åœ°ç¼“å­˜ä½œä¸ºç¬¬ä¸€çº§ç¼“å­˜ï¼ˆL1ï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨è¿›ç¨‹å†…éƒ¨å¿«é€Ÿå“åº”æŸ¥è¯¢è¯·æ±‚ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½è®¿é—®æ›´æ…¢çš„å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚è¿œç¨‹ç¼“å­˜æˆ–æ•°æ®åº“ï¼‰ã€‚è¿™æ˜¾è‘—å‡å°‘äº†å“åº”æ—¶é—´ã€‚</li><li><strong>å‡å°‘IO</strong>ï¼šç”±äºæœ¬åœ°ç¼“å­˜å¯ä»¥å‘½ä¸­éƒ¨åˆ†æ•°æ®ï¼Œå‡å°‘äº†ä¸åˆ†å¸ƒå¼ç¼“å­˜çš„äº¤äº’ï¼Œä¹Ÿå°±å‡å°‘äº†IOæ¬¡æ•°ï¼Œè¿›è€Œå‡å°‘äº†ç½‘ç»œå¼€é”€</li></ul><ol start="2"><li><strong>å‡è½»åç«¯å‹åŠ›</strong></li></ol><ul><li><strong>é™ä½è´Ÿè½½</strong>ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥å¯ä»¥æœ‰æ•ˆå‡å°‘å¯¹åç«¯æ•°æ®åº“æˆ–å…¶ä»–å¤–éƒ¨æœåŠ¡çš„ç›´æ¥è®¿é—®æ¬¡æ•°ï¼Œä»è€Œå‡è½»è¿™äº›èµ„æºçš„å‹åŠ›ï¼Œæé«˜æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</li></ul><ol start="3"><li><strong>å¢åŠ ç¼“å­˜å‘½ä¸­ç‡</strong></li></ol><ul><li><strong>ä¼˜åŒ–ç¼“å­˜åˆ©ç”¨ç‡</strong>ï¼šä¸åŒçš„ç¼“å­˜çº§åˆ«å¯ä»¥æ ¹æ®å…¶ç‰¹ç‚¹å­˜å‚¨ä¸åŒçƒ­åº¦çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæœ¬åœ°ç¼“å­˜å¯ä»¥å­˜æ”¾æœ€å¸¸è®¿é—®çš„æ•°æ®ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜åˆ™ç”¨äºå­˜æ”¾ç›¸å¯¹è¾ƒå°‘è®¿é—®ä½†ä»ç„¶é‡è¦çš„æ•°æ®ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæœ€å¤§åŒ–åˆ©ç”¨å„ä¸ªå±‚çº§ç¼“å­˜çš„ä¼˜åŠ¿ï¼Œæé«˜æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡ã€‚</li></ul><ol start="4"><li><strong>å®¹é”™èƒ½åŠ›å¢å¼º</strong></li></ol><ul><li><strong>æä¾›å†—ä½™</strong>ï¼šå½“ä¸€ä¸ªçº§åˆ«çš„ç¼“å­˜å‘ç”Ÿæ•…éšœæˆ–å¤±æ•ˆæ—¶ï¼Œå…¶ä»–çº§åˆ«çš„ç¼“å­˜ä»ç„¶å¯ä»¥æä¾›ä¸€å®šç¨‹åº¦çš„æœåŠ¡ï¼Œé¿å…äº†å•ç‚¹å¤±è´¥å¸¦æ¥çš„ä¸¥é‡å½±å“ï¼Œæé«˜äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›å’Œå¯é æ€§ã€‚</li></ul><ol start="5"><li><strong>çµæ´»æ€§ä¸å¯æ‰©å±•æ€§</strong></li></ol><ul><li><strong>æ˜“äºè°ƒæ•´å’Œæ‰©å±•</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–ï¼Œå¯ä»¥çµæ´»åœ°è°ƒæ•´å„çº§ç¼“å­˜çš„å¤§å°ã€è¿‡æœŸç­–ç•¥ç­‰å‚æ•°ï¼Œç”šè‡³æ·»åŠ æ–°çš„ç¼“å­˜å±‚æ¬¡ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„å·¥ä½œè´Ÿè½½ã€‚</li></ul><h1 id="å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹"><a href="#å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹" class="headerlink" title="å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹"></a>å¤šçº§ç¼“å­˜è®¿é—®æµç¨‹ğŸ¥¹</h1><p>åœ¨<strong>å¤šçº§ç¼“å­˜æ¶æ„</strong>ä¸­ï¼Œä¸€èˆ¬çš„è®¾è®¡æ¨¡å¼æ˜¯ï¼š</p><blockquote><p><strong>å…ˆæŸ¥æœ¬åœ°ç¼“å­˜ï¼ˆL1ç¼“å­˜ï¼‰ â†’ æœªå‘½ä¸­åˆ™æŸ¥åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆL2ç¼“å­˜ï¼‰ â†’ è¿˜æœªå‘½ä¸­æ‰æŸ¥è¯¢æ•°æ®åº“ã€‚</strong></p></blockquote><p>è¿™ç§è®¾è®¡çš„ç›®çš„åœ¨äº<strong>å…¼é¡¾æ€§èƒ½ä¸ä¸€è‡´æ€§</strong></p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNptkktLw0AQgP9KmHMsSdo0j4Oiffi-eTLxEMz2ASYpMQE1LYhi6UVUqqBYFBS9aB-eWrTin3G3_RmmSaoW3dPOzjfzLbvjwaalI5Ahb2ulArWWVk3KX7MKbt2RWnfw1B62u-TlgFx0yHFrg5qamqbmFHK_T24fSOMZNzqDfh03LzfCurkASHkrbHiMz94_e82ZSphNjbJlctkuU2ll-HGOr2_GYNT_N4dPH8tUJnLhWhX3DnH_ZEKXCXRZb4X7T5f90c2Pddw_uuyPbkHxXcP2XZjHr_UIWQhEiwruVAdvdXLTwNUrfPQwvv0EtfSH4iaoxYBajm4UmgZvV98PHmFLIQa0_zVFHWTHdhENBrINbRSCN8JUcArIQCrI_lZHOc3dclRQzYpfVtLMdcsyxpW25eYLIOe0rW0_cku65qB0UfP_3fg-tZGpIztluaYDMpsMeoDswQ7IfCLGsfG4ILEik-QkkeVp2AU5wccYXoonGF4UOJHj2QoNe4GViYmCJPFMXOIkJikIrEgD0ouOZa-GExcMXuUL67YPYQ"><img src="https://i-blog.csdnimg.cn/img_convert/62ca86269c2492b7bb15cf56b87eb86c.jpeg"></a></p><h1 id="ä½¿ç”¨Guavaä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜ˆ"><a href="#ä½¿ç”¨Guavaä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜ˆ" class="headerlink" title="ä½¿ç”¨Guavaä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜ˆ"></a>ä½¿ç”¨Guavaä½œä¸ºæœ¬åœ°ç¼“å­˜ğŸ˜ˆ</h1><p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼ŒGuavaæœ¬èº«å¹¶ä¸æä¾›æ³¨è§£æ¥ä½¿ç”¨ç¼“å­˜åŠŸèƒ½ã€‚Guava æä¾›äº† <code>CacheBuilder</code> API æ¥ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®å’Œä½¿ç”¨ç¼“å­˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥ä½¿ç”¨<strong>Spring Cache é›†æˆ Guava</strong>çš„æ–¹å¼æ¥ä½¿ç”¨guavaçš„æœ¬åœ°ç¼“å­˜åŠŸèƒ½ï¼Œè¿™æ ·éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå…è®¸é€šè¿‡æ³¨è§£æ¥ï¼ˆå¦‚ <code>@Cacheable</code>ã€<code>@CachePut</code> å’Œ <code>@CacheEvict</code>ï¼‰æ¥å£°æ˜æ€§åœ°é…ç½®ç¼“å­˜ã€‚</p><h2 id="æ·»åŠ Spring-Cache-å’Œ-Guava-ä¾èµ–"><a href="#æ·»åŠ Spring-Cache-å’Œ-Guava-ä¾èµ–" class="headerlink" title="æ·»åŠ Spring Cache å’Œ Guava ä¾èµ–"></a>æ·»åŠ <strong>Spring Cache å’Œ Guava ä¾èµ–</strong></h2><p>åœ¨pomæ–‡ä»¶æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>33.4.8-jre<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="é…ç½®Guava-CacheManager"><a href="#é…ç½®Guava-CacheManager" class="headerlink" title="é…ç½®Guava CacheManager"></a>é…ç½®<strong>Guava CacheManager</strong></h2><p>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºé…ç½® <code>GuavaCacheManager</code> ä½œä¸º Spring çš„ç¼“å­˜ç®¡ç†å™¨ã€‚</p><p>è®°å¾—åœ¨<strong>é…ç½®ç±»æˆ–è€…å¯åŠ¨ç±»</strong>åŠ ä¸Š@EnableCaching</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">GuavaCacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuavaCacheManager</span>();<br>        CacheBuilder&lt;Object, Object&gt; cacheBuilder = CacheBuilder.newBuilder()<br>                .maximumSize(<span class="hljs-number">100</span>)<br>                .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES);<br>        cacheManager.setCacheBuilder(cacheBuilder);<br>        <span class="hljs-keyword">return</span> cacheManager;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Cacheable-æ³¨è§£"><a href="#ä½¿ç”¨-Cacheable-æ³¨è§£" class="headerlink" title="ä½¿ç”¨@Cacheable æ³¨è§£"></a>ä½¿ç”¨<code>@Cacheable</code> æ³¨è§£</h2><p><code>@Cacheable</code> æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºç¼“å­˜ç®¡ç†çš„ä¸€ä¸ªæ³¨è§£ã€‚å®ƒè¢«ç”¨æ¥æ ‡è®°ä¸€ä¸ªæ–¹æ³•ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•çš„è¿”å›å€¼å¯ä»¥è¢«ç¼“å­˜èµ·æ¥ã€‚å½“å†æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥ç›¸åŒçš„å‚æ•°æ—¶ï¼Œæ¡†æ¶ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç»“æœï¼Œè€Œä¸æ˜¯é‡æ–°æ‰§è¡Œæ–¹æ³•ä½“å†…çš„é€»è¾‘ã€‚è¿™åœ¨å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ã€æé«˜åº”ç”¨æ€§èƒ½æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p><p><strong>ä¸»è¦å±æ€§</strong></p><ul><li><strong>value&#x2F;cacheNames</strong>: æŒ‡å®šç¼“å­˜çš„åç§°ã€‚è¿™æ˜¯å¿…éœ€çš„å±æ€§ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†ç¼“å­˜å­˜å‚¨çš„ä½ç½®ï¼ˆå³å“ªä¸ªç¼“å­˜ï¼‰ã€‚</li><li><strong>key</strong>: å®šä¹‰ç¼“å­˜çš„é”®ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨æ–¹æ³•çš„æ‰€æœ‰å‚æ•°æ¥ç”Ÿæˆã€‚å¯ä»¥é€šè¿‡ SpELï¼ˆSpring Expression Languageï¼‰è‡ªå®šä¹‰é”®å€¼ã€‚</li><li><strong>condition</strong>: å¯é€‰å±æ€§ï¼ŒæŒ‡å®šä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶æ—¶æ‰ä¼šè¿›è¡Œç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®æ–¹æ³•å‚æ•°å†³å®šæ˜¯å¦ç¼“å­˜ç»“æœã€‚</li><li><strong>unless</strong>: ä¸ <code>condition</code> ç›¸ä¼¼ï¼Œä½†å®ƒæ˜¯åœ¨æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè¯„ä¼°çš„ã€‚å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™ä¸ä¼šç¼“å­˜æ–¹æ³•çš„ç»“æœ</li></ul><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(value = &quot;books&quot;, key = &quot;#isbn&quot;)</span><br><span class="hljs-keyword">public</span> Book <span class="hljs-title function_">findBookByIsbn</span><span class="hljs-params">(String isbn)</span> &#123;<br>    <span class="hljs-comment">// æ–¹æ³•é€»è¾‘...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>findBookByIsbn</code> æ–¹æ³•çš„ç»“æœä¼šè¢«ç¼“å­˜åˆ°åä¸º â€œbooksâ€ çš„ç¼“å­˜ä¸­ã€‚ç¼“å­˜çš„é”®æ˜¯ä¼ å…¥çš„ <code>isbn</code> å‚æ•°å€¼ã€‚å¦‚æœå¤šæ¬¡è°ƒç”¨ <code>findBookByIsbn</code> æ–¹æ³•å¹¶ä¼ é€’ç›¸åŒçš„ ISBN å€¼ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡åŠä»¥åçš„è°ƒç”¨å°†ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç»“æœï¼Œè€Œä¸ä¼šæ‰§è¡Œæ–¹æ³•ä½“ä¸­çš„é€»è¾‘ã€‚</p><p>psï¼šè¦æ³¨æ„ç¼“å­˜æœºåˆ¶ä¾èµ–äºä»£ç†æ¨¡å¼ï¼ˆAOPï¼‰ï¼Œå› æ­¤ <code>@Cacheable</code> æ³¨è§£ä¸èƒ½åº”ç”¨äºæœ¬ç±»å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ï¼Œå¦åˆ™ä¼šå¤±æ•ˆğŸ˜µ</p><h2 id="ä½¿ç”¨-CachePut-æ³¨è§£"><a href="#ä½¿ç”¨-CachePut-æ³¨è§£" class="headerlink" title="ä½¿ç”¨@CachePut æ³¨è§£"></a>ä½¿ç”¨<code>@CachePut</code> æ³¨è§£</h2><p><code>@CachePut</code> çš„ä½œç”¨æ˜¯ï¼šæ— è®ºç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œéƒ½ä¼šæ‰§è¡Œæ–¹æ³•ä½“ï¼Œå¹¶å°†æ–¹æ³•çš„è¿”å›å€¼æ›´æ–°åˆ°ç¼“å­˜ä¸­</p><ul><li><strong>æ–¹æ³•ä¸€å®šä¼šæ‰§è¡Œ</strong></li><li><strong>è¿”å›ç»“æœä¼šå†™å…¥ç¼“å­˜</strong></li><li>å¸¸ç”¨äº<strong>æ›´æ–°æ“ä½œååˆ·æ–°ç¼“å­˜</strong></li></ul><table><thead><tr><th><code>value</code> &#x2F; <code>cacheNames</code></th><th>å¿…å¡«ï¼ŒæŒ‡å®šç¼“å­˜çš„åå­—ï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ï¼Œå¦‚ <code>&quot;users&quot;</code></th></tr></thead><tbody><tr><td><code>key</code></td><td>å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨å‚æ•°ç”Ÿæˆç¼“å­˜é”®ï¼Œå¯ä»¥é€šè¿‡ SpEL è¡¨è¾¾å¼è‡ªå®šä¹‰ï¼Œå¦‚ <code>#user.id</code></td></tr><tr><td><code>condition</code></td><td>å¯é€‰ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶æ—¶æ‰æ›´æ–°ç¼“å­˜ï¼Œå¦‚ <code>#user.age &gt; 18</code></td></tr><tr><td><code>unless</code></td><td>å¯é€‰ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œä¹‹ååˆ¤æ–­ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸º trueï¼Œåˆ™ä¸æ›´æ–°ç¼“å­˜</td></tr></tbody></table><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@CachePut(value = &quot;users&quot;, key = &quot;#user.id&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿæ›´æ–°æ•°æ®åº“æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;Updating user in database: &quot;</span> + user);<br>        <span class="hljs-keyword">return</span> user; <span class="hljs-comment">// è¿”å›å€¼ä¼šè¢«æ”¾å…¥ç¼“å­˜</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>å½“è°ƒç”¨ <code>updateUser()</code> æ–¹æ³•æ—¶ï¼š</p><ul><li>ä¸ç®¡ç¼“å­˜ä¸­æœ‰æ²¡æœ‰ <code>user.id</code> å¯¹åº”çš„æ•°æ®ï¼Œæ–¹æ³•éƒ½ä¼šæ‰§è¡Œ</li><li>æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œè¿”å›å€¼ï¼ˆå³ <code>user</code>ï¼‰ä¼šè¢«å†™å…¥åä¸º <code>&quot;users&quot;</code> çš„ç¼“å­˜ä¸­ï¼Œé”®ä¸º <code>#user.id</code></li></ul></li><li><p>ä¸‹æ¬¡é€šè¿‡ <code>@Cacheable</code> è·å–è¿™ä¸ªç”¨æˆ·æ—¶ï¼Œå°±ä¼šç›´æ¥å‘½ä¸­ç¼“å­˜</p></li></ul><h2 id="ä½¿ç”¨-CacheEvict-æ³¨è§£"><a href="#ä½¿ç”¨-CacheEvict-æ³¨è§£" class="headerlink" title="ä½¿ç”¨@CacheEvict æ³¨è§£"></a>ä½¿ç”¨<code>@CacheEvict</code> æ³¨è§£</h2><p><code>@CacheEvict</code> ç”¨äº<strong>æ¸…é™¤ç¼“å­˜</strong>ã€‚å®ƒé€šå¸¸ç”¨äºåœ¨æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚åˆ é™¤æˆ–æ›´æ–°æ•°æ®ï¼‰åï¼Œæ¸…ç†ç›¸å…³çš„ç¼“å­˜æ¡ç›®ï¼Œä»¥ä¿è¯ç¼“å­˜å’Œåº•å±‚æ•°æ®æºï¼ˆå¦‚æ•°æ®åº“ï¼‰ä¹‹é—´çš„ä¸€è‡´æ€§</p><p><strong><code>@CacheEvict</code> çš„ä½œç”¨æ˜¯ï¼šä»ç¼“å­˜ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®</strong>,ä½ å¯ä»¥æ ¹æ®æ–¹æ³•å‚æ•°åŠ¨æ€å†³å®šè¦æ¸…é™¤çš„ç¼“å­˜é”®ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ˜¯å¦æ¸…é™¤æ•´ä¸ªç¼“å­˜åŒºåŸŸï¼ˆå³æ¸…ç©ºæ•´ä¸ªç¼“å­˜ï¼‰ã€‚</p><table><thead><tr><th><code>value</code> &#x2F; <code>cacheNames</code></th><th>å¿…å¡«ï¼ŒæŒ‡å®šè¦æ¸…é™¤çš„ç¼“å­˜åç§°ï¼Œå¦‚ <code>&quot;users&quot;</code></th></tr></thead><tbody><tr><td><code>key</code></td><td>å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨å‚æ•°ç”Ÿæˆç¼“å­˜é”®ï¼Œå¯ä»¥é€šè¿‡ SpEL è‡ªå®šä¹‰</td></tr><tr><td><code>allEntries</code></td><td>å¸ƒå°”å€¼ï¼Œé»˜è®¤ <code>false</code>ï¼Œè‹¥ä¸º <code>true</code>ï¼Œåˆ™æ¸…é™¤æ•´ä¸ªç¼“å­˜åŒºåŸŸçš„æ‰€æœ‰æ¡ç›®</td></tr><tr><td><code>beforeInvocation</code></td><td>é»˜è®¤ <code>false</code>ï¼Œè¡¨ç¤ºåœ¨æ–¹æ³•æ‰§è¡Œ<strong>ä¹‹å</strong>æ¸…é™¤ç¼“å­˜ï¼›è‹¥è®¾ä¸º <code>true</code>ï¼Œåˆ™åœ¨æ–¹æ³•æ‰§è¡Œ<strong>ä¹‹å‰</strong>æ¸…é™¤</td></tr></tbody></table><p>ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CacheEvict(value = &quot;users&quot;, key = &quot;#userId&quot;, beforeInvocation = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUserById</span><span class="hljs-params">(String userId)</span> &#123;<br>    <span class="hljs-comment">// åˆ é™¤æ•°æ®åº“è®°å½•</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å³ä½¿æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œç¼“å­˜ä¹Ÿä¼šè¢«æ¸…é™¤ï¼ˆå› ä¸ºæ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œçš„ï¼‰</p><p><strong>ç¤ºä¾‹ï¼šæŒ‰ key æ¸…é™¤å•ä¸ªç¼“å­˜é¡¹</strong></p><p>è°ƒç”¨ <code>deleteUserById(&quot;123&quot;)</code> æ—¶ï¼Œä¼šä» <code>&quot;users&quot;</code> ç¼“å­˜ä¸­ç§»é™¤é”®ä¸º <code>&quot;123&quot;</code> çš„ç¼“å­˜é¡¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@CacheEvict(value = &quot;users&quot;, key = &quot;#userId&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUserById</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿåˆ é™¤ç”¨æˆ·æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;Deleting user from database: &quot;</span> + userId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼šæ¸…é™¤æ•´ä¸ªç¼“å­˜åŒºåŸŸ</strong></p><p>ä½¿ç”¨ <code>allEntries = true</code> è¡¨ç¤ºæ¸…é™¤ <code>&quot;users&quot;</code> ç¼“å­˜ä¸‹çš„æ‰€æœ‰æ¡ç›®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CacheEvict(value = &quot;users&quot;, allEntries = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearAllUsersCache</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä¸éœ€è¦æ‰§è¡Œä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œä»…ç”¨äºæ¸…ç©ºç¼“å­˜</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼šç»“åˆæ¡ä»¶åˆ¤æ–­æ˜¯å¦æ¸…é™¤ç¼“å­˜</strong></p><p>åªæœ‰å½“ <code>#user.shouldBeRemoved == true</code> æ—¶ï¼Œæ‰ä¼šæ¸…é™¤è¯¥ç”¨æˆ·çš„ç¼“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CacheEvict(value = &quot;users&quot;, key = &quot;#user.id&quot;, condition = &quot;#user.shouldBeRemoved&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeUserIfNecessary</span><span class="hljs-params">(User user)</span> &#123;<br>    <span class="hljs-comment">// åˆ é™¤é€»è¾‘</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>åå°ç¼“å­˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>åå°ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£Completableçš„ç”¨æ³•åŸºç¡€(ä¿å§†ç‰ˆ)</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3Completable%E7%9A%84%E7%94%A8%E6%B3%95%E5%9F%BA%E7%A1%80-%E4%BF%9D%E5%A7%86%E7%89%88/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3Completable%E7%9A%84%E7%94%A8%E6%B3%95%E5%9F%BA%E7%A1%80-%E4%BF%9D%E5%A7%86%E7%89%88/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åœ¨åç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨çº¿ç¨‹æ± æ¥å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œä½†æ˜¯å¦‚æœè¦è¿›è¡Œå¼‚æ­¥ç¼–æ’ä»»åŠ¡å¯çŠ¯äº†éš¾ã€‚çº¿ç¨‹æ± å¯ä¸èƒ½æŒ‰ç…§ä¸€å®šé¡ºåºæ¥æ‰§è¡Œç›¸åº”ä»»åŠ¡ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘ä»¬æ¥è®²è®²Java8å¼•å…¥çš„ï¼Œä½äº<code>java.util.concurrent</code>åŒ…ä¸‹çš„CompletableFutureã€‚</p><p>å¦‚å›¾æ˜¯ä¾é CompletableFutureæ¥å®ç°çš„å¼‚æ­¥å¹¶è¡Œä»»åŠ¡ï¼Œèšåˆç»“æœçš„ç¤ºæ„å›¾ï¼š</p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNpdkk1PwjAYx7_K8pyBANvYy0HDi6Ko8eLJjUPjyksc2zK3RCQkGGMC6oFET4oYT3rxJV48YPTL2MHHsLQQ1J767-_39GnTtmDPtTDoUPWRVxN2CqYj0JE1yEeHPJyXhXh8ScgZpP9Czh6FAB3sp8ozhaH8b5T-gwq_kUgRhzkGVwy2l0CeL6Juf1aXZ2iVofRfVGCoyJC4QByuMLjWQra9XRk_9cjnKTeW21xY5QIPxXngcY3FdSPqdaJB73s0Imf35P3tX4t1ZpWMyevJ-IpeqYadrOfZTWFyfE363fHoMhoOZmctMXfDmHxdkZthNOiMRwuBKxtM2TSmy7d3rA5i9A3qFuiBH-IYNLDfQNMIrSk1gbZsYBN0OrVwBYV2YILptGmZh5xd123MK303rNZAryD7gKbQs1CAC3VEH3ihYMfCft4NnQD0lMq2AL0Fh6CraiKjJZPpjCpqoqxoFDZBz4gJOanIqiiqsiQpitaOwRHrmUyoKUmTpIwqp2RNUzQpBtiqB66_xT8W-1_tH6OB3Wk"><img src="https://i-blog.csdnimg.cn/img_convert/c044196697a25ed6bc97096f01d9c64e.jpeg"></a></p><h1 id="FutureğŸ˜¯"><a href="#FutureğŸ˜¯" class="headerlink" title="FutureğŸ˜¯"></a>FutureğŸ˜¯</h1><p>è¦æƒ³äº†è§£CompletableFutureï¼Œæˆ‘ä»¬å°±å¾—å…ˆæ¥äº†è§£ä¸€ä¸‹Futureã€‚<code>Future</code> æ˜¯ Java ä¸­ç”¨äºè¡¨ç¤ºå¼‚æ­¥è®¡ç®—ç»“æœçš„æ¥å£ï¼Œå®ƒå…è®¸ä½ å¯åŠ¨ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå¹¶åœ¨ä¹‹åè·å–è¯¥ä»»åŠ¡çš„ç»“æœï¼Œè€Œæ— éœ€é˜»å¡ä¸»çº¿ç¨‹ã€‚ä»¥ä¸‹æ˜¯è¯¥æ¥å£çš„ä¸»è¦æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Future</span>&lt;V&gt; &#123;<br>    <span class="hljs-comment">//å°è¯•å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡å·²ç»å®Œæˆã€æˆ–å·²å–æ¶ˆã€æˆ–è€…ç”±äºæŸäº›åŸå› æ— æ³•å–æ¶ˆï¼Œåˆ™æ­¤å°è¯•å°†å¤±è´¥ã€‚å¦‚æœæˆåŠŸå–æ¶ˆäº†ä»»åŠ¡çš„æ‰§è¡Œï¼Œè¿”å› true</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(<span class="hljs-type">boolean</span> mayInterruptIfRunning)</span>;<br>    <span class="hljs-comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ,å¦‚æœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰è¢«å–æ¶ˆï¼Œåˆ™è¿”å› true</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCancelled</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ,æ— è®ºä»»åŠ¡æ˜¯æ­£å¸¸å®Œæˆã€å¼‚å¸¸ç»ˆæ­¢è¿˜æ˜¯è¢«å–æ¶ˆï¼Œåªè¦ä»»åŠ¡å®Œæˆå°±è¿”å›true</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDone</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// é˜»å¡å¼è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼ˆå¦‚ä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ï¼‰</span><br>    V <span class="hljs-title function_">get</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException;<br>    <span class="hljs-comment">// é˜»å¡å¼è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼ŒæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¿”å›è®¡ç®—ç»“æœå°±æŠ›å‡º TimeOutException å¼‚å¸¸</span><br>    V <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException, TimeoutExceptio<br><br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ <code>Future</code> æä¾›äº†ä¸€ç§å¤„ç†å¼‚æ­¥æ“ä½œç»“æœçš„æ–¹å¼ï¼Œä½†å®ƒç¼ºä¹ä¸€äº›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç»„åˆå¤šä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœã€å¼‚å¸¸å¤„ç†ç­‰ã€‚</p><h1 id="CompletableFutureğŸ˜"><a href="#CompletableFutureğŸ˜" class="headerlink" title="CompletableFutureğŸ˜"></a>CompletableFutureğŸ˜</h1><p>å› Futureçš„å±€é™æ€§ï¼ŒJava8å¼•å…¥CompletableFutureæ¥è§£å†³Futureçš„ä¸è¶³ï¼Œè€Œä¸”è¿˜å¸¦æ¥äº†æ–°ç‰¹æ€§ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚</p><h2 id="åˆ›å»ºCompletableFutureğŸ˜ª"><a href="#åˆ›å»ºCompletableFutureğŸ˜ª" class="headerlink" title="åˆ›å»ºCompletableFutureğŸ˜ª"></a>åˆ›å»ºCompletableFutureğŸ˜ª</h2><p><strong>1.newï¼ˆå³æ‰‹åŠ¨åˆ›å»ºCompletableFutureï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><ul><li>å¯ä»¥åœ¨åç»­é€šè¿‡ <code>.complete()</code> æˆ– <code>.completeExceptionally()</code> æ‰‹åŠ¨è®¾ç½®ç»“æœæˆ–å¼‚å¸¸ã€‚</li><li><strong>é€‚åˆ</strong>ï¼šéœ€è¦è·¨çº¿ç¨‹é€šä¿¡ã€äº‹ä»¶é©±åŠ¨ç­‰è‡ªå®šä¹‰æ§åˆ¶æµç¨‹çš„åœºæ™¯</li></ul><p><strong>2.å·¥å‚æ–¹æ³• <code>supplyAsync()</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="hljs-title function_">supplyAsync</span><span class="hljs-params">(Supplier&lt;U&gt; supplier)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="hljs-title function_">supplyAsync</span><span class="hljs-params">(Supplier&lt;U&gt; supplier, Executor executor)</span><br></code></pre></td></tr></table></figure><p>ä¸¤è€…çš„åŒºåˆ«åœ¨äºæ˜¯å¦ä¼ å…¥è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œå‰è€…ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± ForkJoinPool.commonPool()ï¼Œåè€…å¯ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ã€‚è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„CompletableFutureå¯æ‰§è¡Œä¸€ä¸ªå¸¦è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ã€‚</p><p><strong>3.å·¥å‚æ–¹æ³• <code>runAsync()</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CompletableFuture&lt;Void&gt; <span class="hljs-title function_">runAsync</span><span class="hljs-params">(Runnable runnable)</span> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CompletableFuture&lt;Void&gt; <span class="hljs-title function_">runAsync</span><span class="hljs-params">(Runnable runnable, Executor executor)</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«å’ŒsupplyAsync()çš„ä¸¤è€…åŒºåˆ«ä¸€æ ·ã€‚è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„CompletableFutureå¯æ‰§è¡Œä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ã€‚</p><p><strong>4. <code>completedFuture()</code>åˆ›å»ºå·²å®ŒæˆçŠ¶æ€çš„ Future</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="hljs-title function_">completedFuture</span><span class="hljs-params">(U value)</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥åˆ›å»ºä¸€ä¸ªå·²ç»å®Œæˆå¹¶å¸¦æœ‰ç»“æœçš„ <code>CompletableFuture</code>ï¼Œå¯ä»¥ç”¨äºæµ‹è¯•ã€å¿«é€Ÿè¿”å›å·²çŸ¥ç»“æœã€è·³è¿‡æŸäº›åˆ†æ”¯é€»è¾‘</p><p>å…¶å®è¿™ä¸ªæ–¹æ³•åº•å±‚ç”¨çš„æ˜¯newï¼Œå³æ‰‹åŠ¨åˆ›å»ºCompletableFutureï¼Œå°è£…èµ·æ¥ç½¢äº†ğŸ˜—</p><h2 id="ç»„åˆç¼–æ’CompletableFutureğŸ«¨"><a href="#ç»„åˆç¼–æ’CompletableFutureğŸ«¨" class="headerlink" title="ç»„åˆç¼–æ’CompletableFutureğŸ«¨"></a>ç»„åˆç¼–æ’CompletableFutureğŸ«¨</h2><p>ä¸Šé¢è¯´äº†CompletableFutureå¯ä»¥è¿›è¡Œå¼‚æ­¥ç»„åˆç¼–æ’ä»»åŠ¡ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯æ€ä¹ˆæ ·è¿›è¡Œç»„åˆç¼–æ’çš„å‘¢ï¼Ÿ</p><h3 id="é“¾å¼è°ƒç”¨-thenCompose"><a href="#é“¾å¼è°ƒç”¨-thenCompose" class="headerlink" title="é“¾å¼è°ƒç”¨.thenCompose()"></a>é“¾å¼è°ƒç”¨<code>.thenCompose()</code></h3><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äº<strong>å¼‚æ­¥ä»»åŠ¡çš„ä¸²è¡Œç¼–æ’</strong>ã€‚ç®€å•æ¥è¯´ï¼Œ<code>thenCompose()</code> ç”¨äºå°†ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»“æœä½œä¸ºè¾“å…¥ï¼Œç»§ç»­å‘èµ·ä¸€ä¸ªæ–°çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå½¢æˆä¸€æ¡å¼‚æ­¥æµæ°´çº¿ã€‚</p><p>åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªCompletableFutureä¹‹åï¼Œæ¥ç€å°†ç»“æœè¾“å…¥ç»™æ–°CompletableFutureä½œä¸ºå‚æ•°ï¼Œç„¶åè¾“å‡ºç»“æœã€‚</p><ol><li>ç¬¬ä¸€ä¸ªä»»åŠ¡è¿”å› <code>&quot;Hello&quot;</code>ï¼›</li><li>ç¬¬äºŒä¸ªä»»åŠ¡æ¥æ”¶ <code>&quot;Hello&quot;</code>ï¼Œå¹¶å¼‚æ­¥è¿”å› <code>&quot;Hello World&quot;</code>ï¼›</li><li><code>thenCompose()</code> æŠŠä¸¤ä¸ª Future <strong>åˆå¹¶æˆä¸€ä¸ªè¿ç»­çš„ Future</strong>ï¼Œè€Œä¸æ˜¯åµŒå¥—çš„ <code>CompletableFuture&lt;CompletableFuture&lt;String&gt;&gt;</code>ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Hello&quot;</span>)<br>    .thenCompose(s -&gt; CompletableFuture.supplyAsync(() -&gt; s + <span class="hljs-string">&quot; World&quot;</span>));<br><br>System.out.println(future.join()); <span class="hljs-comment">// è¾“å‡º Hello World</span><br></code></pre></td></tr></table></figure></li></ol><p>å¤ªç®€å•äº†ï¼Ÿæ¥ç‚¹éš¾åº¦çš„ï¼Œæ¨¡æ‹Ÿå¤šçº§å¼‚æ­¥è°ƒç”¨ã€‚<br>å‡è®¾ä½ æœ‰å¦‚ä¸‹ä¸‰ä¸ªæœåŠ¡æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å– token</span><br>CompletableFuture&lt;String&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(String username)</span> &#123;<br>    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;token-&quot;</span> + username);<br>&#125;<br><br><span class="hljs-comment">// æ ¹æ® token è·å–ç”¨æˆ·ä¿¡æ¯</span><br>CompletableFuture&lt;User&gt; <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(String token)</span> &#123;<br>    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(token));<br>&#125;<br><br><span class="hljs-comment">// æ ¹æ®ç”¨æˆ·ä¿¡æ¯è·å–è®¢å•åˆ—è¡¨</span><br>CompletableFuture&lt;List&lt;Order&gt;&gt; <span class="hljs-title function_">getOrders</span><span class="hljs-params">(User user)</span> &#123;<br>    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;1001&quot;</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;1002&quot;</span>)));<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>thenCompose()</code> ç¼–æ’æ•´ä¸ªæµç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;List&lt;Order&gt;&gt; ordersFuture = login(<span class="hljs-string">&quot;alice&quot;</span>)<br>    .thenCompose(token -&gt; getUserInfo(token))<br>    .thenCompose(user -&gt; getOrders(user));<br><br>List&lt;Order&gt; orders = ordersFuture.join();<br>orders.forEach(order -&gt; System.out.println(<span class="hljs-string">&quot;è®¢å•IDï¼š&quot;</span> + order.id));<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±é€šè¿‡thenCompose()å®ç°äº†å¤šä¸ªå¼‚æ­¥æœåŠ¡çš„é“¾å¼è°ƒç”¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé“¾å¼è°ƒç”¨çš„ç®€å•ç¤ºæ„å›¾<br><a href="https://mermaid-live.nodejs.cn/edit#pako:eNqNkstuwjAQRX_FGrYBBfJyvKhEoOy6aVk1YWHIhEQkdmQ7aini35sHr0Vb1ZKlmdG5c-XxnGAnUwQGe8XrnKyXiSDtmcdvhiuzIePxE1lzfZgP9T6MF7KqSzR8W-KqMY1CMicZml2-5IbP9VHsLsIcRcdKjRf5vRCbe0w-CpP3vUl0t4zultEPlhGpldyh1p3poHoW6SvqpjSD8pbGq0LwkgzJDY3bS2RGFjkvxCYRg0ibY9m_pyhLNsrCzNJGyQOykeM4j0inHqDt9leon9e1F0c7oH-R0f_Ih8ENPJ-mbmg_8mC1H1qkwIxq0IIKVcW7FE5dpwTa4VeYAGvDFDPejQwScW5lNRfvUlZXpZLNPgeW8VK3WVOn3OCy4O22VLeqQpGiWshGGGCzWd8D2Ak-gVE68UPbnvnUCR0vCKkFR2C-M_HswKOOQz3XDYLwbMFXb2pP6NQNXdenrmd7rj_zLcC0MFK9DGvab-v5G3F23NE"><img src="https://i-blog.csdnimg.cn/img_convert/b1190ad1a9526048b7550971ea57f1f6.jpeg"></a></p><h3 id="åˆå¹¶å¤„ç†-thenCombine"><a href="#åˆå¹¶å¤„ç†-thenCombine" class="headerlink" title="åˆå¹¶å¤„ç†.thenCombine()"></a>åˆå¹¶å¤„ç†<code>.thenCombine()</code></h3><p>ä¸Šé¢è®²è§£äº†å¦‚ä½•é“¾å¼è°ƒç”¨ä»»åŠ¡ï¼Œå±äºæ˜¯å¾®ä¿¡æ¥é¾™å½¢æ€çš„ï¼ˆhhï¼Œå¼€ä¸ªç©ç¬‘ï¼‰ï¼Œç°åœ¨æˆ‘ä»¬æ¥è®²<strong>å¹¶è¡Œæ‰§è¡Œä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶å°†å®ƒä»¬çš„ç»“æœåˆå¹¶å¤„ç†</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œ**<code>thenCombine()</code> ç”¨äºå°†ä¸¤ä¸ªç‹¬ç«‹çš„ <code>CompletableFuture</code> çš„ç»“æœè¿›è¡Œåˆå¹¶å¤„ç†ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç»“æœ**ï¼Œå°±èƒ½å®ç°è¿™æ ·çš„æ•ˆæœã€‚</p><p>é€‚åˆç”¨äºï¼š</p><ul><li>åŒæ—¶å‘èµ·å¤šä¸ªå¼‚æ­¥è¯·æ±‚ï¼ˆå¦‚æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€æŸ¥è¯¢è®¢å•ä¿¡æ¯ï¼‰</li><li>ç„¶ååœ¨ä¸¤è€…éƒ½å®Œæˆåï¼ŒæŠŠç»“æœåˆå¹¶è¾“å‡º</li></ul><p>åºŸè¯ä¸å¤šè¯´ï¼Œä¾‹å­èµ°èµ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Hello&quot;</span>);<br>CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;World&quot;</span>);<br><span class="hljs-comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åˆå¹¶ç»“æœçš„å…·ä½“é€»è¾‘</span><br>CompletableFuture&lt;String&gt; combinedFuture = future1.thenCombine(future2, (result1, result2) -&gt; &#123;<br>    <span class="hljs-keyword">return</span> result1 + <span class="hljs-string">&quot; &quot;</span> + result2; <span class="hljs-comment">// åˆå¹¶ç»“æœ</span><br>&#125;);<br><br>System.out.println(combinedFuture.join()); <span class="hljs-comment">// è¾“å‡º Hello World</span><br></code></pre></td></tr></table></figure><ul><li><code>future1</code> å’Œ <code>future2</code> æ˜¯<strong>å¹¶è¡Œæ‰§è¡Œ</strong>çš„ã€‚</li><li>å½“ä¸¤è€…éƒ½å®Œæˆæ—¶ï¼Œä½¿ç”¨ <code>thenCombine()</code> å°†å®ƒä»¬çš„ç»“æœæ‹¼æ¥èµ·æ¥ã€‚</li></ul><p>ä¸å¤Ÿæ¥è¿‘çœŸå®ä¸šåŠ¡ï¼Ÿä¸Šç‚¹éš¾åº¦ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸¤ä¸ªæœåŠ¡æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¨¡æ‹Ÿæ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·å</span><br>CompletableFuture&lt;String&gt; <span class="hljs-title function_">fetchUserName</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> &#123;<br>    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span><br>        Thread.sleep(<span class="hljs-number">500</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Alice&quot;</span>;<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">// æ¨¡æ‹Ÿæ ¹æ®ç”¨æˆ·IDè·å–è®¢å•æ•°é‡</span><br>CompletableFuture&lt;Integer&gt; <span class="hljs-title function_">fetchOrderCount</span><span class="hljs-params">(String userName)</span> &#123;<br>    <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">800</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>thenCombine()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;<br><br>CompletableFuture&lt;String&gt; userFuture = fetchUserName(userId);<br>CompletableFuture&lt;Integer&gt; orderFuture = fetchOrderCount(<span class="hljs-string">&quot;Alice&quot;</span>); <span class="hljs-comment">// å‡è®¾å·²çŸ¥ç”¨æˆ·å</span><br><br>CompletableFuture&lt;String&gt; resultFuture = userFuture.thenCombine(orderFuture, (name, count) -&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”¨æˆ·ï¼š&quot;</span> + name + <span class="hljs-string">&quot;ï¼Œè®¢å•æ•°ï¼š&quot;</span> + count;<br>&#125;);<br><br>System.out.println(resultFuture.join());<br><span class="hljs-comment">// è¾“å‡ºï¼šç”¨æˆ·ï¼šAliceï¼Œè®¢å•æ•°ï¼š5</span><br></code></pre></td></tr></table></figure><ul><li><code>thenCombine()</code> ä¸ä¼šç­‰å¾…ä¸¤ä¸ª Future çš„å¼‚å¸¸çŠ¶æ€ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå¤±è´¥ï¼Œæ•´ä¸ª Future ä¹Ÿä¼šå¤±è´¥ã€‚</li><li>å¦‚æœä½ æƒ³å¤„ç†å¼‚å¸¸æˆ–æä¾›é»˜è®¤å€¼ï¼Œå¯ä»¥ç»“åˆ <code>.exceptionally()</code> æˆ– <code>.handle()</code> ä½¿ç”¨ã€‚</li></ul><p><strong>è¿›é˜¶ï¼šé“¾å¼è°ƒç”¨å¤šä¸ª <code>thenCombine()</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;Integer&gt; f1 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-number">10</span>);<br>CompletableFuture&lt;Integer&gt; f2 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-number">20</span>);<br>CompletableFuture&lt;Integer&gt; f3 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-number">30</span>);<br><br>CompletableFuture&lt;Integer&gt; result = f1.thenCombine(f2, Integer::sum)<br>                                     .thenCombine(f3, Integer::sum);<br><br>System.out.println(result.join()); <span class="hljs-comment">// è¾“å‡º 60</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„thenCombine()çš„ç¤ºæ„å›¾ï¼š<br><a href="https://mermaid-live.nodejs.cn/edit#pako:eNqNk0tLxDAUhf9KuG7rMH2nWQjz0J0g6MrWRaa5nZZpkyFNQR3mv5tpOr5QMdCQe_jOaXuTHKBUAoHBVvN9TR7WhSR2LPJ7w7V5IpeXV-SB97vFpL8LSye4eSTyler2LRq-afFmMINGi1doynrNDfddlmU2jcQP2_IH2_LDFvxgc_Mk5aZGOa1Jh3qLRGM_tKZ3zjutSuz7iRDO-03Mp5qUkzBFuIRrKXL7EFWRVc0b-VRIl9Kbl3b8x6Zt2UWVVV5vtNohuwjD8DNycjtos_kVGnt4zuI4T-lf5PJf5LkvjuW-iLL5b-y3nkyeUgiKX74ZPHtWGgHM6AE9sC3v-KmEwymtALsfHRbA7FJgxW0bCyjk0dr2XD4q1Z2dWg3bGljF295Ww15wg-uG24PYvasapUC9UoM0wAI6ZgA7wDMwSmdxFARJnGRh4MdR6MELsCScpUHmZzTOEpokYXr04HV86XxG_SiLonSextRPo9gDFI1R-tZdgPEeHN8AOOP5Ew"><img src="https://i-blog.csdnimg.cn/img_convert/3e7186f907af91c4ead92daabaf9969c.jpeg"></a></p><h3 id="ç­‰å¾…å…¨éƒ¨allOf"><a href="#ç­‰å¾…å…¨éƒ¨allOf" class="headerlink" title="ç­‰å¾…å…¨éƒ¨allOf()"></a>ç­‰å¾…å…¨éƒ¨<code>allOf()</code></h3><p>ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•æ‰€è¦æ±‚çš„å¼‚æ­¥ä»»åŠ¡ä¹‹é—´éƒ½æ˜¯æœ‰è”ç³»çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬ä¸šåŠ¡ä¹Ÿæœ‰å¾ˆå¤šæ²¡å…³è”çš„å¼‚æ­¥ä»»åŠ¡ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œä¸‹è½½ç­‰ï¼Œéœ€è¦åŒæ—¶å¼€å¯å¤šä¸ªä»»åŠ¡æ¥æ‰§è¡Œï¼Œ<strong>ç­‰å¾…å…¨éƒ¨å®Œæˆ</strong>ä¹‹åå†ç»Ÿä¸€è¿”å›ç»“æœæˆ–è€…æˆåŠŸæ ‡è¯†ã€‚</p><p><code>allOf()</code>å°±å¯ä»¥å®Œæˆè¿™æ ·çš„æ•ˆæœï¼Œå®ƒå¯ä»¥ç”¨äº<strong>å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡</strong>ã€å¹¶åœ¨<strong>æ‰€æœ‰ä»»åŠ¡å®Œæˆåå†ç»§ç»­åç»­æ“ä½œ</strong>ã€‚ä½†æ˜¯å®ƒä¸ä¼š<strong>ä¸ä¼šè‡ªåŠ¨èšåˆå„ä¸ª Future çš„ç»“æœ</strong>ï¼ˆä¸å…³å¿ƒæ˜¯å¦è¿”å›ç»“æœï¼Œå®Œæˆå°±è¡Œï¼‰ï¼Œä½ éœ€è¦æ‰‹åŠ¨è·å–æ¯ä¸ª Future çš„å€¼ã€‚</p><p>åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Result1&quot;</span>);<br>CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Result2&quot;</span>);<br>CompletableFuture&lt;String&gt; future3 = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Result3&quot;</span>);<br><span class="hljs-comment">//ä½ ç›´æ¥å¯¹allFuturesä½¿ç”¨join()æ˜¯æ— æ³•è·å–ç»“æœçš„,å› ä¸ºallOf()ä¸å…³å¿ƒç»“æœ</span><br>CompletableFuture&lt;Void&gt; allFutures = CompletableFuture.allOf(future1, future2, future3);<br><br>allFutures.thenRun(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;future1: &quot;</span> + future1.join());<br>    System.out.println(<span class="hljs-string">&quot;future2: &quot;</span> + future2.join());<br>    System.out.println(<span class="hljs-string">&quot;future3: &quot;</span> + future3.join());<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœä»»æ„ä¸€ä¸ª Future æŠ›å‡ºå¼‚å¸¸ï¼Œæ•´ä¸ª <code>allOf</code> ä¹Ÿä¼šå¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨<code>.exceptionally()</code> æˆ– <code>.handle()</code> æ¥æ•è·å’Œå¤„ç†å¼‚å¸¸ã€‚</p><p><strong>è¿›é˜¶ï¼šç»“åˆ <code>thenApply()</code> èšåˆç»“æœ</strong><br>å¦‚æœä½ æƒ³åœ¨æ‰€æœ‰ä»»åŠ¡å®Œæˆå<strong>åˆå¹¶ç»“æœ</strong>ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;List&lt;String&gt;&gt; combinedFuture = CompletableFuture.allOf(future1, future2, future3)<br>    .thenApply(v -&gt; List.of(<br>        future1.join(),<br>        future2.join(),<br>        future3.join()<br>    ));<br><br>List&lt;String&gt; results = combinedFuture.join();<br>System.out.println(results); <span class="hljs-comment">// è¾“å‡º [Result1, Result2, Result3]</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯allOf()çš„ä¸€ä¸ªç®€å•ç¤ºæ„å›¾ï¼š<br><a href="https://mermaid-live.nodejs.cn/edit#pako:eNqNk91q4zAQhV9FTG-d4MSOf8RSSJz2bsnFFhbW7oVijRpTWTKyzG435N1XseKmhXapQEIz-s4ZNEhHqDVHoPBkWHcgD9tKETd-WGZsOa6PZDa7JQ-sf16_OXtNbj5KFpXy6VFWnleyJjMi0NaHLbPMm66l3IkruPHgxoGd0TX2_YdY4bFixLBjBt9hHhyD8idrLBHaECYlsU51cdypQredRIuevsblTpHa7xutvu3N7XqSEq7VpdSd4qWbRAtyL_Xvx6lqb18kXnohGinpjchF0Fujn5HeRFH0FjsbeGi__xQaGzh5MQzT7H_k5stk8SVy7OJEirqu95-R1w5e8JrzDN9dCwL3yBoO1JoBA2jRtOwcwvFsVIE9YIsVULflKNggbQWVOjlZx9QvrdtJafTwdAAqmOxdNHScWdw2zL3g9jVrUHE0hR6UBRrFowfQI_wBmibzMM-ScJUso3CxWC4DeAGaRPM8yeJslUcrdxJmySmAv2PVcJ4t4jyO0zBdZYs0jvMAkDdWm-_-74xf6PQP5SIH1g"><img src="https://i-blog.csdnimg.cn/img_convert/7db9f23390d03c933aa276ae265789c6.jpeg"></a></p><h3 id="å°±ç­‰ä¸€ä¸ªanyOf"><a href="#å°±ç­‰ä¸€ä¸ªanyOf" class="headerlink" title="å°±ç­‰ä¸€ä¸ªanyOf()"></a>å°±ç­‰ä¸€ä¸ª<code>anyOf()</code></h3><p><code>anyOf()</code>ç”¨äº<strong>å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡</strong>ã€å¹¶åœ¨<strong>ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰åç«‹å³è¿”å›ç»“æœ</strong>çš„åœºæ™¯</p><p>é€‚åˆç”¨äºï¼š</p><ul><li>å¤šä¸ªæœåŠ¡æä¾›è€…å¹¶å‘è°ƒç”¨ï¼Œå–<strong>æœ€å¿«å“åº”</strong></li><li>å®ç°â€œè¶…æ—¶é™çº§â€é€»è¾‘</li><li>å¼‚å¸¸å®¹å¿ï¼šåªè¦æœ‰ä¸€ä¸ª Future æˆåŠŸå³å¯ç»§ç»­æµç¨‹</li></ul><p>åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Result from future1&quot;</span>;<br>&#125;);<br><br>CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">500</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Result from future2&quot;</span>;<br>&#125;);<br><br>CompletableFuture&lt;String&gt; future3 = CompletableFuture.supplyAsync(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">800</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Result from future3&quot;</span>;<br>&#125;);<br><br>CompletableFuture&lt;Object&gt; resultFuture = CompletableFuture.anyOf(future1, future2, future3);<br><br>System.out.println(<span class="hljs-string">&quot;æœ€å¿«å®Œæˆçš„æ˜¯ï¼š&quot;</span> + resultFuture.join());<br></code></pre></td></tr></table></figure><p><strong>è¿›é˜¶ï¼šç»“åˆ <code>filter()</code> å’Œ <code>handle()</code> åšé™çº§å¤„ç†</strong><br>ä½ å¯ä»¥ä½¿ç”¨ <code>.handle()</code> æ¥ç»Ÿä¸€å¤„ç†æˆåŠŸ&#x2F;å¤±è´¥æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; fastFuture = CompletableFuture.anyOf(future1, future2, future3)<br>    .handle((result, ex) -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (ex != <span class="hljs-literal">null</span>) &#123;<br>            System.err.println(<span class="hljs-string">&quot;å‘ç”Ÿå¼‚å¸¸ï¼š&quot;</span> + ex.getCause());<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;é»˜è®¤å€¼&quot;</span>; <span class="hljs-comment">// å¼‚å¸¸é™çº§</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> result.toString(); <span class="hljs-comment">// æ­£å¸¸è¿”å›</span><br>    &#125;);<br><br>System.out.println(fastFuture.join());<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯anyOf()çš„ç®€å•ç¤ºæ„å›¾<br><a href="https://mermaid-live.nodejs.cn/edit#pako:eNptkk1LwzAYx79KeM5d6fpm14PgNudUxIsn2x2KTd3AtqO2oI7BDgrqVAZ60jERDxNx6kUYzJcvs7Z-DLO0EybmlH9-vzxPSNKALdfEoMK2Z9SraKOoO4iMBS18b4X9dgVlMvMor4Wdl_D0AVmBH3g4W0klCguzkJ-BxVkoEJjgPMWLWloRRSf977uz8XDAsmxaoUCVUqrw_ylFqiylivBXSaRFKpUbhrO_bqF4cBJ-HjUTVEpQEpamIYllGpe16L4VvbXD49fotjMePqIS7YXC57PouJOeY5m6K9r311V404ufnsbDFnETJ74-jEeXUa-byitUXiU3cxGPBtHl-fijG4_6kzk9fgUY8ho1E1TfCzADNvZsYxKhMSmgg1_FNtZBJVMTW0aw4-ugO02yrW44m65rT3d6brBdBdUydnZJCuqm4eNizSBPbf-uetgxsVdwA8cHVVBoDVAbsAfqnMxyOUXmJJkXuGyW5xnYB1UW2JysiIqUEyRCOEVuMnBAu3KskhVzokiwxEmizMsMYLPmu95a8snoX2v-ABHM6VQ"><img src="https://i-blog.csdnimg.cn/img_convert/06dfa333c4ac57d9d149880829b3e631.jpeg"></a></p><h2 id="å¤„ç†CompletableFutureå¼‚æ­¥ç»“æœğŸ˜µ"><a href="#å¤„ç†CompletableFutureå¼‚æ­¥ç»“æœğŸ˜µ" class="headerlink" title="å¤„ç†CompletableFutureå¼‚æ­¥ç»“æœğŸ˜µ"></a>å¤„ç†CompletableFutureå¼‚æ­¥ç»“æœğŸ˜µ</h2><p>ä¸Šé¢è®²äº†è¿™ä¹ˆå¤šå¼‚æ­¥ç¼–æ’çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä¸å¯ä»¥å¯¹å•ä¸ªå¼‚æ­¥ä»»åŠ¡è¿›è¡Œå¤„ç†çš„æ–¹æ³•å‘¢ï¼Ÿæœ‰çš„ï¼Œå…„å¼Ÿï¼Œæœ‰çš„ï¼Œè¿™æ ·å¸¸ç”¨çš„æ–¹æ³•æœ‰å››ä¸ªğŸ¤£</p><h3 id="thenApply"><a href="#thenApply" class="headerlink" title="thenApply()"></a><code>thenApply()</code></h3><p><code>thenApply()</code> æ˜¯ <code>CompletableFuture</code> æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœ¨<strong>å¼‚æ­¥ä»»åŠ¡å®Œæˆä¹‹å</strong>ï¼Œå¯¹ç»“æœè¿›è¡Œ<strong>è½¬æ¢å¤„ç†</strong>ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code>ï¼Œè¡¨ç¤ºç»è¿‡è½¬æ¢åçš„æ–°ç»“æœã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li><strong>ä¸²è¡Œæ‰§è¡Œ</strong>ï¼šå‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåï¼Œæ‰æ‰§è¡Œ <code>thenApply()</code> ä¸­çš„ä»»åŠ¡ã€‚</li><li><strong>æœ‰è¿”å›å€¼</strong>ï¼š<code>thenApply()</code> ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ç»“æœï¼ˆå³è½¬æ¢åçš„ç»“æœï¼‰ã€‚</li><li>ç±»ä¼¼äºå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ <code>map</code> æ“ä½œã€‚</li></ul><p>åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Hello&quot;</span>);<br><br><span class="hljs-comment">//è¾“å‡ºæ˜¯Hello World</span><br>future.thenApply(result -&gt; result + <span class="hljs-string">&quot; World&quot;</span>)<br>       .thenAccept(finalResult -&gt; System.out.println(finalResult));<br></code></pre></td></tr></table></figure><h3 id="thenAccept-å’ŒthenRun"><a href="#thenAccept-å’ŒthenRun" class="headerlink" title="thenAccept()å’ŒthenRun()"></a><code>thenAccept()</code>å’Œ<code>thenRun()</code></h3><p>ç°åœ¨ç€é‡è®²ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«ã€‚</p><table><thead><tr><th>æ–¹æ³•å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>thenAccept()</code></td><td><strong>æ¶ˆè´¹ç»“æœ</strong>ï¼Œæ¥æ”¶ä¸Šä¸€ä¸ªä»»åŠ¡çš„ç»“æœï¼Œä½†ä¸è¿”å›æ–°çš„å€¼ï¼ˆæ— è¿”å›ï¼‰</td></tr><tr><td><code>thenRun()</code></td><td><strong>æ‰§è¡ŒåŠ¨ä½œ</strong>ï¼Œä¸æ¥æ”¶ä¸Šä¸€ä¸ªä»»åŠ¡çš„ç»“æœï¼Œåªåœ¨ä»»åŠ¡å®Œæˆåæ‰§è¡Œä¸€æ®µé€»è¾‘</td></tr></tbody></table><p>å®ƒä»¬éƒ½æ˜¯ç”¨äºåœ¨ <code>CompletableFuture</code> å®Œæˆååšä¸€äº›åç»­å¤„ç†ï¼Œ<strong>å¸¸ç”¨äºé“¾å¼è°ƒç”¨ä¸­çš„â€œå‰¯ä½œç”¨â€æ“ä½œ</strong>ã€‚</p><p>ä¸ <code>thenApply()</code> çš„åŒºåˆ«ï¼Ÿ</p><table><thead><tr><th>æ–¹æ³•å</th><th>æ˜¯å¦æ¥æ”¶å‰ä¸€ä¸ª Future çš„ç»“æœ</th><th>æ˜¯å¦æœ‰è¿”å›å€¼</th><th>æ˜¯å¦æ”¯æŒé“¾å¼è°ƒç”¨</th><th>æ˜¯å¦å¼‚æ­¥</th></tr></thead><tbody><tr><td><code>thenApply()</code></td><td>âœ… æ˜¯</td><td>âœ… æ˜¯ï¼ˆæ–°å€¼ï¼‰</td><td>âœ… æ”¯æŒ</td><td>âœ… å¼‚æ­¥</td></tr><tr><td><code>thenAccept()</code></td><td>âœ… æ˜¯</td><td>âŒ å¦ï¼ˆvoidï¼‰</td><td>âŒ ä¸ä¼ é€’å€¼</td><td>âœ… å¼‚æ­¥</td></tr><tr><td><code>thenRun()</code></td><td>âŒ å¦</td><td>âŒ å¦ï¼ˆvoidï¼‰</td><td>âŒ ä¸ä¼ é€’å€¼</td><td>âœ… å¼‚æ­¥</td></tr></tbody></table><p><code>thenAccept()</code>çš„åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Hello&quot;</span>);<br><br>future.thenAccept(result -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¥æ”¶åˆ°ç»“æœ: &quot;</span> + result);<br>&#125;);<br></code></pre></td></tr></table></figure><ul><li>æ¥æ”¶ä¸Šä¸€ä¸ª Future çš„ç»“æœä½œä¸ºè¾“å…¥</li><li>æ‰§è¡Œä¸€ä¸ªæ¶ˆè´¹å‹æ“ä½œï¼ˆå¦‚æ‰“å°ã€å†™æ—¥å¿—ã€å…¥åº“ç­‰ï¼‰</li><li><strong>æ²¡æœ‰è¿”å›å€¼</strong></li></ul><p><code>thenRun()</code>çš„åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ­£åœ¨æ‰§è¡Œä¸»ä»»åŠ¡...&quot;</span>);<br>&#125;);<br><br>future.thenRun(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;ä¸»ä»»åŠ¡å®Œæˆï¼Œæ‰§è¡Œåç»­æ¸…ç†æ“ä½œ&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><ul><li><strong>ä¸æ¥æ”¶ä¸Šä¸€ä¸ª Future çš„ç»“æœ</strong></li><li>åªåœ¨ Future å®Œæˆåæ‰§è¡Œä¸€ä¸ª Runnable ä»»åŠ¡</li><li>é€‚åˆç”¨äºæ‰§è¡Œä¸€äº›ä¸éœ€è¦ä¾èµ–ç»“æœçš„åç»­æ“ä½œï¼Œæ¯”å¦‚å‘é€é€šçŸ¥ã€æ¸…ç†èµ„æºç­‰</li></ul><p>æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¸ä¼šå½±å“é“¾å¼è°ƒç”¨çš„è¿”å›å€¼ï¼ä¸€ä¸ªè´Ÿè´£æ¶ˆè´¹ç»“æœï¼Œå¦ä¸€ä¸ªè´Ÿè´£åç»­åŠ¨ä½œã€‚</p><h3 id="whenComplete"><a href="#whenComplete" class="headerlink" title="whenComplete()"></a><code>whenComplete()</code></h3><p><strong><code>whenComplete()</code> æ˜¯ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œç”¨äºåœ¨ Future å®Œæˆï¼ˆæ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆï¼‰åæ‰§è¡Œä¸€æ®µé€»è¾‘ã€‚</strong></p><p>å¸¸ç”¨äºï¼š</p><ul><li>æ—¥å¿—è®°å½•</li><li>èµ„æºæ¸…ç†</li><li>å¼‚å¸¸ç›‘æ§</li><li>æœ€ç»ˆç»“æœå¤„ç†</li></ul><p><strong>åŸºæœ¬ç”¨æ³•ï¼šæ­£å¸¸å®Œæˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">&quot;Hello World&quot;</span>)<br>    .whenComplete((result, throwable) -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (throwable == <span class="hljs-literal">null</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡å®Œæˆï¼Œç»“æœä¸º: &quot;</span> + result);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.err.println(<span class="hljs-string">&quot;ä»»åŠ¡å‡ºé”™: &quot;</span> + throwable.getMessage());<br>        &#125;<br>    &#125;);<br><br>System.out.println(future.join()); <span class="hljs-comment">// è¾“å‡º Hello World</span><br></code></pre></td></tr></table></figure><p><strong>åŸºæœ¬ç”¨æ³•ï¼šå¼‚å¸¸å¤„ç†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;å‡ºé”™äº†ï¼&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;<br>&#125;).whenComplete((result, throwable) -&gt; &#123;<br>    <span class="hljs-keyword">if</span> (throwable != <span class="hljs-literal">null</span>) &#123;<br>        System.err.println(<span class="hljs-string">&quot;æ•è·åˆ°å¼‚å¸¸ï¼š&quot;</span> + throwable.getMessage());<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡æˆåŠŸå®Œæˆï¼Œç»“æœæ˜¯ï¼š&quot;</span> + result);<br>    &#125;<br>&#125;);<br><br><span class="hljs-comment">// å¯ä»¥ç»§ç»­é“¾å¼è°ƒç”¨</span><br>future.thenAccept(System.out::println); <span class="hljs-comment">// ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºå‰é¢æŠ›å¼‚å¸¸äº†</span><br></code></pre></td></tr></table></figure><h1 id="CompletableFutureä¸çº¿ç¨‹æ± ğŸ˜ˆ"><a href="#CompletableFutureä¸çº¿ç¨‹æ± ğŸ˜ˆ" class="headerlink" title="CompletableFutureä¸çº¿ç¨‹æ± ğŸ˜ˆ"></a>CompletableFutureä¸çº¿ç¨‹æ± ğŸ˜ˆ</h1><p>CompletableFutureä¸çº¿ç¨‹æ± å¹¶ä¸æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œè€Œæ˜¯ç›¸è¾…ç›¸æˆçš„ã€‚ä»–ä»¬éƒ½æœ‰å„è‡ªæ³¨é‡çš„é¢†åŸŸï¼Œä¸€ä¸ªæ›´æ³¨é‡å¼‚æ­¥ä»»åŠ¡ç¼–æ’ï¼Œä¸€ä¸ªæ›´åŠ æ³¨é‡çº¿ç¨‹èµ„æºçš„ç®¡ç†ã€‚è€Œä¸”æˆ‘ä»¬éå¸¸æ¨èä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± æ¥ä½¿ç”¨CompletableFutureï¼</p><p>psï¼šå¦‚æœéƒ½æ˜¯ç”¨åŒä¸€ä¸ªé»˜è®¤çº¿ç¨‹æ± å¦‚ <code>ForkJoinPool.commonPool()</code>ï¼Œå¯èƒ½ä¼šå‘ç”Ÿèµ„æºäº‰æŠ¢ç­‰é—®é¢˜ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½¿ç”¨ supplyAsync å¹¶æŒ‡å®šè‡ªå®šä¹‰çº¿ç¨‹æ± </span><br>CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>&#125;, customExecutor);<br></code></pre></td></tr></table></figure><h1 id="join-å’Œ-get-ğŸ˜«"><a href="#join-å’Œ-get-ğŸ˜«" class="headerlink" title="join() å’Œ get()ğŸ˜«"></a>join() å’Œ get()ğŸ˜«</h1><p>åœ¨ä½¿ç”¨ <code>CompletableFuture</code> æ—¶ï¼Œé€‰æ‹© <code>join()</code> è¿˜æ˜¯ <code>get()</code> ä¸»è¦å–å†³äºä½ å¯¹å¼‚å¸¸å¤„ç†çš„éœ€æ±‚ä»¥åŠæ˜¯å¦éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶è¶…æ—¶ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬å¦‚ä½•å¤„ç†å¼‚å¸¸å’Œè¶…æ—¶ï¼š</p><p> <code>join()</code></p><ul><li><strong>æŠ›å‡ºæœªç»æ£€æŸ¥çš„å¼‚å¸¸ï¼ˆUnchecked Exceptionsï¼‰</strong> ï¼šå¦‚æœ Future å®Œæˆæ—¶å¸¦æœ‰å¼‚å¸¸ï¼Œ<code>join()</code> ä¼šæŠ›å‡ºä¸€ä¸ªæœªæ£€æŸ¥çš„ <code>CompletionException</code>ï¼Œè¿™ä½¿å¾—ä»£ç çœ‹èµ·æ¥æ›´åŠ ç®€æ´ï¼Œå°¤å…¶æ˜¯åœ¨ Lambda è¡¨è¾¾å¼ä¸­ã€‚</li><li><strong>ä¸æ”¯æŒè¶…æ—¶å‚æ•°</strong>ï¼šå¦‚æœä½ ä¸éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´æ¥ç­‰å¾…ç»“æœï¼Œ<code>join()</code> æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> future.join();<br>&#125; <span class="hljs-keyword">catch</span> (CompletionException e) &#123;<br>    <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span><br>&#125;<br></code></pre></td></tr></table></figure><p> <code>get()</code></p><ul><li><strong>æŠ›å‡ºç»æ£€æŸ¥çš„å¼‚å¸¸ï¼ˆChecked Exceptionsï¼‰</strong> ï¼šåŒ…æ‹¬ <code>InterruptedException</code> å’Œ <code>ExecutionException</code>ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜è¿™äº›å¼‚å¸¸æˆ–åœ¨è°ƒç”¨å¤„æ•è·å®ƒä»¬ã€‚</li><li><strong>æ”¯æŒè¶…æ—¶å‚æ•°</strong>ï¼šå…è®¸ä½ æŒ‡å®šç­‰å¾…ç»“æœçš„æœ€å¤§æ—¶é—´ï¼Œè¿™å¯¹äºé¿å…æ— é™æœŸç­‰å¾…æŸäº›æ“ä½œå®Œæˆç‰¹åˆ«æœ‰ç”¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> future.get(<span class="hljs-number">1</span>, TimeUnit.SECONDS); <span class="hljs-comment">// ç­‰å¾…æœ€å¤š1ç§’</span><br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>    <span class="hljs-comment">// å½“å‰çº¿ç¨‹è¢«ä¸­æ–­æ—¶æ‰§è¡Œ</span><br>&#125; <span class="hljs-keyword">catch</span> (ExecutionException e) &#123;<br>    <span class="hljs-comment">// å½“Futureå®Œæˆæ—¶å‘ç”Ÿå¼‚å¸¸</span><br>&#125; <span class="hljs-keyword">catch</span> (TimeoutException e) &#123;<br>    <span class="hljs-comment">// è¶…è¿‡æŒ‡å®šæ—¶é—´æœªå®Œæˆä»»åŠ¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨å»ºè®®</strong></p><ul><li><p><strong>æ¨èä½¿ç”¨ <code>join()</code> çš„åœºæ™¯</strong>ï¼š</p><ul><li>å½“ä½ å¸Œæœ›ä¿æŒä»£ç ç®€æ´ï¼Œå¹¶ä¸”ä¸æƒ³å¤„ç†å¤æ‚çš„å¼‚å¸¸ç»“æ„æ—¶ã€‚</li><li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå°¤å…¶æ˜¯å½“ä½ å·²ç»åœ¨æ›´é«˜çš„å±‚æ¬¡ä¸Šå®ç°äº†å¼‚å¸¸å¤„ç†é€»è¾‘æ—¶ï¼Œ<code>join()</code> æä¾›äº†ä¸€ç§æ›´ç›´æ¥çš„æ–¹å¼æ¥è·å–ç»“æœã€‚</li></ul></li><li><p><strong>æ¨èä½¿ç”¨ <code>get()</code> çš„åœºæ™¯</strong>ï¼š</p><ul><li>å½“ä½ éœ€è¦å¯¹è¶…æ—¶è¿›è¡Œç²¾ç¡®æ§åˆ¶æ—¶ã€‚</li><li>å¦‚æœä½ éœ€è¦æ˜ç¡®åŒºåˆ†ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼ˆå¦‚ä¸­æ–­ã€æ‰§è¡Œé”™è¯¯ç­‰ï¼‰ï¼Œä»¥ä¾¿é‡‡å–ä¸åŒçš„æ¢å¤æªæ–½ã€‚</li></ul></li></ul><p>æ€»çš„æ¥è¯´ï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šéœ€æ±‚çš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ä¸éœ€è¦è¶…æ—¶æ§åˆ¶ï¼‰ï¼Œ<strong>æ›´æ¨èä½¿ç”¨ <code>join()</code></strong> ï¼Œå› ä¸ºå®ƒç®€åŒ–äº†å¼‚å¸¸å¤„ç†æµç¨‹ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚ä¸è¿‡ï¼Œå…·ä½“é€‰æ‹©åº”åŸºäºä½ çš„å®é™…éœ€æ±‚å’Œä¸Šä¸‹æ–‡ç¯å¢ƒã€‚</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>Javaå¹¶å‘ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>Javaå¹¶å‘ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£CAPç†è®º</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3CAP%E7%90%86%E8%AE%BA/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3CAP%E7%90%86%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>ç°ä»£ç½‘ç«™æ­å»ºçš„ä¸€èˆ¬éƒ½æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè€ŒèŠåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡ä¸æ„å»ºï¼Œé‚£å°±æ— æ³•é¿å¼€CAPç†è®ºï¼Œä»Šå¤©æ¥èŠä¸€ä¸‹CAPç†è®º</p><h1 id="CAPå®šä¹‰ğŸ˜ª"><a href="#CAPå®šä¹‰ğŸ˜ª" class="headerlink" title="CAPå®šä¹‰ğŸ˜ª"></a>CAPå®šä¹‰ğŸ˜ª</h1><p>capç†è®ºæ˜¯æŒ‡è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPartition toleranceï¼‰è¿™ä¸‰ä¸ªå±æ€§æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ªã€‚</p><ol><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong> ï¼šæ¯ä¸ªè¯»æ“ä½œéƒ½èƒ½çœ‹åˆ°æœ€è¿‘ä¸€æ¬¡å†™æ“ä½œçš„ç»“æœã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´ç‚¹ä¸Šçœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚è¿™ä¸ACIDäº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§æ¦‚å¿µç›¸ä¼¼ã€‚CAPç†è®ºä¸­çš„ä¸€è‡´æ€§æ˜¯æŒ‡å¼ºä¸€è‡´æ€§ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°ç›¸åŒçš„æ•°æ®ã€‚</li><li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong> ï¼šç³»ç»ŸæŒç»­å“åº”è¯·æ±‚çš„èƒ½åŠ›ã€‚å³ä½¿å‡ºç°ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹æ•…éšœï¼Œæ•´ä¸ªç³»ç»Ÿä»ç„¶èƒ½å¤Ÿå¤„ç†è¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ã€‚</li><li><strong>åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition toleranceï¼‰</strong> ï¼šç³»ç»Ÿèƒ½å¤Ÿåœ¨ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ç»§ç»­è¿ä½œã€‚ç½‘ç»œåˆ†åŒºæŒ‡çš„æ˜¯ç”±äºç½‘ç»œåŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´æ— æ³•é€šä¿¡çš„æƒ…å†µ<br><a href="https://mermaid-live.nodejs.cn/edit#pako:eNp9UtFOgzAU_ZXmPpgtYcuEwYAHE8amvmj2wJN0DxXuRhNol1LUSfh3O3A6o7Ev7ek5556b9raQyRwhhL1ih4IkKyqIWVEaRxuSFCgVVlsymdyQZRpLUfNao8iO209Zz8Rp9MJ4yZ55yfVPapVumNJccylIIktUTGRoFINm2WvWbVxIWSNJXmU3EPFADGB1BgNc9_B2FG_IhFy0RK7IH1njS9PdKDqZLrv91_XtvE8pxNGvwMtKlIrRo9TkoFimecZKwgVRaPb6aAxVPaawBcs8NM8h1KpBCypUFTtBaE-JFHSBFVIIzTHHHWtKTYGKztgOTDxJWZ2dSjb7AsIdK2uDmkPONK44M79Yfd0qFDmqWDZCQ-h4fl8EwhbeIFwE07ln-45r-zPPmblzC44QXtvuNHDswPYCxw1m_nzeWfDex86mC2fhniyB5weubQcWYM61VA_DAPVz1H0AeL-z0g"><img src="https://i-blog.csdnimg.cn/img_convert/32a711b82803bb2f0c7b7de2dba006d6.jpeg"></a></li></ol><h1 id="CA-CP-APğŸ˜µ"><a href="#CA-CP-APğŸ˜µ" class="headerlink" title="CA,CP,APğŸ˜µ"></a>CA,CP,APğŸ˜µ</h1><h2 id="CA"><a href="#CA" class="headerlink" title="CA"></a>CA</h2><p>caæ˜¯æŒ‡æ”¾å¼ƒäº†åˆ†åŒºå®¹å¿æ€§ï¼Œé€‰æ‹©å¯ç”¨æ€§å’Œä¸€è‡´æ€§ï¼Œä½†æ˜¯è¿™æ ·å°±ä¸ç¬¦åˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡åˆè¡·ï¼Œåœ¨å®è·µä¸­ï¼Œç”±äºç½‘ç»œåˆ†åŒºå‡ ä¹æ˜¯ä¸å¯é¿å…çš„ï¼Œå› æ­¤è¿™ç§ç»„åˆå®é™…ä¸Šå¾ˆå°‘è¢«è€ƒè™‘ã€‚åœ¨è¿™é‡Œå°±ä¸åšå¤šè§£é‡Š</p><h2 id="CP"><a href="#CP" class="headerlink" title="CP"></a>CP</h2><p>caæ˜¯æŒ‡æ”¾å¼ƒäº†å¯ç”¨æ€§ï¼Œä¼˜å…ˆé€‰æ‹©ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹å¿æ€§ã€‚é‚£ä¹ˆç³»ç»Ÿåœ¨é‡åˆ°ç½‘ç»œåˆ†åŒºæ—¶ï¼Œä¼šä¼˜å…ˆä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¯èƒ½ä¼šç‰ºç‰²ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>åœ¨éœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯ï¼Œå°±éœ€è¦é€‰æ‹©cpæ¥ä½œä¸ºæŒ‡å¯¼åŸåˆ™ã€‚å¦‚é“¶è¡Œè½¬è´¦ã€äº¤æ˜“ç³»ç»Ÿç­‰ï¼Œåº”é€‰æ‹©CPç³»ç»Ÿï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ä¸ºäº†ä¿è¯å„ä¸ªèŠ‚ç‚¹æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œæ”¾å¼ƒäº†å¯ç”¨æ€§ï¼Œæ‰€ä»¥å½“æŸä¸ªåˆ†åŒºå‡ºç°æ•…éšœï¼Œç³»ç»Ÿå¯ä»¥ä¸æ–­é‡è¯•ç›´åˆ°åˆ†åŒºæ¢å¤å¯ç”¨ï¼Œäº‹åŠ¡ç»Ÿä¸€æˆåŠŸæˆ–è€…ç»Ÿä¸€å¤±è´¥ã€‚</p><h2 id="AP"><a href="#AP" class="headerlink" title="AP"></a>AP</h2><p>apæ˜¯æŒ‡æ”¾å¼ƒäº†ä¸€è‡´æ€§ï¼Œä¼˜å…ˆé€‰æ‹©å¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿æ€§ã€‚åˆ™åœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¼šä¼˜å…ˆä¿è¯å¯ç”¨æ€§ï¼Œå¯èƒ½ä¼šç‰ºç‰²ä¸€è‡´æ€§ã€‚</p><p>åœ¨éœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯ï¼Œå°±éœ€è¦é€‰æ‹©apæ¥ä½œä¸ºæŒ‡å¯¼åŸåˆ™ã€‚å¦‚ç¤¾äº¤ç½‘ç»œã€ç”µå•†ç½‘ç«™ç­‰ï¼Œå¯ä»¥é€‰æ‹©APç³»ç»Ÿï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚æ”¾å¼ƒäº†ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åˆé€‚å¤šçš„åˆ†åŒºï¼Œè¿™æ ·ç”¨æˆ·è®¿é—®é€Ÿåº¦å’Œä½“éªŒæ„Ÿå°±è¶Šé«˜ï¼Œå®ç°é«˜å¯ç”¨æ€§ï¼Œå½“æ•°æ®å†™å…¥ä¸»èŠ‚ç‚¹ä¹‹åï¼Œé€šè¿‡å¼‚æ­¥æ–¹å¼åŒæ­¥æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>æ³¨æ„ï¼Œåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œcapå¹¶ä¸æ˜¯ä¸‰é€‰äºŒçš„æƒ…å½¢ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸­é€‰æ‹©ä¸åŒçš„ç»„åˆã€‚è¿™æ„å‘³ç€åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç³»ç»Ÿå¯ä»¥åœ¨ä¸åŒæ—¶é—´ç‚¹å¯¹ä¸åŒçš„æ“ä½œåšå‡ºä¸åŒçš„æƒè¡¡ã€‚æ­¤å¤–ï¼Œç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸é€šè¿‡å„ç§æ–¹å¼æ¥å°½é‡å¹³è¡¡ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œä»¥è¾¾åˆ°æœ€ä½³å®è·µæ•ˆæœã€‚åœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„ä¼˜å…ˆçº§ã€‚</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>æ¶æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>æ¶æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£BASEç†è®º</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3BASE%E7%90%86%E8%AE%BA/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3BASE%E7%90%86%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€ğŸ˜µ"><a href="#å¼•è¨€ğŸ˜µ" class="headerlink" title="å¼•è¨€ğŸ˜µ"></a>å¼•è¨€ğŸ˜µ</h1><p>ç”±äºCAPç†è®ºçš„ä¸¥æ ¼æ€§ï¼Œæˆ‘ä»¬æ€¥éœ€ä¸€ç§æ„å»ºé«˜å¯ç”¨ï¼Œå¯æ‰©å±•çš„åˆ†å¸ƒå¼äº’è”ç½‘åº”ç”¨çš„æŒ‡å¯¼åŸåˆ™ï¼Œäºæ˜¯å‡ºç°äº†BASEç†è®ºã€‚BASEç†è®ºå¼ºè°ƒç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯å¼ºä¸€è‡´æ€§ã€‚ä¸‹é¢è®©æˆ‘ä»¬ä¸€èµ·äº†è§£ä¸€ä¸‹ã€‚</p><h1 id="Basically-Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ğŸ˜¯"><a href="#Basically-Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ğŸ˜¯" class="headerlink" title="Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ğŸ˜¯"></a>Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ğŸ˜¯</h1><p><strong>å®šä¹‰ï¼š</strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå³ä½¿å‘ç”Ÿä¸å¯é¢„çŸ¥çš„æ•…éšœï¼Œç³»ç»Ÿä¹Ÿè¦ä¿è¯<strong>æ ¸å¿ƒåŠŸèƒ½ä»ç„¶å¯ç”¨</strong>ï¼Œå³ä½¿ä¸æ˜¯å…¨éƒ¨åŠŸèƒ½éƒ½èƒ½æ­£å¸¸è¿è¡Œï¼Œæå‡ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›å’Œå¯ç”¨æ€§ã€‚</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><ul><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šé€šè¿‡å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œé¿å…å•ç‚¹æ•…éšœï¼Œç¡®ä¿éƒ¨åˆ†æœåŠ¡å™¨å¯ç”¨æ—¶ï¼Œç³»ç»Ÿä»èƒ½å“åº”è¯·æ±‚ã€‚</li><li><strong>æœåŠ¡é™çº§</strong>ï¼šå½“ç³»ç»Ÿèµ„æºç´§å¼ æˆ–å‡ºç°æ•…éšœæ—¶ï¼Œå…³é—­éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½çš„å¯ç”¨æ€§ã€‚</li><li><strong>æ•°æ®å¤‡ä»½</strong>ï¼šé€šè¿‡æ•°æ®å†—ä½™å¤‡ä»½ï¼Œå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹ï¼Œä¿è¯æ•°æ®çš„å¯ç”¨æ€§ã€‚</li><li><strong>å‰Šå³°å‡æµ</strong>ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤æ¥æŠµæŒ¡çªå‘çš„æµé‡å†²å‡»ï¼ŒæŒ‰ç…§ä¸€å®šé€Ÿç‡ç»™æ•°æ®åº“æ¶ˆè´¹ã€‚</li></ul><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ul><li><strong>ç”µå•†ç½‘ç«™</strong>ï¼šåœ¨ä¿ƒé”€æ´»åŠ¨æœŸé—´ï¼Œå³ä½¿éƒ¨åˆ†æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼Œä»ç„¶ä¿è¯ç”¨æˆ·å¯ä»¥æµè§ˆå•†å“å’Œä¸‹å•ã€‚</li><li><strong>ç¤¾äº¤ç½‘ç»œ</strong>ï¼šå³ä½¿éƒ¨åˆ†æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œä»ç„¶ä¿è¯ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œå‘å¸ƒåŠ¨æ€ã€‚</li><li><strong>åœ¨çº¿æ¸¸æˆ</strong>ï¼šå³ä½¿éƒ¨åˆ†æœåŠ¡å™¨ä¸ç¨³å®šï¼Œä»ç„¶ä¿è¯ç”¨æˆ·å¯ä»¥è¿›è¡Œæ¸¸æˆã€‚</li></ul><h1 id="Soft-Stateï¼ˆè½¯çŠ¶æ€ï¼‰ğŸ˜ª"><a href="#Soft-Stateï¼ˆè½¯çŠ¶æ€ï¼‰ğŸ˜ª" class="headerlink" title="Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰ğŸ˜ª"></a>Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰ğŸ˜ª</h1><p><strong>å®šä¹‰ï¼šç³»ç»Ÿä¸­çš„æ•°æ®å¯ä»¥å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œä¸è¦æ±‚æ‰€æœ‰æ•°æ®æ—¶åˆ»ä¿æŒä¸€è‡´æ€§</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ•°æ®å¯èƒ½æš‚æ—¶ä¸ä¸€è‡´ï¼ŒçŠ¶æ€å¯èƒ½ä¼šéšç€æ—¶é—´å˜åŒ–è€Œè‡ªåŠ¨æ›´æ–°ï¼Œä¸”ä¸è¦æ±‚ç³»ç»Ÿç«‹å³åŒæ­¥æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ã€‚è¿™é‡Œå°±ä»£è¡¨äº†ç‰ºç‰²å¼ºä¸€è‡´æ€§ã€‚</p><h2 id="å®ç°æ–¹å¼ï¼š"><a href="#å®ç°æ–¹å¼ï¼š" class="headerlink" title="å®ç°æ–¹å¼ï¼š"></a><strong>å®ç°æ–¹å¼</strong>ï¼š</h2><ul><li><strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼šä¸»èŠ‚ç‚¹å°†æ•°æ®å˜æ›´å¼‚æ­¥å¤åˆ¶åˆ°å¤‡ç”¨èŠ‚ç‚¹ï¼Œå…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…å­˜åœ¨ä¸ä¸€è‡´ã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§åè®®</strong>ï¼šä½¿ç”¨å¦‚Paxosã€Raftç­‰ä¸€è‡´æ€§åè®®ï¼Œä¿è¯æ•°æ®åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</li></ul><h2 id="ä½¿ç”¨åœºæ™¯ï¼š"><a href="#ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</h2><ul><li><strong>ç”µå•†ç½‘ç«™</strong>ï¼šç”¨æˆ·ä¸‹å•åï¼Œè®¢å•çŠ¶æ€çš„æ›´æ–°å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼Œä½†æœ€ç»ˆä¼šæ›´æ–°ä¸ºå·²æ”¯ä»˜æˆ–å·²å‘è´§çŠ¶æ€ã€‚</li><li><strong>ç¤¾äº¤ç½‘ç»œ</strong>ï¼šç”¨æˆ·å‘å¸ƒåŠ¨æ€åï¼ŒåŠ¨æ€çš„æ˜¾ç¤ºå¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼Œä½†æœ€ç»ˆä¼šæ˜¾ç¤ºåœ¨æ‰€æœ‰ç”¨æˆ·çš„timelineä¸­ã€‚</li><li><strong>åœ¨çº¿æ¸¸æˆ</strong>ï¼šç©å®¶çš„ç­‰çº§å’Œè£…å¤‡ä¿¡æ¯å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼Œä½†æœ€ç»ˆä¼šåŒæ­¥åˆ°æ‰€æœ‰å®¢æˆ·ç«¯ã€‚</li></ul><h1 id="Eventually-Consistentï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ğŸ˜—"><a href="#Eventually-Consistentï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ğŸ˜—" class="headerlink" title="Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ğŸ˜—"></a>Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ğŸ˜—</h1><p><strong>å®šä¹‰ï¼š</strong> æ‰€æœ‰å¯¹ç³»ç»Ÿçš„æ›´æ–°æ“ä½œï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæœ€ç»ˆä¼šä½¿å¾—æ‰€æœ‰å‰¯æœ¬è¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚</p><h2 id="å®ç°æ–¹å¼ï¼š-1"><a href="#å®ç°æ–¹å¼ï¼š-1" class="headerlink" title="å®ç°æ–¹å¼ï¼š"></a><strong>å®ç°æ–¹å¼</strong>ï¼š</h2><ul><li><strong>è¯»æ—¶ä¿®å¤</strong>ï¼šåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæ£€æµ‹æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¿›è¡Œä¿®å¤ã€‚</li><li><strong>å†™æ—¶ä¿®å¤</strong>ï¼šåœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒåŒæ—¶æ›´æ–°æ‰€æœ‰å‰¯æœ¬ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>å¼‚æ­¥ä¿®å¤</strong>ï¼šå®šæœŸæ£€æµ‹æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¿›è¡Œä¿®å¤ã€‚</li></ul><h2 id="ä½¿ç”¨åœºæ™¯ï¼š-1"><a href="#ä½¿ç”¨åœºæ™¯ï¼š-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</h2><ul><li><strong>DNS</strong>ï¼šåŸŸåè§£æè®°å½•åœ¨å…¨çƒå„åœ°çš„DNSæœåŠ¡å™¨ä¸ŠåŒæ­¥ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´ã€‚</li><li><strong>CDN</strong>ï¼šå†…å®¹åˆ†å‘ç½‘ç»œå°†å†…å®¹ç¼“å­˜åˆ°å…¨çƒå„åœ°çš„èŠ‚ç‚¹ä¸Šï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´ã€‚</li><li><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼šç¼“å­˜æ•°æ®åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸ŠåŒæ­¥ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´</li></ul><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>æ¶æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>æ¶æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨InnoDBä¸­å¦‚ä½•å®ç°ACID?</title>
    <link href="/2025/06/22/%E5%9C%A8InnoDB%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0ACID/"/>
    <url>/2025/06/22/%E5%9C%A8InnoDB%E4%B8%AD%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0ACID/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>å¤§å®¶å¥½å•Šï¼Œæˆ‘ä»¬åç«¯å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°å…³äºæ•°æ®åº“è®¾è®¡çš„é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦çœŸæ­£äº†è§£æ•°æ®åº“äº‹åŠ¡å¤„ç†æ—¶çš„å¿…é¡»å…·å¤‡çš„å››å¤§ç‰¹æ€§å‘¢ï¼Ÿæˆ‘ä»¬ä»Šå¤©å°±ä»¥MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“InnoDBæ¥è®²è®²ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°ACIDçš„ğŸ˜</p><h1 id="ACIDçš„å®šä¹‰ğŸ˜µ"><a href="#ACIDçš„å®šä¹‰ğŸ˜µ" class="headerlink" title="ACIDçš„å®šä¹‰ğŸ˜µ"></a>ACIDçš„å®šä¹‰ğŸ˜µ</h1><p>ACIDæ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä¸ºäº†ç¡®ä¿äº‹åŠ¡å¤„ç†å¯é è€Œå¿…é¡»å…·å¤‡çš„å››ä¸ªåŸºæœ¬å±æ€§çš„ç¼©å†™ã€‚è¿™å››ä¸ªå±æ€§åˆ†åˆ«æ˜¯ï¼š</p><ol><li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong> ï¼šæŒ‡æ•´ä¸ªæ•°æ®åº“æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸è¿›è¡Œã€‚å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£ä¹ˆæ‰€æœ‰å·²ç»æ‰§è¡Œçš„æ“ä½œéƒ½ä¼šè¢«å›æ»šåˆ°æ“ä½œå‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™äº›æ“ä½œä»æœªå‘ç”Ÿè¿‡ä¸€æ ·ã€‚</li><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong> ï¼šç¡®ä¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚è¿™æ„å‘³ç€äº‹åŠ¡å¿…é¡»å°†æ•°æ®åº“ä»ä¸€ç§æœ‰æ•ˆçŠ¶æ€å¸¦åˆ°å¦ä¸€ç§æœ‰æ•ˆçŠ¶æ€ï¼Œä¸èƒ½è¿åä»»ä½•å®Œæ•´æ€§çº¦æŸæ¡ä»¶ã€‚</li><li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong> ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡ä¹‹é—´åº”è¯¥æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå³ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”è¯¥å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œã€‚ä¸åŒçš„éš”ç¦»çº§åˆ«æä¾›äº†ä¸åŒç¨‹åº¦çš„äº‹åŠ¡é—´å¯è§æ€§çš„æ§åˆ¶ã€‚</li><li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong> ï¼šä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ”¹å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿ç³»ç»Ÿå‡ºç°æ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ol><p>ä¸Šé¢çš„å®˜æ–¹è¡¨è¿°æ˜¯ä¸æ˜¯æ²¡æœ‰ç†è§£åˆ°ä½å‘¢ï¼Ÿæˆ‘ä»¬å¾€ä¸‹ä»”ç»†å†çœ‹çœ‹ï¼Œä½ è‚¯å®šå¯ä»¥ç†è§£çš„ğŸ‘Œ</p><h1 id="InnoDBå®ç°åŸå­æ€§ğŸ˜¯"><a href="#InnoDBå®ç°åŸå­æ€§ğŸ˜¯" class="headerlink" title="InnoDBå®ç°åŸå­æ€§ğŸ˜¯"></a>InnoDBå®ç°åŸå­æ€§ğŸ˜¯</h1><p>åŸå­æ€§ï¼Œä¸ºä»€ä¹ˆæ˜¯åŸå­æ€§å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å­¦è¿‡ç‰©ç†éƒ½çŸ¥é“ï¼ŒåŸå­æ˜¯ç‰©è´¨çš„åŸºæœ¬æ„æˆå•ä½ï¼Œå°½ç®¡åŸå­åœ¨ç‰©ç†ä¸–ç•Œä¸­æœ¬èº«å¯ä»¥å†è¿›è¡Œæ‹†åˆ†ï¼Œä½†æˆ‘ä»¬åœ¨å¤§éƒ¨åˆ†åŒ–å­¦ååº”å’Œç‰©ç†ååº”éƒ½å°†å…¶è§†ä¸ºæœ€åŸºæœ¬çš„å•ä½ï¼Œé€šä¿—çš„æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯ä¸å¯æ‹†åˆ†çš„ä¸€æ­¥ã€‚æˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“äº‹åŠ¡è§†ä½œä¸ºâ€œä¸å¯æ‹†åˆ†â€çš„ä¸€æ­¥ï¼Œé‡Œé¢çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸è¿›è¡Œï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå«åšåŸå­æ€§çš„åŸå› ã€‚</p><p>é‚£ä¹ˆInnoDBæ˜¯å¦‚ä½•å®ç°åŸå­æ€§çš„å‘¢ï¼Ÿé€šè¿‡äº‹åŠ¡æ—¥å¿—ï¼ˆredo logå’Œundo logï¼‰æ¥å®ç°ã€‚å½“ä¸€ä¸ªäº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ‰€æœ‰çš„ä¿®æ”¹é¦–å…ˆè®°å½•åœ¨redo logä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰æ¥æš‚å­˜æ•°æ®é¡µçš„ä¿®æ”¹ã€‚å¦‚æœäº‹åŠ¡å¤±è´¥æˆ–ä¸­é€”éœ€è¦å›æ»šï¼Œå¯ä»¥é€šè¿‡undo logæ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ï¼›è€Œå½“äº‹åŠ¡æˆåŠŸæäº¤åï¼Œå³ä¾¿ç³»ç»Ÿå´©æºƒï¼Œé‡å¯æ—¶ä¹Ÿå¯ä»¥æ ¹æ®redo logé‡åšæœªæŒä¹…åŒ–çš„ä¿®æ”¹ï¼Œä»è€Œä¿è¯äº†äº‹åŠ¡çš„åŸå­æ€§ã€‚</p><h1 id="InnoDBå®ç°éš”ç¦»æ€§ğŸ˜¶â€ğŸŒ«ï¸"><a href="#InnoDBå®ç°éš”ç¦»æ€§ğŸ˜¶â€ğŸŒ«ï¸" class="headerlink" title="InnoDBå®ç°éš”ç¦»æ€§ğŸ˜¶â€ğŸŒ«ï¸"></a>InnoDBå®ç°éš”ç¦»æ€§ğŸ˜¶â€ğŸŒ«ï¸</h1><p>ä¸ºä»€ä¹ˆæ˜¯éš”ç¦»æ€§å‘¢ï¼Ÿæ•°æ®åº“ä¸æ˜¯ä¸€ä¸ªæ•´ä½“å—ï¼Ÿæœ‰è¿™ä¸ªç–‘é—®çš„å°ä¼™ä¼´ï¼Œè¦è®¤çœŸçœ‹çœ‹äº†ã€‚MySQLæ˜¯æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥æ•°æ®åº“çš„ï¼Œé‚£ä¹ˆè¿™æ ·å°±å¸¦æ¥äº†å¹¶å‘æ€§é—®é¢˜ï¼Œå¦‚æœå¤šä¸ªè¿æ¥å¯¹åŒä¸€ä»½æ•°æ®è¯»ï¼Œå¤šä¸ªäº‹åŠ¡ç›´æ¥ä¸æ˜¯å„è‡ªä¸€ä»½ç©ºé—´ï¼ˆéš”ç¦»ï¼‰é‚£å²‚ä¸æ˜¯ä¼šä¹±å¥—äº†ï¼Ÿï¼ˆæ¯”å¦‚å¦ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°äº†ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œä½†æ˜¯è¯¥äº‹åŠ¡å›æ»šäº†ï¼Œæ•°æ®æ›´æ”¹è¢«å–æ¶ˆäº†ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°çš„å°±æ˜¯è„æ•°æ®ï¼‰ã€‚æ‰€ä»¥InnoDBå®ç°éš”ç¦»æ€§ï¼Œé˜²æ­¢å‡ºç°è„è¯»ï¼Œä¸å¯é‡å¤è¯»ç­‰é—®é¢˜</p><p>InnoDBé»˜è®¤æä¾›çš„æ˜¯å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰çº§åˆ«çš„éš”ç¦»æ€§ï¼Œè¿™æ˜¯é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCC, Multi-Version Concurrency Controlï¼‰æŠ€æœ¯å®ç°çš„ã€‚MVCCå…è®¸æŸ¥è¯¢æ“ä½œè¯»å–äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®å¿«ç…§ï¼Œè€Œä¸æ˜¯é”å®šè¡Œï¼Œä»è€Œå‡å°‘é˜»å¡å¹¶æé«˜å¹¶å‘æ€§èƒ½ã€‚å¯¹äºæ›´é«˜è¦æ±‚çš„éš”ç¦»çº§åˆ«ï¼Œå¦‚åºåˆ—åŒ–ï¼ˆSerializableï¼‰ï¼Œåˆ™ä¼šé‡‡ç”¨é”æœºåˆ¶æ¥é˜²æ­¢å¹»è¯»ç­‰é—®é¢˜ã€‚</p><p>å¯é‡å¤è¯»ï¼Œæ˜¯åœ¨äº‹åŠ¡å¼€å§‹æ—¶è¯»å–ä¸€ä»½å¿«ç…§ï¼ˆRead Viewï¼‰ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡è¿›ç¨‹ä¸­ï¼Œå§‹ç»ˆä½¿ç”¨çš„æ˜¯è¿™ä»½å¿«ç…§ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ¯ä¸ªäº‹åŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªäº‹åŠ¡å†…è¯»åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ˜¯å¯é‡å¤è¯»çš„ã€‚</p><h1 id="InnoDBå®ç°æŒä¹…æ€§ğŸ¤©"><a href="#InnoDBå®ç°æŒä¹…æ€§ğŸ¤©" class="headerlink" title="InnoDBå®ç°æŒä¹…æ€§ğŸ¤©"></a>InnoDBå®ç°æŒä¹…æ€§ğŸ¤©</h1><p>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå°±ä¼šäº§ç”Ÿæ›´æ”¹ï¼Œå³ä½¿ç³»ç»Ÿçªç„¶å®•æœºï¼Œå·²ç»æäº¤çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œè¿™å°±æ˜¯æŒä¹…æ€§ã€‚</p><p>ä¸€æ—¦äº‹åŠ¡è¢«æäº¤ï¼Œå…¶å¯¹æ•°æ®åº“çš„æ”¹å˜å°±ä¼šè¢«å†™å…¥ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶ï¼Œä»¥ç¡®ä¿å³ä½¿å‘ç”Ÿç³»ç»Ÿæ•…éšœï¼Œå·²æäº¤çš„æ›´æ”¹ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚InnoDBåˆ©ç”¨redo logæ¥å¿«é€Ÿè®°å½•å·²å®Œæˆä½†å°šæœªå†™å…¥æ•°æ®æ–‡ä»¶çš„äº‹åŠ¡ä¿®æ”¹ï¼Œåœ¨ç³»ç»Ÿæ¢å¤æœŸé—´å¯ä»¥ä¾æ®redo logé‡æ–°åº”ç”¨è¿™äº›ä¿®æ”¹ï¼Œä»è€Œä¿éšœäº†äº‹åŠ¡çš„æŒä¹…æ€§</p><h1 id="InnoDBå®ç°ä¸€è‡´æ€§ğŸ˜‰"><a href="#InnoDBå®ç°ä¸€è‡´æ€§ğŸ˜‰" class="headerlink" title="InnoDBå®ç°ä¸€è‡´æ€§ğŸ˜‰"></a>InnoDBå®ç°ä¸€è‡´æ€§ğŸ˜‰</h1><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªé“¶è¡Œè´¦æˆ·è½¬è´¦äº‹åŠ¡ä»è´¦æˆ·Aè½¬å‡º100å…ƒåˆ°è´¦æˆ·Bï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œè´¦æˆ·Açš„é’±å‡å°‘äº†è€Œè´¦æˆ·Bçš„é’±å°šæœªå¢åŠ ï¼Œè¿™å°†å¯¼è‡´æ•°æ®åº“æš‚æ—¶å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´æ€§ç¡®ä¿äº†è¿™ç§æƒ…å†µä¸ä¼šå‡ºç°ç»™å…¶ä»–äº‹åŠ¡çœ‹åˆ°ï¼Œå¹¶ä¸”ä¸€æ—¦äº‹åŠ¡å®Œæˆï¼Œä¸¤ä¸ªè´¦æˆ·çš„ä½™é¢éƒ½ä¼šæ›´æ–°ä¸ºæœ€ç»ˆæ­£ç¡®ä¸”åˆæ³•çš„çŠ¶æ€ã€‚åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œç»“æŸä¹‹åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«è¿åï¼Œç¡®ä¿æ•°æ®å¤„äºä¸€è‡´çš„æœ‰æ•ˆçŠ¶æ€ã€‚è¿™å°±æ˜¯ä¸€è‡´æ€§ã€‚</p><p>InnoDBé€šè¿‡æ”¯æŒå¤–é”®ã€æ£€æŸ¥çº¦æŸç­‰æœºåˆ¶æ¥å¸®åŠ©ç»´æŠ¤æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ­¤å¤–ï¼ŒåŸå­æ€§å’Œéš”ç¦»æ€§çš„æ­£ç¡®å®ç°ä¹Ÿæ˜¯ä¿æŒæ•°æ®åº“ä¸€è‡´æ€§çš„å…³é”®å› ç´ ã€‚ä¸€è‡´æ€§ä¹Ÿéƒ½æ˜¯ä¾é å…¶ä»–ä¸‰ä¸ªç‰¹æ€§æ‰å¯ä»¥å®ç°çš„ã€‚</p><h1 id="é¢è¯•ğŸ¥²"><a href="#é¢è¯•ğŸ¥²" class="headerlink" title="é¢è¯•ğŸ¥²"></a>é¢è¯•ğŸ¥²</h1><p>è¿™æ˜¯ä»Šå¹´æš‘æœŸæŸå¤§å‚åç«¯é¢è¯•é¢˜ä¹‹ä¸€ï¼Œè¦æ±‚é¢è¯•è€…è¦ç†è§£æ•°æ®åº“çš„å››å¤§ç‰¹æ€§ï¼Œå¹¶é€šè¿‡ç®€çŸ­ç®€æ´çš„ä¾‹å­åŠ ä»¥è¯´æ˜ã€‚ç›¸ä¿¡è¿™ç¯‡æ–‡ç« èƒ½å¸¦ç»™ä½ æ”¶è·ï¼Œå¦‚æœæœ‰æ‰€æ”¶è·è¯·ç‚¹èµåŠ æ”¶è—ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼ï¼ï¼</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€æ¬¡å…³äºNacosé…ç½®ä¸­å¿ƒé—®é¢˜è®°å½•ä¸è§£å†³</title>
    <link href="/2025/06/22/%E4%B8%80%E6%AC%A1%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%E4%B8%8E%E8%A7%A3%E5%86%B3/"/>
    <url>/2025/06/22/%E4%B8%80%E6%AC%A1%E5%85%B3%E4%BA%8ENacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%E4%B8%8E%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€ğŸ˜«"><a href="#å¼•è¨€ğŸ˜«" class="headerlink" title="å¼•è¨€ğŸ˜«"></a>å¼•è¨€ğŸ˜«</h1><p>ç¬”è€…æœ€è¿‘åœ¨é­”æ”¹è‡ªå·±çš„ç»„ä»¶é¡¹ç›®ï¼Œäºæ˜¯æƒ³åˆ°äº†å¼•å…¥Nacosæ¥ä½œä¸ºè‡ªå·±çš„é…ç½®ä¸­å¿ƒï¼Œä½†æ˜¯åœ¨å†™å¥½ç›¸åº”çš„ä»£ç åå‡ºç°äº†é—®é¢˜ï¼Œåé¢ä¼šè¯¦ç»†å™è¿°</p><h1 id="ç¯å¢ƒä»‹ç»ğŸ˜ª"><a href="#ç¯å¢ƒä»‹ç»ğŸ˜ª" class="headerlink" title="ç¯å¢ƒä»‹ç»ğŸ˜ª"></a>ç¯å¢ƒä»‹ç»ğŸ˜ª</h1><p>æ¥ä¸‹æ¥å…ˆæ¥ä»‹ç»ç¬”è€…çš„é¡¹ç›®ç¯å¢ƒ</p><ul><li>SpringBootï¼š2.7.12</li><li>jdkï¼š17</li><li>nacosï¼š2.5.1</li><li>spring-cloud-starter-alibaba-nacos-configï¼š2021.0.6.0</li><li>snakeyamlï¼š1.30</li></ul><p>ä»¥ä¸‹æ˜¯ç›¸åº”çš„pomæ–‡ä»¶é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pom">&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;<br>    &lt;version&gt;2021.0.6.0&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.yaml&lt;/groupId&gt;<br>    &lt;artifactId&gt;snakeyaml&lt;/artifactId&gt;<br>    &lt;version&gt;1.30&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆé€‰ç”¨nacos2.5.1ï¼Œå› ä¸ºå®˜æ–¹æ–‡æ¡£ä»‹ç»ä»–æ˜¯ç¨³å®šç”Ÿäº§ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥å‘ä¸‹å…¼å®¹ã€‚</p><p>ä¸ºä»€ä¹ˆé€‰ç”¨spring-cloud-starter-alibaba-nacos-configï¼š2021.0.6.0ï¼Œå› ä¸ºä¸ºäº†åŒ¹é…ç¬”è€…çš„springBootç‰ˆæœ¬ã€‚</p><h1 id="é—®é¢˜ä»‹ç»ğŸ¥¹"><a href="#é—®é¢˜ä»‹ç»ğŸ¥¹" class="headerlink" title="é—®é¢˜ä»‹ç»ğŸ¥¹"></a>é—®é¢˜ä»‹ç»ğŸ¥¹</h1><p>å½“ç¬”è€…ç¼–å†™å®Œç›¸åº”ä»£ç æ—¶ï¼Œè¿›è¡Œæµ‹è¯•æ—¶ï¼Œå‘ç°æ— æ³•å¯åŠ¨åº”ç”¨ã€‚ç›¸åº”çš„æœ‰ä¸»è¦ä¸¤ä¸ªæŠ¥é”™ã€‚</p><p>psï¼šè¿™ä¸¤ä¸ªæŠ¥é”™ä¸æ˜¯ä¸€èµ·å‡ºç°çš„ï¼Œç¬”è€…åªæ˜¯å°†ä»–ä»¬åˆåœ¨ä¸€èµ·è®²è§£ã€‚</p><p>æŠ¥é”™ä¸€ï¼šjava.lang.IllegalStateException:<strong>Unable to load config data from nacos</strong></p><p>æŠ¥é”™äºŒï¼šDEBUG org.springframework.boot.diagnostics.LoggingFailureAnalysisReporter - Application failed to start due to an exception org.springframework.cloud.commons.ConfigDataMissingEnvironmentPostProcessor$ImportException: <strong>No spring.config.import set</strong></p><h1 id="é—®é¢˜åˆ†æğŸ«¨"><a href="#é—®é¢˜åˆ†æğŸ«¨" class="headerlink" title="é—®é¢˜åˆ†æğŸ«¨"></a>é—®é¢˜åˆ†æğŸ«¨</h1><h2 id="æŠ¥é”™ä¸€"><a href="#æŠ¥é”™ä¸€" class="headerlink" title="æŠ¥é”™ä¸€"></a>æŠ¥é”™ä¸€</h2><p>æŠ¥é”™ä¸€çš„æ„æ€å¤§æ¦‚å°±æ˜¯è¯´ï¼šè¿™ä¸ªé”™è¯¯æ˜¯ Spring Boot åœ¨å°è¯•åŠ è½½ Nacos é…ç½®æ—¶ï¼Œ<strong>æ— æ³•è¯†åˆ«é…ç½®æ–‡ä»¶çš„æ ¼å¼ï¼ˆå³ <code>file-extension</code>ï¼‰</strong> ï¼Œæˆ–è€…æ²¡æœ‰æ­£ç¡®æŒ‡å®šé…ç½®æºç±»å‹</p><p>ç¬”è€…ç„¶ååœ¨<strong>bootstrap.yml</strong>æ–‡ä»¶è¿™æ ·é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">a00510c4-c973-4179-961e-dd500a1c350d</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span><br></code></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯æ·»åŠ äº†file-extension: yamlï¼Œæ–‡ä»¶è¯†åˆ«ä¸ºyamlæ ¼å¼</p><p>ç¬”è€…å°†mavenè¿›è¡Œclean + installä¹‹åè¿˜æ˜¯ä¸è¡Œï¼ŒæŠ¥é”™ä¾ç„¶æ˜¯æŠ¥é”™ä¸€</p><h2 id="æŠ¥é”™äºŒ"><a href="#æŠ¥é”™äºŒ" class="headerlink" title="æŠ¥é”™äºŒ"></a>æŠ¥é”™äºŒ</h2><p>æŠ¥é”™äºŒçš„æ„æ€å¤§æ¦‚å°±æ˜¯Spring Boot 2.4 å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„å¤–éƒ¨é…ç½®åŠ è½½æœºåˆ¶ï¼ˆ<code>ConfigData</code>ï¼‰ï¼ŒSpringBootè¦æ˜¾å¼çš„å£°æ˜ä»å“ªé‡Œå¯¼å…¥é…ç½®ï¼Œæ¯”å¦‚nacosã€‚</p><p>ç„¶åç¬”è€…åœ¨<strong>bootstrap.yml</strong>æ–‡ä»¶è¿™æ ·è¿›è¡Œé…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">config:</span> <br>    <span class="hljs-attr">import:</span> <span class="hljs-bullet">-</span> <span class="hljs-string">nacos</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">a00510c4-c973-4179-961e-dd500a1c350d</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span><br></code></pre></td></tr></table></figure><p>ç»“æœè¿˜æ˜¯æŠ¥é”™äºŒ</p><h2 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h2><p>ç¬”è€…ç”±è¿™ä¸¤ä¸ªæŠ¥é”™è”æƒ³åˆ°ï¼Œè¿™ä¸¤ä¸ªæŠ¥é”™éƒ½æœ‰ä¸ªå…±åŒç‚¹ï¼Œå°±æ˜¯æ— æ³•è¯†åˆ«é…ç½®æºçš„ä¿¡æ¯ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œé‚£ä¹ˆæˆ‘ç›´æ¥ç¦ç”¨æ£€æŸ¥ï¼Œå…ˆè®©åº”ç”¨å¯åŠ¨è·‘èµ·æ¥çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–æŠ¥é”™ä¸å°±è¡Œäº†å—ï¼Ÿ</p><h1 id="è§£å†³ğŸ˜ˆ"><a href="#è§£å†³ğŸ˜ˆ" class="headerlink" title="è§£å†³ğŸ˜ˆ"></a>è§£å†³ğŸ˜ˆ</h1><p>æŒ‰ç…§ä¸Šè¿°æ€è·¯ï¼Œç¬”è€…æ‰“ç®—ä¸€æ‹›å°±è§£å†³ä¸¤ä¸ªæŠ¥é”™ï¼Œè¯•è¯•å°±è¯•è¯•ï¼ï¼</p><p>bootstrap.ymlå¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">a00510c4-c973-4179-961e-dd500a1c350d</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span><br></code></pre></td></tr></table></figure><p>application.ymlå¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">dynamic-thread-pool-test-app</span><br><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span><br></code></pre></td></tr></table></figure><p>application-dev.ymlå¦‚ä¸‹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8093</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">a00510c4-c973-4179-961e-dd500a1c350d</span><br>        <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span><br>        <span class="hljs-attr">data-id:</span> <span class="hljs-string">dynamic-thread-pool-test-app-dev.yaml</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span><br>        <span class="hljs-attr">import-check:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">extension-configs:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">data-id:</span> <span class="hljs-string">dynamic-thread-pool-test-app-dev.yaml</span><br>            <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span><br>            <span class="hljs-attr">refresh:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ä¸»è¦è§£å†³é—®é¢˜çš„ç‚¹åœ¨äºä½¿ç”¨äº†import-check: enabled: falseï¼Œç¦ç”¨äº†æ£€æŸ¥ã€‚</p><p>ç¬”è€…ç„¶åé¡ºåˆ©äº†å¯åŠ¨åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼Œåº”ç”¨çš„æ–°åŠŸèƒ½éƒ½æŒ‰ç…§é¢„æœŸè¿›è¡Œï¼Œæ²¡æœ‰å…¶ä»–bugã€‚</p><h1 id="åæ€ğŸ¥°"><a href="#åæ€ğŸ¥°" class="headerlink" title="åæ€ğŸ¥°"></a>åæ€ğŸ¥°</h1><p>ç¬”è€…è§‰å¾—åº”è¯¥æ˜¯bootçš„ç‰ˆæœ¬å’Œnacosçš„ç‰ˆæœ¬æœ‰ç‚¹å†²çªå¯¼è‡´çš„ï¼Œæˆ–è€…æ˜¯ç¬”è€…è¿˜æ²¡æœ‰çœŸæ­£çš„æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œåªèƒ½ä½¿ç”¨åœæ­¢æ£€æŸ¥çš„æ‰‹æ®µï¼Œå¦‚æœä½ ä¹Ÿæœ‰è¿™æ ·çš„å›°æƒ‘ï¼Œä¸å¦¨ä¹Ÿè¯•è¯•æˆ‘çš„æ–¹æ³•ã€‚ä¹Ÿè¯·æœ‰æ‡‚çš„ä½¬æ¥çœ‹çœ‹æ˜¯æ€ä¹ˆå›äº‹ï¼Œè¯„è®ºåŒºè§ã€‚</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™æ˜¯ç¬”è€…çš„ä¸€æ¬¡æŠ¥é”™è§£å†³ï¼Œå¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>Nacos</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼è§£å†³åç«¯æ¥å£æ…¢å¦‚ä½•æ’æŸ¥ä¼˜åŒ–</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E8%A7%A3%E5%86%B3%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E6%85%A2%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E4%BC%98%E5%8C%96/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E8%A7%A3%E5%86%B3%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E6%85%A2%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>è‡ªå·±è´Ÿè´£çš„åç«¯åº”ç”¨æ¨¡å—ä¸Šçº¿åï¼Œç»å®¢æˆ·åé¦ˆæ¥å£è°ƒç”¨æ…¢ï¼Œä¹Ÿå°±æ˜¯æ€§èƒ½å‡ºäº†é—®é¢˜ã€‚ä½†æ˜¯æ•´ä¸ªä¸šåŠ¡ç»„çš„åç«¯æ¥å£å¦‚æ­¤ä¹‹å¤šï¼Œæ€ä¹ˆæ’æŸ¥äº†è§£æ˜¯å“ªä¸ªæ¥å£å‡ºäº†é—®é¢˜ï¼Œæ€ä¹ˆä¼˜åŒ–æ¥å£æ€§èƒ½å‘¢ï¼Ÿä»Šå¤©å°±å’Œå¤§å®¶ä¸€èµ·æ¥æ¢è®¨ä¸€ä¸‹ã€‚</p><h1 id="æ’æŸ¥æ¥å£ğŸ˜«"><a href="#æ’æŸ¥æ¥å£ğŸ˜«" class="headerlink" title="æ’æŸ¥æ¥å£ğŸ˜«"></a>æ’æŸ¥æ¥å£ğŸ˜«</h1><h2 id="ç›‘æ§ä¸æ—¥å¿—"><a href="#ç›‘æ§ä¸æ—¥å¿—" class="headerlink" title="ç›‘æ§ä¸æ—¥å¿—"></a>ç›‘æ§ä¸æ—¥å¿—</h2><ul><li><p><strong>åº”ç”¨æ€§èƒ½ç›‘æ§ (APM) å·¥å…·ï¼š</strong>  ä½¿ç”¨ APM å·¥å…·ï¼ˆå¦‚ skywalkingï¼‰å¯ä»¥å…¨é¢ç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>å“åº”æ—¶é—´ï¼š</strong>  æ¥å£çš„å¹³å‡å“åº”æ—¶é—´ã€æœ€å¤§å“åº”æ—¶é—´ç­‰ã€‚</li><li><strong>ååé‡ï¼š</strong>  æ¯ç§’è¯·æ±‚æ•° (RPS) æˆ–æ¯åˆ†é’Ÿè¯·æ±‚æ•° (RPM)ã€‚</li><li><strong>é”™è¯¯ç‡ï¼š</strong>  æ¥å£çš„é”™è¯¯ç‡ï¼Œä¾‹å¦‚ 500 é”™è¯¯ã€‚</li><li><strong>èµ„æºåˆ©ç”¨ç‡ï¼š</strong>  CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ I&#x2F;Oã€ç½‘ç»œ I&#x2F;O ç­‰ã€‚</li><li><strong>è°ƒç”¨é“¾è¿½è¸ªï¼š</strong>  è·Ÿè¸ªè¯·æ±‚ä»è¿›å…¥åˆ°è¿”å›çš„å®Œæ•´è°ƒç”¨é“¾ï¼Œæ‰¾å‡ºç“¶é¢ˆæ‰€åœ¨ã€‚</li></ul></li><li><p><strong>æ—¥å¿—ï¼š</strong></p><ul><li><strong>è®¿é—®æ—¥å¿—ï¼š</strong>  è®°å½•æ¯ä¸ªè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯·æ±‚æ—¶é—´ã€å®¢æˆ·ç«¯ IPã€è¯·æ±‚è·¯å¾„ã€å“åº”æ—¶é—´ã€çŠ¶æ€ç ç­‰ã€‚</li><li><strong>åº”ç”¨æ—¥å¿—ï¼š</strong>  è®°å½•åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€é”™è¯¯ä¿¡æ¯ã€è°ƒè¯•ä¿¡æ¯ç­‰ã€‚</li><li><strong>GC æ—¥å¿—ï¼š</strong>  è®°å½•åƒåœ¾å›æ”¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œç”¨äºåˆ†æåƒåœ¾å›æ”¶æ˜¯å¦æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚</li></ul></li><li><p><strong>ç½‘ç»œæ’æŸ¥ï¼š</strong></p><ul><li>å¦‚æœæ¥å£æ¶‰åŠè·¨æœåŠ¡è°ƒç”¨ï¼Œæ£€æŸ¥ç½‘ç»œå»¶è¿Ÿæƒ…å†µã€‚å¯èƒ½éœ€è¦ä½¿ç”¨pingã€tracerouteç­‰å·¥å…·æ¥è¯Šæ–­ç½‘ç»œè¿æ¥çš„è´¨é‡ã€‚</li><li>è€ƒè™‘ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æºåŠ è½½ï¼Œå‡è½»æœåŠ¡å™¨å‹åŠ›</li></ul></li></ul><h2 id="åˆ†æç›‘æ§ä¸æ—¥å¿—"><a href="#åˆ†æç›‘æ§ä¸æ—¥å¿—" class="headerlink" title="åˆ†æç›‘æ§ä¸æ—¥å¿—"></a>åˆ†æç›‘æ§ä¸æ—¥å¿—</h2><ol><li><p><strong>ç¡®å®šé—®é¢˜èŒƒå›´ï¼š</strong></p><ul><li>æ˜¯æ‰€æœ‰æ¥å£éƒ½æ…¢ï¼Œè¿˜æ˜¯åªæœ‰ä¸ªåˆ«æ¥å£æ…¢ï¼Ÿ</li><li>æ˜¯æŒç»­æ€§æ…¢ï¼Œè¿˜æ˜¯å¶å‘æ€§æ…¢ï¼Ÿ</li><li>æ˜¯ç‰¹å®šç”¨æˆ·æ…¢ï¼Œè¿˜æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½æ…¢ï¼Ÿ</li></ul></li><li><p><strong>åˆ†æç›‘æ§æ•°æ®ï¼š</strong></p><ul><li>æŸ¥çœ‹ APM å·¥å…·çš„ç›‘æ§æ•°æ®ï¼Œæ‰¾å‡ºå“åº”æ—¶é—´é•¿çš„æ¥å£ã€‚</li><li>åˆ†æè®¿é—®æ—¥å¿—ï¼Œæ‰¾å‡ºæ…¢è¯·æ±‚çš„æ¨¡å¼ã€‚</li><li>åˆ†æåº”ç”¨æ—¥å¿—ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æˆ–å¼‚å¸¸å‘ç”Ÿã€‚</li><li>åˆ†æ GC æ—¥å¿—ï¼ŒæŸ¥çœ‹åƒåœ¾å›æ”¶æ˜¯å¦é¢‘ç¹æˆ–è€—æ—¶è¿‡é•¿ã€‚</li></ul></li><li><p><strong>è°ƒç”¨é“¾åˆ†æï¼š</strong></p><ul><li><p>ä½¿ç”¨ APM å·¥å…·çš„è°ƒç”¨é“¾è¿½è¸ªåŠŸèƒ½ï¼Œè·Ÿè¸ªæ…¢è¯·æ±‚çš„è°ƒç”¨é“¾ï¼Œæ‰¾å‡ºç“¶é¢ˆæ‰€åœ¨ã€‚</p></li><li><p>å¸¸è§çš„ç“¶é¢ˆåŒ…æ‹¬ï¼š</p><ul><li><strong>æ•°æ®åº“æŸ¥è¯¢ï¼š</strong>  æŸ¥è¯¢è¯­å¥æ…¢ã€ç´¢å¼•ç¼ºå¤±ã€æ•°æ®é‡è¿‡å¤§ç­‰ã€‚</li><li><strong>è¿œç¨‹è°ƒç”¨ï¼š</strong>  è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æ…¢ã€ç½‘ç»œå»¶è¿Ÿé«˜ç­‰ã€‚</li><li><strong>I&#x2F;O æ“ä½œï¼š</strong>  ç£ç›˜ I&#x2F;O æ…¢ã€ç½‘ç»œ I&#x2F;O æ…¢ç­‰ã€‚</li><li><strong>ä»£ç é€»è¾‘ï¼š</strong>  å¤æ‚çš„è®¡ç®—ã€æ­»å¾ªç¯ç­‰ã€‚</li></ul></li></ul></li></ol><h1 id="ä¼˜åŒ–æ¥å£ğŸ‘»"><a href="#ä¼˜åŒ–æ¥å£ğŸ‘»" class="headerlink" title="ä¼˜åŒ–æ¥å£ğŸ‘»"></a>ä¼˜åŒ–æ¥å£ğŸ‘»</h1><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ…¢æ¥å£ï¼Œæ¥ä¸‹æ¥å°±è¦æ ¹æ®å…¶å…·ä½“æƒ…å†µæ¥åŠ ä»¥ä¼˜åŒ–ã€‚</p><p><strong>1.æ•°æ®åº“ä¼˜åŒ–ï¼š</strong></p><ul><li>åˆ†æSQLè¯­å¥ï¼šä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤åˆ†æ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œæ‰¾å‡ºæ…¢æŸ¥è¯¢çš„åŸå› ã€‚</li><li>æ·»åŠ ç´¢å¼•ï¼šå¦‚æœé€šè¿‡åˆ†æè¯¥SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°æ— ç´¢å¼•ï¼Œå°±ä¸ºç»å¸¸æŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•</li><li>é˜²æ­¢ç´¢å¼•å¤±æ•ˆï¼šå¦‚æœSQLè¯­å¥æ²¡æœ‰éµå¾ªç´¢å¼•ä½¿ç”¨çš„ç›¸å…³è§„åˆ™ï¼Œå°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä¾‹å¦‚ä½¿ç”¨äº†å·¦æ¨¡ç³Šæˆ–è€…å·¦å³æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ç­‰</li><li>ä¼˜åŒ–SQLè¯­å¥ï¼šé€šè¿‡é¿å…ä½¿ç”¨ <code>SELECT *</code>ï¼ŒåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼›é¿å…åœ¨ <code>WHERE</code> å­å¥ä¸­ä½¿ç”¨å‡½æ•°ï¼›ä½¿ç”¨æ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ“ä½œç­‰æ¥æé«˜SQLæ•ˆç‡ã€‚</li><li>æ•°æ®åº“è¿æ¥æ± ï¼šç¡®ä¿æ•°æ®åº“è¿æ¥æ± é…ç½®åˆç†ï¼Œé¿å…è¿æ¥æ•°ä¸è¶³æˆ–è¿‡å¤šã€‚</li></ul><p> <strong>2. è¿œç¨‹è°ƒç”¨ä¼˜åŒ–ï¼š</strong></p><ul><li><strong>è¶…æ—¶è®¾ç½®ï¼š</strong>  è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…ã€‚</li><li><strong>é‡è¯•æœºåˆ¶ï¼š</strong>  å®ç°é‡è¯•æœºåˆ¶ï¼Œå¤„ç†å¶å‘æ€§è°ƒç”¨å¤±è´¥ã€‚</li><li><strong>å¼‚æ­¥è°ƒç”¨ï¼š</strong>  ä½¿ç”¨å¼‚æ­¥è°ƒç”¨ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</li><li><strong>ä¸²è¡Œæ”¹å¹¶è¡Œ</strong>  æŸ¥è¯¢ä»ä¸²è¡Œè¯·æ±‚å˜æˆå¹¶è¡Œè¯·æ±‚ï¼ŒæŸ¥è¯¢æ•ˆç‡æé«˜ã€‚</li><li><strong>ç†”æ–­æœºåˆ¶ï¼š</strong>  å®ç°ç†”æ–­æœºåˆ¶ï¼Œé˜²æ­¢é›ªå´©æ•ˆåº”ã€‚</li></ul><p> <strong>3. I&#x2F;O ä¼˜åŒ–ï¼š</strong></p><ul><li><strong>ä½¿ç”¨ç¼“å­˜ï¼š</strong>  å°†çƒ­ç‚¹æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå‡å°‘ I&#x2F;O æ“ä½œã€‚</li><li><strong>ç¼“å­˜é¢„çƒ­ï¼š</strong>  å°†å¯èƒ½è¦ç”¨çš„æ•°æ®æå‰é¢„çƒ­åˆ°ç¼“å­˜ä¸­ï¼Œé¿å…å®æ—¶è®¡ç®—è€—è´¹æ—¶é—´ã€‚</li><li><strong>æ‰¹é‡è¯»å†™ï¼š</strong>  ä½¿ç”¨æ‰¹é‡è¯»å†™æ“ä½œï¼Œå‡å°‘ I&#x2F;O æ¬¡æ•°ã€‚</li><li><strong>å¼‚æ­¥ I&#x2F;Oï¼š</strong>  ä½¿ç”¨å¼‚æ­¥ I&#x2F;O æ“ä½œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</li></ul><p> <strong>4.ä»£ç ä¼˜åŒ–ï¼š</strong></p><ul><li><strong>ç®—æ³•ä¼˜åŒ–ï¼š</strong>  é€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚</li><li><strong>æ•°æ®ç»“æ„ä¼˜åŒ–ï¼š</strong>  é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œæé«˜æ•°æ®è®¿é—®æ•ˆç‡ã€‚</li><li><strong>å¹¶å‘ä¼˜åŒ–ï¼š</strong>  ä½¿ç”¨å¤šçº¿ç¨‹æˆ–åç¨‹ï¼Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li><li><strong>é¿å…æ­»é”ï¼š</strong>  æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨æ­»é”çš„å¯èƒ½ã€‚</li><li><strong>é”çš„ç²’åº¦ï¼š</strong>  æ£€æŸ¥ä»£ç ä¸­é”çš„ç²’åº¦æ˜¯å¦è¿‡å¤§ï¼Œå¦‚æœè¿‡å¤§åˆ™å‡å°‘é”çš„ç²’åº¦ã€‚</li><li><strong>ä½¿ç”¨æ± åŒ–ï¼š</strong>  å¼•å…¥æ± åŒ–çš„æ€æƒ³ï¼Œæ•°æ®åº“è¿æ¥æ± ï¼Œçº¿ç¨‹æ± ç­‰ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯è¿æ¥è€Œå¯¼è‡´çš„æ—¶é—´ä¸èµ„æºæŸè€—ã€‚</li></ul><p> <strong>5.èµ„æºï¼š</strong></p><ul><li><strong>IOè¿æ¥ï¼š</strong> æ£€æŸ¥æ˜¯ä¸æ˜¯å¤ªå¤šIOè¿æ¥æœªå…³é—­å¯¼è‡´çš„æ¥å£è€—æ—¶å¢åŠ ï¼Œè¿æ¥è¦åŠæ—¶å…³é—­ã€‚</li><li><strong>çº¿ç¨‹åƒç´§ï¼š</strong> å¦‚æœçº¿ç¨‹æ•°å·²ç»æ»¡äº†ï¼Œå…¶ä»–å¤šä½™è¯·æ±‚è‡ªç„¶åªèƒ½ç­‰å¾…ï¼Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹åªèƒ½é™æµæ¥ä¿è¯ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚</li><li><strong>GCé—®é¢˜ï¼š</strong> å¦‚æœJVMå†…å­˜åƒç´§å°±ä¼šå¯¼è‡´FullGCçš„æƒ…å†µï¼Œæ•´ä¸ªåº”ç”¨éƒ½ä¼šå˜æ…¢ã€‚</li><li><strong>ç”³è¯·èµ„æºï¼š</strong> å·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œå¦‚æœè¦é¢ä¸´å¾ˆå¤§çš„å¹¶å‘åœºæ™¯ï¼Œæ²¡æœ‰åˆé€‚çš„æœºå™¨èµ„æºæ€ä¹ˆåšéƒ½ä¼šå¤šä½™ï¼Œå‘ä½ çš„Bossç”³è¯·åˆé€‚çš„æœåŠ¡å™¨èµ„æºï¼</li></ul><h1 id="ç¤ºä¾‹ğŸ˜‰"><a href="#ç¤ºä¾‹ğŸ˜‰" class="headerlink" title="ç¤ºä¾‹ğŸ˜‰"></a>ç¤ºä¾‹ğŸ˜‰</h1><p>å‡è®¾ä½ å‘ç°ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ¥å£å¾ˆæ…¢ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š</p><ol><li><strong>ç›‘æ§ï¼š</strong>  ä½¿ç”¨ APM å·¥å…·ç›‘æ§è¯¥æ¥å£çš„å“åº”æ—¶é—´ï¼Œå‘ç°å¹³å‡å“åº”æ—¶é—´è¶…è¿‡ 1 ç§’ã€‚</li><li><strong>åˆ†æï¼š</strong>  åˆ†æè®¿é—®æ—¥å¿—ï¼Œå‘ç°è¯¥æ¥å£çš„æ…¢è¯·æ±‚éƒ½é›†ä¸­åœ¨æ™šä¸Š 8 ç‚¹åˆ° 10 ç‚¹ã€‚</li><li><strong>è°ƒç”¨é“¾åˆ†æï¼š</strong>  ä½¿ç”¨ APM å·¥å…·è·Ÿè¸ªè¯¥æ¥å£çš„è°ƒç”¨é“¾ï¼Œå‘ç°ç“¶é¢ˆåœ¨æ•°æ®åº“æŸ¥è¯¢ã€‚</li><li><strong>å®šä½ï¼š</strong>  ä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤åˆ†æ SQL è¯­å¥ï¼Œå‘ç°æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</li><li><strong>è§£å†³ï¼š</strong>  ä¸º <code>user_id</code> å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œé‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚</li><li><strong>éªŒè¯ï¼š</strong>  ä½¿ç”¨ APM å·¥å…·ç›‘æ§è¯¥æ¥å£çš„å“åº”æ—¶é—´ï¼Œå‘ç°å¹³å‡å“åº”æ—¶é—´é™åˆ° 100 æ¯«ç§’ä»¥ä¸‹</li></ol><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™æ˜¯åç«¯å¼€å‘ä¸­å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­å¸¸é—®çš„é—®é¢˜ã€‚å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>åç«¯å¼€å‘é—®é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>åç«¯å¼€å‘é—®é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼æ’æŸ¥ä¼˜åŒ–æ…¢SQL</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E6%8E%92%E6%9F%A5%E4%BC%98%E5%8C%96%E6%85%A2SQL/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E6%8E%92%E6%9F%A5%E4%BC%98%E5%8C%96%E6%85%A2SQL/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åœ¨æˆ‘ä»¬åç«¯æ—¥å¸¸å¼€å‘æµ‹è¯•ä¸­ï¼Œå¸¸å¸¸ä¼šé‡åˆ°ä¸€ä¸ªSQLè¯­å¥æŸ¥è¯¢è¿‡æ…¢è€Œå¯¼è‡´çš„æ•´ä½“æ¥å£å“åº”é€Ÿåº¦å˜æ…¢ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ã€‚è¿™æ—¶å€™å¦‚æœç¡®è®¤æ¥å£å˜æ…¢æ˜¯å› ä¸ºæ…¢SQLçš„åŸå› ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹æ…¢SQLè¿›è¡Œæ’æŸ¥ä¼˜åŒ–ã€‚</p><h1 id="è¯†åˆ«æ…¢SQLğŸ˜µ"><a href="#è¯†åˆ«æ…¢SQLğŸ˜µ" class="headerlink" title="è¯†åˆ«æ…¢SQLğŸ˜µ"></a>è¯†åˆ«æ…¢SQLğŸ˜µ</h1><p>ä¸€ä¸ªé¡¹ç›®çš„SQLè¯­å¥å¾€å¾€åºå¤§è€Œå†—æ‚ï¼Œé‚£æˆ‘ä»¬æƒ³è¦çŸ¥é“æ˜¯å“ªå‡ ä¸ªSQLå¯¼è‡´æˆ‘ä»¬å¯¹åº”çš„æ¥å£å˜æ…¢ï¼Œè¯¥å¦‚ä½•æ’æŸ¥å‘¢ï¼Ÿ</p><p>ä¸€èˆ¬å¸¸ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œæ’æŸ¥</p><h2 id="æ…¢æ—¥å¿—æŸ¥è¯¢"><a href="#æ…¢æ—¥å¿—æŸ¥è¯¢" class="headerlink" title="æ…¢æ—¥å¿—æŸ¥è¯¢"></a>æ…¢æ—¥å¿—æŸ¥è¯¢</h2><p>å¼€å¯æ•°æ®åº“çš„æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½ï¼Œè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šé˜ˆå€¼çš„ SQL è¯­å¥ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°éœ€è¦ä¼˜åŒ–çš„ SQLã€‚</p><ul><li><strong>MySQL:</strong>  è®¾ç½® <code>long_query_time</code> å‚æ•°ï¼Œå¹¶å¼€å¯ <code>slow_query_log</code>ã€‚</li><li><strong>PostgreSQL:</strong>  è®¾ç½® <code>log_min_duration_statement</code> å‚æ•°ã€‚</li><li><strong>SQL Server:</strong>  ä½¿ç”¨ SQL Server Profiler æˆ– Extended Events ç›‘æ§æ‰§è¡Œæ—¶é—´é•¿çš„æŸ¥è¯¢</li></ul><p>ä»¥MySQLä¸ºä¾‹ï¼Œå¦‚ä½•è¿›è¡Œæ…¢æ—¥å¿—æŸ¥è¯¢å‘¢ï¼Ÿ</p><h3 id="æŸ¥çœ‹å½“å‰é…ç½®"><a href="#æŸ¥çœ‹å½“å‰é…ç½®" class="headerlink" title="æŸ¥çœ‹å½“å‰é…ç½®"></a><strong>æŸ¥çœ‹å½“å‰é…ç½®</strong></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦æŸ¥çœ‹å½“å‰çš„ <code>long_query_time</code> å’Œ <code>slow_query_log</code> çš„é…ç½®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;long_query_time&#x27;</span>; <br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;slow_query_log_file&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li><code>long_query_time</code>ï¼šæ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤å€¼é€šå¸¸æ˜¯ 10 ç§’ã€‚</li><li><code>slow_query_log</code>ï¼šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚<code>ON</code> è¡¨ç¤ºå¼€å¯ï¼Œ<code>OFF</code> è¡¨ç¤ºå…³é—­ã€‚</li><li><code>slow_query_log_file</code>ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</li></ul><h3 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a><strong>ä¿®æ”¹é…ç½®</strong></h3><p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¿®æ”¹é…ç½®ï¼š</p><ul><li><p><strong>ä¿®æ”¹ MySQL é…ç½®æ–‡ä»¶ (my.cnf æˆ– my.ini)ï¼š</strong></p><ol><li>æ‰¾åˆ° MySQL çš„é…ç½®æ–‡ä»¶ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä½äº <code>/etc/my.cnf</code> æˆ– <code>/etc/mysql/my.cnf</code>ã€‚åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä½äº MySQL å®‰è£…ç›®å½•ä¸‹çš„ <code>my.ini</code> æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° <code>[mysqld]</code> éƒ¨åˆ†ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ·»åŠ è¯¥éƒ¨åˆ†ï¼‰ã€‚</li><li>åœ¨ <code>[mysqld]</code> éƒ¨åˆ†æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">long_query_time</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">slow_query_log</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">slow_query_log_file</span> = /var/log/mysql/mysql-slow.log<br><span class="hljs-attr">log_output</span> = FILE<br></code></pre></td></tr></table></figure><ul><li><p><code>long_query_time</code>ï¼šè®¾ç½®ä¸ºä½ å¸Œæœ›çš„æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œä¾‹å¦‚ 1 ç§’ã€‚</p></li><li><p><code>slow_query_log</code>ï¼šè®¾ç½®ä¸º <code>1</code>ï¼Œè¡¨ç¤ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p></li><li><p><code>slow_query_log_file</code>ï¼šè®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚è¯·ç¡®ä¿ MySQL ç”¨æˆ·å¯¹è¯¥ç›®å½•æœ‰å†™å…¥æƒé™ã€‚</p></li><li><p><code>log_output</code>ï¼šè®¾ç½®æ—¥å¿—è¾“å‡ºæ–¹å¼ä¸ºæ–‡ä»¶ã€‚</p></li></ul><ol start="4"><li>ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡å¯ MySQL æœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</li></ol></li><li><p><strong>ä½¿ç”¨ SET GLOBAL å‘½ä»¤åŠ¨æ€ä¿®æ”¹ï¼š</strong></p><ol><li>ä½¿ç”¨å…·æœ‰ <code>SUPER</code> æƒé™çš„ MySQL ç”¨æˆ·ç™»å½•ã€‚</li><li>æ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> slow_query_log <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ON&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> slow_query_log_file <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;/var/log/mysql/mysql-slow.log&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>è¿™äº›è®¾ç½®ä¼šç«‹å³ç”Ÿæ•ˆï¼Œä½† MySQL æœåŠ¡é‡å¯åä¼šå¤±æ•ˆã€‚å¦‚æœå¸Œæœ›æ°¸ä¹…ç”Ÿæ•ˆï¼Œä»ç„¶éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</li></ul></li></ul><h3 id="é…ç½®ç”Ÿæ•ˆ"><a href="#é…ç½®ç”Ÿæ•ˆ" class="headerlink" title="é…ç½®ç”Ÿæ•ˆ"></a><strong>é…ç½®ç”Ÿæ•ˆ</strong></h3><ul><li><p><strong>å¦‚æœä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡å¯ MySQL æœåŠ¡ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart mysql  <span class="hljs-comment"># Linux (systemd)</span><br><span class="hljs-built_in">sudo</span> service mysql restart    <span class="hljs-comment"># Linux (SysVinit)</span><br>net stop mysql                <span class="hljs-comment"># Windows</span><br>net start mysql               <span class="hljs-comment"># Windows</span><br></code></pre></td></tr></table></figure></li><li><p><strong>å¦‚æœä½¿ç”¨äº† SET GLOBAL å‘½ä»¤ï¼Œä¸éœ€è¦é‡å¯ MySQL æœåŠ¡ï¼Œé…ç½®ä¼šç«‹å³ç”Ÿæ•ˆã€‚</strong></p></li></ul><h3 id="éªŒè¯é…ç½®"><a href="#éªŒè¯é…ç½®" class="headerlink" title="éªŒè¯é…ç½®"></a><strong>éªŒè¯é…ç½®</strong></h3><p>é‡æ–°æ‰§è¡Œä»¥ä¸‹ SQL è¯­å¥ï¼Œç¡®è®¤é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;long_query_time&#x27;</span>;<br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;slow_query_log_file&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—"></a><strong>åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</strong></h3><ul><li><p>æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡ <code>long_query_time</code> çš„ SQL è¯­å¥ã€‚</p></li><li><p>ä½ å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ…¢ SQL è¯­å¥ã€‚</p></li><li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>mysqldumpslow</code> å·¥å…·åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾å‡ºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„æ…¢ SQL è¯­å¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysqldumpslow -s t -a /var/log/mysql/mysql-slow.log<br></code></pre></td></tr></table></figure><ul><li><code>-s t</code>ï¼šæŒ‰ç…§æŸ¥è¯¢æ—¶é—´æ’åºã€‚</li><li><code>-a</code>ï¼šä¸å°†æ•°å­—å’Œå­—ç¬¦ä¸²æŠ½è±¡åŒ–ã€‚</li></ul></li></ul><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li><code>long_query_time</code> çš„å€¼åº”è¯¥æ ¹æ®ä½ çš„åº”ç”¨åœºæ™¯è¿›è¡Œè°ƒæ•´ã€‚å¦‚æœä½ çš„åº”ç”¨å¯¹å“åº”æ—¶é—´è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥å°† <code>long_query_time</code> è®¾ç½®ä¸ºæ›´å°çš„å€¼ã€‚</li><li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šå¢åŠ  MySQL çš„ I&#x2F;O è´Ÿæ‹…ï¼Œå› æ­¤ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é•¿æ—¶é—´å¼€å¯ã€‚å¯ä»¥åœ¨éœ€è¦æ’æŸ¥é—®é¢˜æ—¶ä¸´æ—¶å¼€å¯ï¼Œé—®é¢˜è§£å†³ååŠæ—¶å…³é—­</li></ul><h1 id="åˆ†ææ…¢SQLğŸ˜¯"><a href="#åˆ†ææ…¢SQLğŸ˜¯" class="headerlink" title="åˆ†ææ…¢SQLğŸ˜¯"></a>åˆ†ææ…¢SQLğŸ˜¯</h1><p>å½“æˆ‘ä»¬é€šè¿‡æ…¢SQLæ—¥å¿—äº†è§£åˆ°äº†å“ªå‡ ä¸ªSQLè¯­å¥æ˜¯æ…¢SQLä¹‹åï¼Œå°±éœ€è¦å¯¹å…¶è¿›è¡Œåˆ†æã€‚ä»¥MySQLä¸ºä¾‹</p><h2 id="è·å–æ‰§è¡Œè®¡åˆ’ï¼š"><a href="#è·å–æ‰§è¡Œè®¡åˆ’ï¼š" class="headerlink" title="è·å–æ‰§è¡Œè®¡åˆ’ï¼š"></a><strong>è·å–æ‰§è¡Œè®¡åˆ’ï¼š</strong></h2><p>ä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤ï¼ŒæŸ¥çœ‹ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ã€‚æ‰§è¡Œè®¡åˆ’å¯ä»¥å‘Šè¯‰ä½ æ•°æ®åº“æ˜¯å¦‚ä½•æ‰§è¡Œ SQL è¯­å¥çš„ï¼ŒåŒ…æ‹¬ä½¿ç”¨äº†å“ªäº›ç´¢å¼•ã€è¡¨è¿æ¥æ–¹å¼ç­‰ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> customer_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> order_date <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">&#x27;2023-01-01&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">&#x27;2023-01-31&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="åˆ†ææ‰§è¡Œè®¡åˆ’ï¼š"><a href="#åˆ†ææ‰§è¡Œè®¡åˆ’ï¼š" class="headerlink" title="åˆ†ææ‰§è¡Œè®¡åˆ’ï¼š"></a><strong>åˆ†ææ‰§è¡Œè®¡åˆ’ï¼š</strong></h2><p>è·å–æ‰§è¡Œè®¡åˆ’ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å‡ ä¸ªæ ¸å¿ƒå‚æ•°äº†è§£å…·ä½“SQLè¯­å¥æ‰§è¡Œæƒ…å†µã€‚</p><ul><li><p>possible_keys: è¯¥SQLè¯­å¥å¯èƒ½ä¼šç”¨åˆ°çš„ç´¢å¼•</p></li><li><p>key: è¯¥SQLè¯­å¥å®é™…ä¸Šç”¨åˆ°çš„ç´¢å¼•</p></li><li><p>type: æ‰§è¡Œè¯¥SQLè¯­å¥çš„æ‰«ææ–¹å¼</p></li></ul><p>å…¶ä¸­typeæˆ‘ä»¬å°¤å…¶éœ€è¦æ³¨æ„ï¼Œæ‰«ææ–¹å¼æ•ˆç‡ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºALLï¼Œindexï¼Œrangeï¼Œrefï¼Œeq_ref,const</p><p>è¿™ä¸ªå‚æ•°æœ€å¥½åœ¨rangeåŠä»¥ä¸Šï¼Œæ•ˆç‡è¶Šé«˜è¶Šå¥½</p><h1 id="ä¼˜åŒ–æ…¢SQLğŸ¤©"><a href="#ä¼˜åŒ–æ…¢SQLğŸ¤©" class="headerlink" title="ä¼˜åŒ–æ…¢SQLğŸ¤©"></a>ä¼˜åŒ–æ…¢SQLğŸ¤©</h1><ul><li><p><strong>ç´¢å¼•ä¼˜åŒ–ï¼š</strong></p><ul><li><strong>æ·»åŠ ç´¢å¼•ï¼š</strong>  ä¸ºç»å¸¸ç”¨äºæŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•ã€‚</li><li><strong>å¤åˆç´¢å¼•ï¼š</strong>  è€ƒè™‘ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œå¯ä»¥æé«˜å¤šå­—æ®µæŸ¥è¯¢çš„æ€§èƒ½ã€‚</li><li><strong>è¦†ç›–ç´¢å¼•ï¼š</strong>  å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨æŸ¥è¯¢ã€‚</li><li><strong>åˆ é™¤æ— ç”¨ç´¢å¼•ï¼š</strong>  åˆ é™¤ä¸å†ä½¿ç”¨çš„ç´¢å¼•ï¼Œå‡å°‘ç´¢å¼•ç»´æŠ¤çš„å¼€é”€ã€‚</li><li><strong>é˜²æ­¢ç´¢å¼•å¤±æ•ˆï¼š</strong> æ­£ç¡®ä½¿ç”¨ç´¢å¼•ï¼Œé˜²æ­¢ç´¢å¼•å¤±æ•ˆ</li></ul></li><li><p><strong>SQL è¯­å¥ä¼˜åŒ–ï¼š</strong></p><ul><li><strong>é¿å…ä½¿ç”¨ <code>SELECT *</code>ï¼š</strong>  åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œå‡å°‘ I&#x2F;O å¼€é”€ã€‚</li><li><strong>é¿å…åœ¨ <code>WHERE</code> å­å¥ä¸­ä½¿ç”¨å‡½æ•°ï¼š</strong>  å‡½æ•°ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li><li><strong>ä½¿ç”¨ <code>JOIN</code> ä»£æ›¿å­æŸ¥è¯¢ï¼š</strong>  <code>JOIN</code> é€šå¸¸æ¯”å­æŸ¥è¯¢æ›´æœ‰æ•ˆç‡ã€‚</li><li><strong>ä¼˜åŒ– <code>LIKE</code> æŸ¥è¯¢ï¼š</strong>  é¿å…ä½¿ç”¨ <code>LIKE &#39;%keyword%&#39;</code>ï¼Œå¯ä»¥ä½¿ç”¨å…¨æ–‡ç´¢å¼•æˆ–å€’æ’ç´¢å¼•ã€‚</li><li><strong>ä½¿ç”¨æ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ“ä½œï¼š</strong>  æ‰¹é‡æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œå¯ä»¥å‡å°‘ç½‘ç»œå¼€é”€ã€‚</li><li><strong>é¿å…åœ¨å¾ªç¯ä¸­æ‰§è¡Œ SQL è¯­å¥ï¼š</strong>  å°†å¾ªç¯ä¸­çš„ SQL è¯­å¥åˆå¹¶æˆä¸€æ¡ SQL è¯­å¥ã€‚</li></ul></li><li><p><strong>æ•°æ®åº“é…ç½®ä¼˜åŒ–ï¼š</strong></p><ul><li><strong>è°ƒæ•´ç¼“å†²åŒºå¤§å°ï¼š</strong>  è°ƒæ•´æ•°æ®åº“çš„ç¼“å†²åŒºå¤§å°ï¼Œå¯ä»¥æé«˜æ•°æ®è®¿é—®é€Ÿåº¦ã€‚</li><li><strong>è°ƒæ•´è¿æ¥æ± å¤§å°ï¼š</strong>  è°ƒæ•´æ•°æ®åº“è¿æ¥æ± çš„å¤§å°ï¼Œå¯ä»¥æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li><li><strong>ä¼˜åŒ–æ“ä½œç³»ç»Ÿå‚æ•°ï¼š</strong>  ä¼˜åŒ–æ“ä½œç³»ç»Ÿçš„ TCP å‚æ•°ã€I&#x2F;O å‚æ•°ç­‰ï¼Œå¯ä»¥æé«˜æ•°æ®åº“çš„æ•´ä½“æ€§èƒ½ã€‚</li></ul></li></ul><h1 id="ç¤ºä¾‹ğŸ˜"><a href="#ç¤ºä¾‹ğŸ˜" class="headerlink" title="ç¤ºä¾‹ğŸ˜"></a>ç¤ºä¾‹ğŸ˜</h1><p>ç»™å‡ºä¸€ä¸ªç”¨å¤åˆç´¢å¼•æ¥ä¼˜åŒ–æ…¢SQLçš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ å‘ç°ä»¥ä¸‹ SQL è¯­å¥æ‰§è¡Œå¾ˆæ…¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> customer_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> order_date <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">&#x27;2023-01-01&#x27;</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">&#x27;2023-01-31&#x27;</span>;<br></code></pre></td></tr></table></figure><ol><li><strong>è·å–æ‰§è¡Œè®¡åˆ’ï¼š</strong>  ä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</li><li><strong>åˆ†ææ‰§è¡Œè®¡åˆ’ï¼š</strong>  å‘ç°å…¨è¡¨æ‰«æäº† <code>orders</code> è¡¨ã€‚</li><li><strong>ä¼˜åŒ–ï¼š</strong>  ä¸º <code>customer_id</code> å’Œ <code>order_date</code> å­—æ®µæ·»åŠ å¤åˆç´¢å¼•ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_customer_order_date <span class="hljs-keyword">ON</span> orders (customer_id, order_date);<br></code></pre></td></tr></table></figure><p><strong>éªŒè¯ï¼š</strong>  å†æ¬¡æ‰§è¡Œ SQL è¯­å¥ï¼Œå¹¶æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ‰§è¡Œé€Ÿåº¦æ˜æ˜¾æé«˜</p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNpVk8tu2kAUhl8FzSqVAJmxScCLSgnkQgKoiy6qGhZW7QSkgJFrpLYWEioppUpJSJMQ2qRBRaJkQ6h6SXOB8jKesVn1FTp4gLhezZn5zv__R57RwTNFkgEPtlQxl3I9DieyLvItCqhfRJ3dpMvjeehamkO1nnl0gd-0cLNt9Vr4pI2GJw8ou2QzIR03eqj2FZ-9m2HW5Tc0OP7bbxYoGSKki2B2Q1iw9n6j_fqMTjogImRDy4J5d4g_NydnYXtzZc4YDEmc5SePoouROKqU8Xlt6vgFVT5Mgq3Y9OokGO0xbsuoVhkVX5ufdsyfLdR3xFt1Oq8JRr-B3tcpZF3-IdJJBzcdI6JT53HO8x1qRRzMWvleOOIUXhdGb6tjlAbuddF-O-ngpsIbOi52rNLAuKsa11Wih0s_7iXXKEOLdWex4RSJClaxZH08oMOb_UPUbeCzW1S5wpW6NTw1rou426aTJh3907AxAf_atXrH6OZqVLowB98nUJSe0iJmF3HBPD3Aex2aGh_dEPkJHf__XwI3uW1pCfCampfdICOrGXFcAn2MJ4CWkjNyAvBkKcmbYn5bS4BEtkDacmL2qaJkpp2qkt9KAX5T3H5OqnxOEjU5nBbJVc7MdlU5K8lqSMlnNcD7fD6_rQJ4HbwAPIScl1mAkOEWIMtwnBu8BLwHBr1BBkL_gj_IcgwD2fmCG7yyfX1eNsAGGR8HOQYG_Gxg3g1kKa0paow-I_s1Ff4BzyFumg"><img src="https://i-blog.csdnimg.cn/img_convert/9ea65d6c1c5e7fca49ac252a8f5b1a98.jpeg"></a></p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™æ˜¯åç«¯é¢è¯•å¸¸é—®çš„é—®é¢˜ï¼Œå»ºè®®å„ä½ç»“åˆè‡ªå·±çš„é¡¹ç›®è¿›è¡Œå›ç­”ï¼Œé¢è¯•å®˜é—®ä½ çš„ä¼˜åŒ–æ–¹æ³•ä¹Ÿå¯ä»¥æœ‰æ›´å¤šçš„æ€è·¯ã€‚å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼è§£å†³ç¼“å­˜ä¸æ•°æ®åº“æ•°æ®ä¸€è‡´æ€§</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E8%A7%A3%E5%86%B3%E7%BC%93%E5%AD%98%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E8%A7%A3%E5%86%B3%E7%BC%93%E5%AD%98%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>åç«¯é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜å¸¸é—®å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¾ˆå¤šåŒå­¦éƒ½æ˜¯ä¸œç­”ä¸€å¥è¥¿ç­”ä¸€å¥ï¼Œå¾ˆå°‘æœ‰å›ç­”è¾ƒå®Œæ•´çš„ï¼Œé‚£ä¹ˆä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚ä½•å…¨é¢åœ°å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="Cache-Aside-PatternğŸ¥±"><a href="#Cache-Aside-PatternğŸ¥±" class="headerlink" title="Cache Aside PatternğŸ¥±"></a>Cache Aside PatternğŸ¥±</h1><p>å³<strong>æ—è·¯ç¼“å­˜æ¨¡å¼</strong></p><ul><li>å½“è¯»å–æ•°æ®æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨æ‰€éœ€çš„æ•°æ®ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>å½“å†™å…¥æˆ–æ›´æ–°æ•°æ®æ—¶ï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œç„¶åä½¿ç¼“å­˜ä¸­çš„æ—§æ•°æ®å¤±æ•ˆï¼ˆå³åˆ é™¤ç¼“å­˜ä¸­çš„å¯¹åº”æ•°æ®ï¼‰ã€‚è¿™ç§æ–¹å¼é¿å…äº†ç›´æ¥æ›´æ–°ç¼“å­˜å¯èƒ½å¸¦æ¥çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¤§å®¶å¸¸å¬åˆ°çš„å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆä»æœ‰è¾ƒå°æ¦‚ç‡å‡ºç°è„ç¼“å­˜é—®é¢˜ï¼ˆå¹¶å‘å‰æä¸‹ï¼‰</p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNptkltL40AUx79KOE8Kbcm1bfIgqPW67JtPJj6EzWjLbpMSU9i1LYgPEkTFpbq74rKyXkAU0woLLl7ol3Em8Vs4zUwV0XkY5pz5_c85f2Ya8MlzEBiw5Nu1sjBXslyBrlETR0ckvI4vOknnmlytLQjZ7Egz6dyysCmMDZHjVXJ4Gt-18eWvYSYbSymWwt_vH_5fNoVxM-nt4oM_LEv2umQrWniLk9_nA0XJpHWTzhFj8U2b46U-LkyYuLvOr2iXtTMcdlkJjk2k2CRvy8j4dv_ZEMfYPvW-Uby-PzA6PRQf_CPbp0nUe_wZPc_EHU-nzWbMh_set31yRfZC3mMmvZ01479REp0QWudHF0ebJNzhwGwKfBjMGu7gjUPc3sI3u68mhgx9n4oDRuDXUQaqyK_a_RAa_TIWBGVURRYY9OjY_mcLLLdFNTXbnfe86kDme_WlMhiL9pdlGtVrjh2gUsWmL_-CINdB_rhXdwMw9LQCGA34CoasKzlNFUVVkXRJ1_KimoFvYGQlTc2pmlQsaIqo5OViodjKwEraVcrJeZ2mNFktFEW5oFAJciqB539kfy79eq0nJYwiXw"><img src="https://i-blog.csdnimg.cn/img_convert/0ef3560f82c0cc2098f9a45fce5982e6.jpeg"></a></p><h1 id="å»¶è¿ŸåŒåˆ ä¼˜åŒ–ğŸ˜µ"><a href="#å»¶è¿ŸåŒåˆ ä¼˜åŒ–ğŸ˜µ" class="headerlink" title="å»¶è¿ŸåŒåˆ ä¼˜åŒ–ğŸ˜µ"></a>å»¶è¿ŸåŒåˆ ä¼˜åŒ–ğŸ˜µ</h1><p>å³åœ¨æ—è·¯ç¼“å­˜çš„åŸºç¡€ä¸Šï¼Œä¼˜åŒ–æˆï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œæœ€åå»¶è¿Ÿåˆé€‚çš„æ—¶é—´å†åˆ é™¤ä¸€éç¼“å­˜ï¼Œé˜²æ­¢è„ç¼“å­˜å‡ºç°ã€‚å»¶è¿Ÿæ—¶é—´éœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘çš„æ‰§è¡Œæ—¶é—´å’Œè¯»å–æ•°æ®åº“åŠå†™å…¥ç¼“å­˜çš„æ—¶é—´æ¥è¯„ä¼°ï¼Œä»¥ç¡®ä¿åœ¨å»¶è¿Ÿæ—¶é—´å†…ï¼Œå…¶ä»–è¯·æ±‚å¯ä»¥å®Œæˆæ•°æ®åº“è¯»å–å’Œç¼“å­˜å†™å…¥æ“ä½œã€‚</p><p>ä½†å»¶è¿ŸåŒåˆ ä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼š</p><ul><li><strong>å¹¶éå¼ºä¸€è‡´æ€§</strong>ï¼šå³ä½¿ä½¿ç”¨å»¶è¿ŸåŒåˆ ï¼Œä»ç„¶ä¸èƒ½å®Œå…¨é¿å…Redisè„æ•°æ®çš„é—®é¢˜ï¼Œåªèƒ½ç¼“è§£ã€‚è¦å®Œå…¨è§£å†³ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨åŒæ­¥é”æˆ–åœ¨ä¸šåŠ¡é€»è¾‘å±‚è¿›è¡Œå¤„ç† </li><li><strong>æ“ä½œå¤±è´¥å¤„ç†</strong>ï¼šåˆ é™¤ç¼“å­˜æ“ä½œæœ‰å¯èƒ½ä¼šå¤±è´¥ï¼Œå¦‚æœç¬¬äºŒæ¬¡åˆ é™¤ç¼“å­˜å¤±è´¥ï¼Œå¯ä»¥è€ƒè™‘é‡è¯•æœºåˆ¶æˆ–ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥åŒæ­¥</li></ul><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNptk1tPGkEUx78KmcSEJki4CuxDkyraWvWtTwUeNmWrpgXMFpK2aoJEERG8VMELpFTFSlt3gagoiPphumdmefIrdPYibdV92MzO_P7nf86ZPdPoTSTIIQaN8-zUhOGV1x820OeZD8R9nDonv6qwui6fnUNyR66e43oiYOjtfWroN3a-52EhJV3dkPYGCNtQruNc6omm7leZAR8RluB6gZQEvJvAW43O1mlAAwZUwGvEhVOcr-FcDWdFaG3ocq96OqjLpYs4Fs_-kw-qwJCRHB9LrQw-3ns8jSEVe-4je6IsljUvEDM4tQbNhnyzCYWvyjpdgo0stDbJ5U63aGqkxXhxvxFy9fLfRgwb8UEclw41e914WDma0TNav5IuhBnDS5_mqO1qJQce4rj4804x4qNx5ep-tz06PqIaj_qgltSPqEuiAqmaFkLHRlVsTLfVyHslKpj27ukx4JNKZzF9297FQhkK11DPkXJLaiXhkvaqBKsZSH0jQp7kDsnuPBYOaFfx2RypLN-2M5A9efR_oEdkvgFrK_cuWpE0G1CsPLxiCkMy-_BOf8cT3VTlmx1ylMX5Jj7J4eISpH9IrRVYXIXaOtms07Uu_JLpOkrNZTV4BguHekXVtrx4qtSiMtJFlqZBd3D8qLMldva3qSMy0bmYDCImysc4EwpxfIhVPtG0kosfRSe4EOdHDF0GWf6dH_nDs1QzxYZfRyKhOxkfiY1PIOYt-_4D_YpNBdko551k6cT9RbhwkOMHIrFwFDEeNQJiptFHxNg8drPTYbE47FaP1ePsszhM6BNieq1Oh9nhtLpdTrvF3mdzu9yzJvRZdbWabX0euuW0OVxui81lpxIuOBmN8GParKsjP_sHuSEX1w"><img src="https://i-blog.csdnimg.cn/img_convert/874f29f28702453afccf9499f8143438.jpeg"></a></p><h1 id="åˆ†å¸ƒå¼é”æ›´æ–°ç¼“å­˜ğŸ˜¯"><a href="#åˆ†å¸ƒå¼é”æ›´æ–°ç¼“å­˜ğŸ˜¯" class="headerlink" title="åˆ†å¸ƒå¼é”æ›´æ–°ç¼“å­˜ğŸ˜¯"></a>åˆ†å¸ƒå¼é”æ›´æ–°ç¼“å­˜ğŸ˜¯</h1><p>è°ˆåˆ°åŒæ­¥é—®é¢˜å¿…å®šæƒ³åˆ°é”ã€‚ä½†æ˜¯æœ‰äº›åŒå­¦ä¼šæƒ³åˆ°ç”¨synchronizedï¼ŒReentrantlockç­‰Javaæä¾›çš„é”æœºåˆ¶æ¥å®ç°æ›´æ–°ç¼“å­˜ï¼Œè¿™å°±æ˜¯æŸäº›åŒå­¦çš„çŸ¥è¯†ç›²åŒºäº†ï¼Œå¯¹åˆ†å¸ƒå¼é”ç†è§£ä¸å¤Ÿåˆ°ä½ã€‚åƒ <code>synchronized</code> å’Œ<code>ReentrantLock</code> è¿™æ ·çš„é”æœºåˆ¶æ˜¯Javaè¯­è¨€å±‚é¢æä¾›çš„åŒæ­¥å·¥å…·ï¼Œä¸»è¦ç”¨äºåœ¨åŒä¸€JVMå®ä¾‹å†…çš„çº¿ç¨‹é—´è¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œ<strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­</strong>ï¼ŒæœåŠ¡é€šå¸¸éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œæ¯å°æœºå™¨éƒ½æœ‰è‡ªå·±çš„JVMå®ä¾‹ã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ç§èƒ½å¤Ÿåœ¨ä¸åŒJVMä¹‹é—´è¿›è¡Œåè°ƒçš„é”æœºåˆ¶ï¼Œ<strong>åˆ†å¸ƒå¼é”</strong>ä¾¿æ˜¯ä¸ºæ­¤è€Œç”Ÿçš„ã€‚</p><p>â€œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚ä¸­é—´å±‚è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰å°±å¤šåŠ ä¸€å±‚â€ï¼Œå¤šä¸ªå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œå‘è¿™ä¸ªä¸­é—´å±‚å‘èµ·è¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Redisæˆ–è€…ZooKeeperæ¥å®ç°åˆ†å¸ƒå¼é”è¿™ä¸€åŠŸèƒ½ã€‚ä»¥Redisä¸ºä¾‹å­ï¼Œç”¨Redisçš„SetNxåŠŸèƒ½æ¥åšåˆ†å¸ƒå¼é”ï¼ˆæœ€å¥½å¸¦è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢ç³»ç»Ÿæ— å“åº”é—®é¢˜ï¼‰ï¼Œå½“ä¸€ä¸ªå†™çº¿ç¨‹æ¥æ›´æ–°æ•°æ®åº“ï¼Œä¾¿å°è¯•è·å¾—è¯¥ç‹¬å é”ï¼Œè·å¾—é”æˆåŠŸä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å…¶ä»–è¯•å›¾æ›´æ–°ç›¸åŒæ•°æ®çš„æœåŠ¡å®ä¾‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚æ›´æ–°æ•°æ®åº“å’Œæ›´æ–°ç¼“å­˜æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ¥è¿›è¡Œçš„ï¼Œè¿™æ ·å°±ä¿è¯äº†<strong>å¼ºä¸€è‡´æ€§</strong>ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†<strong>æ€§èƒ½è¾ƒå·®</strong>çš„é—®é¢˜ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯æ›´æ–°æ•°æ®åº“ï¼Œä¹Ÿä¸€èµ·æ›´æ–°ç¼“å­˜ï¼Œè€Œä¸æ˜¯ç”±å…¶ä»–çº¿ç¨‹æ¥è¯»æ¥é‡å»ºç¼“å­˜ï¼Ÿå³ä½¿é‡‡ç”¨â€œåˆ é™¤ç¼“å­˜ + ç­‰å¾…å…¶ä»–çº¿ç¨‹è¯»å–é‡å»ºç¼“å­˜â€çš„ç­–ç•¥ï¼Œä»ç„¶å­˜åœ¨äº§ç”Ÿè„æ•°æ®çš„å¯èƒ½æ€§ã€‚</p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNp1lFtPGkEUx7_KZhKTNkHDVWAfmlRQq7YvTZ-6-EDKVkkFDELSFkjWCwICSoqAF9SagtILiPWGCPhhypndffIrdPai7ov7tLPn__-dmXPObAR9CHhYRKOZoHt-lnrndPkp8rxkoMPBcXqaGhx8QY08g-QeWUGm-Jb1eBcWAn7HnJf1h54r6hFZ5YhAc084KQjrV7BRhOQqtJahsyFuLsYUmUOSRXEyB2sHUcrJ4NSxcJjBhSbONqCdx7vnuNjE-Wy_W55WHE4ZPMooIb6Th_qWGhqVQ2MMf9gQGhVFAI0MoauCMVkwzoiJNbzZ025HFYzLglcMf5PHewfko3aXUDkVzqtRaoLh6ynoxeH6UkxkyelwsijhOssqZUKmTDL4B4cPqnjrBHJHQo_ka-IyB5Vj1fXnkJxTtUwqdSj_Irp-a03czkWpKTVPv8XhxgUuXYqlc8itK27VN6U0QwuBq78ayGtGaDShW8ClKtyWpC1zHCTaD0cbGKDwWY0U5K6zg-sV2O3BaYGvtPvtVZHbEW4T993td2_5zZq2ZtoO8DsrEG_BfhpfLPK19D9u6QEvHhUhnnxiWu46GX7lkpzqqTnRkpQxUTQkRFzEDhsn_ZsqNFIQr0G5qd0UfHucJC0Hjpbwflkq9nKX_52G7JnE7JUIUwImt_H3a-Li60W-UBW5FE7_VDrx0G6eZFmvKqUkZKQjd8XrQXQoGGZ1yMcGfW5piSJSThcKzbI-1oVo8upxBz-5kMsfI555t_99IOC7twUD4ZlZRH90zy2QVXje4w6xTq-b3MJHCev3sEFHIOwPIdouExAdQZ8RbbSbhixmvd5sMtgNdsuw3qxDXxA9aLCYh8wWg81qMelNw0ab1RbToa9yVsOQcdhOPlmMZqtNb7SarDpEmhMKBN8o91_-DcT-A3pMB2c"><img src="https://i-blog.csdnimg.cn/img_convert/81eeea808c15d3aa2fb25410ae41f4e5.jpeg"></a></p><h1 id="MQé€æ­¥æ›´æ–°æ•°æ®åº“ğŸ¤©"><a href="#MQé€æ­¥æ›´æ–°æ•°æ®åº“ğŸ¤©" class="headerlink" title="MQé€æ­¥æ›´æ–°æ•°æ®åº“ğŸ¤©"></a>MQé€æ­¥æ›´æ–°æ•°æ®åº“ğŸ¤©</h1><p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©MQæ¥å¸®æˆ‘ä»¬å®ç°æ•°æ®åº“ä¸ç¼“å­˜ä¹‹é—´<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚å¼•å…¥ä¸€ä¸ªç§’æ€åœºæ™¯æ¥æ–¹ä¾¿è®²è§£ï¼Œå½“å¤§é‡è¯·æ±‚æ‰“åˆ°Redisç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬å…ˆç”¨decr + æ»‘åŠ¨çª—å£å®ç°åº“å­˜åœ¨Redisçš„å¿«é€Ÿæ‰£å‡ï¼Œä¸€æ—¦æ‰£å‡æˆåŠŸå°±å°†ç›¸åº”ä¿¡æ¯å­˜è¿›MQï¼Œè®©MQå‰Šå³°å‡æµï¼Œä»è€Œè®©è®¢é˜…è¯¥æ¶ˆæ¯çš„æ¶ˆè´¹è€…é€šè¿‡ç›‘å¬å™¨é€æ­¥æ›´æ–°æ•°æ®åº“ã€‚å¦‚æœRedisåº“å­˜å·²ç»æ‰£å‡åˆ°0ï¼Œå¯ä»¥å€ŸåŠ©MQå‘é€ç›´æ¥è®©æ•°æ®åº“å­˜æ›´æ–°ä¸º0çš„æƒ…å†µï¼Œè¿›ä¸€æ­¥å‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚</p><p>å¯ä»¥å€ŸåŠ©MQçš„äº‹åŠ¡æ¶ˆæ¯ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æˆ–è€…æœ¬åœ°æ¶ˆæ¯è¡¨ç­‰æ–¹æ¡ˆè¿›ä¸€æ­¥ä¿è¯æ¶ˆè´¹è€…ä¸€å®šä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯ï¼Œè§£å†³æ¶ˆæ¯ä¸¢å¤±ï¼Œæ¶ˆè´¹å¹‚ç­‰ç­‰é—®é¢˜ã€‚</p><p>è¿™ç§æ–¹æ¡ˆæ€§èƒ½éå¸¸é«˜ï¼Œè€Œä¸”å¯ä»¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œä½†è¿™ç§æ–¹æ¡ˆä¸é€‚åº”å¼ºä¸€è‡´æ€§çš„é‡‘èç­‰åœºæ™¯ï¼Œè€Œä¸”ä¹Ÿå¢åŠ äº†å®ç°éš¾åº¦å’Œç»´æŠ¤éš¾åº¦ã€‚</p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNqNlGlPGkEYx7_KZhLfoeGUI9FExatKLV5VF2KobNW0guFIbAkJSjmkEbEqtRVrSbGaRgGrRUCqX4YZlm_RYWZaUDHpvtjszvP7P_NcMx4wZ7cKQAfmHZblBW5cb7Jx-OniYckHj9-budbWTq6bR9EjtJOrHH9ABz4xc4XO18wU7CZAD1--jo4K1kVnOX9mFeYcsLgNz_YY00MYvYcuor0MjH2HqeNyMVo5W8dvqZdy9K3HNIchIurlYfZAzOyK0Su4GYfhIMz7YWmzurM66xRctpVZtkUvoft4MZ2Fv3dR4hQmsigXRqsZMXnCmD7C9PNwc6vqW6VWGM4ajMzeT-wDHmahFAkWhWMwcngnygESJVknskG-GoqgnZvGEJnfQQI84SvX2-jg0PzAC0ydi5dHBBrCXjZwumzzcFxMHsHVW5QownCOKYcIOeyhoYk3eMssSvhwQakWnSbRbpYFO0zCTPzAWDkfqX6K0Ro0GOHVz7tGAw9T7yqxICytwXwe-QMw-IttbSDA02aZkK7heAgxwlf2L_HIiLc7cP8LbXs5vyHmLphmhGDPmjmqdZJj7a4XxsjjUYE3AVjIsSzD8Vq1S34mNhJs9P-qMtq0Kr0NxgdVGXu8KmMEGK8nQ5dbWjiDEc-SeFkQfYGq_wSPBrU43S_oaWuwU-_UXh_GCf4fUNnfgrFTosDTaa6TE4Sc5NHXAtpIs-ENBmC6gHAT4lmcNl6vNaHxTNaeSaJ8zleSaTGdokq6H4MEm7UhG3Z817_B0KYYupCij7nKegGlI42x67mOjgckXuvkpviq77N4GzIY6XQzKB-o7ufuJDVFwpq-nzpu6KOSaSKZYWMHs8F7SdNKlPNFKRPMEEFXV7PcgQRfhotWoHM53IIELAmOJUvtF3hqWhNwLQhLggno8KfV4nhlAiabF2uWLbYZu33pr8xhd88vAN1Ly2sn_nMvWy0uQb9owY2vI7i-gqPH7ra5gE5LPACdB6wAnVyraFMppVKlQqaVaVXtUqUEvAG6VplK2aZUyTRqlUKqaJdr1BqvBLwlu8ra5O1avKSSK9UaqVytUEsAvpBddoeBXvDknvf-AbdOw9I"><img src="https://i-blog.csdnimg.cn/img_convert/8b7d010a860cab041dcb6ba1262b7704.jpeg"></a></p><h1 id="binlog-CanalğŸ˜ˆ"><a href="#binlog-CanalğŸ˜ˆ" class="headerlink" title="binlog + CanalğŸ˜ˆ"></a>binlog + CanalğŸ˜ˆ</h1><p>ä½¿ç”¨ <code>binlog + Canal</code> å®ç° MySQL å’Œ Redis æ•°æ®ä¸€è‡´æ€§æ˜¯ä¸€ç§å¸¸è§çš„ã€ç›¸å¯¹å¯é çš„æ–¹æ¡ˆã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šCanal æ¨¡æ‹Ÿ MySQL Slaveï¼Œä¼ªè£…æˆ MySQL çš„ä»èŠ‚ç‚¹ï¼Œä» MySQL Master æ¥æ”¶ binlog æ—¥å¿—ï¼Œç„¶åè§£æ binlogï¼Œå°†æ•°æ®å˜æ›´åŒæ­¥åˆ° Redisã€‚</p><p><strong>å·¥ä½œåŸç†</strong></p><ol><li><p><strong>MySQL å¼€å¯ binlog</strong>ï¼š</p><ul><li>ç¡®ä¿ MySQL å¼€å¯äº† binlog åŠŸèƒ½ï¼Œå¹¶ä¸” binlog çš„æ ¼å¼è®¾ç½®ä¸º <code>ROW</code> æ¨¡å¼ã€‚è¿™æ˜¯ Canal èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„å‰æã€‚</li></ul></li><li><p><strong>Canal æ¨¡æ‹Ÿ Slave</strong>ï¼š</p><ul><li>Canal ä¼ªè£…æˆ MySQL çš„ Slave èŠ‚ç‚¹ï¼Œå‘ MySQL Master å‘èµ·è¿æ¥è¯·æ±‚ã€‚</li></ul></li><li><p><strong>MySQL Master æ¨é€ binlog</strong>ï¼š</p><ul><li>MySQL Master æ¥æ”¶åˆ° Canal çš„è¯·æ±‚åï¼Œä¼šå°† binlog æ—¥å¿—æ¨é€ç»™ Canalã€‚</li></ul></li><li><p><strong>Canal è§£æ binlog</strong>ï¼š</p><ul><li><p>Canal æ¥æ”¶åˆ° binlog æ—¥å¿—åï¼Œä¼šæŒ‰ç…§é…ç½®è§„åˆ™è§£æ binlogï¼Œæå–å‡ºæ•°æ®å˜æ›´çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li>å“ªä¸ªæ•°æ®åº“çš„å“ªä¸ªè¡¨å‘ç”Ÿäº†å˜æ›´</li><li>å˜æ›´çš„ç±»å‹ï¼ˆINSERTã€UPDATEã€DELETEï¼‰</li><li>å˜æ›´å‰åçš„æ•°æ®</li></ul></li></ul></li><li><p><strong>Canal åŒæ­¥æ•°æ®åˆ° Redis</strong>ï¼š</p><ul><li><p>Canal æ ¹æ®è§£æå‡ºçš„æ•°æ®å˜æ›´ä¿¡æ¯ï¼Œå°†æ•°æ®åŒæ­¥åˆ° Redisã€‚åŒæ­¥çš„æ–¹å¼å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œé€‰æ‹©ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>æ›´æ–°ç¼“å­˜</strong>ï¼šå°†å˜æ›´åçš„æ•°æ®æ›´æ–°åˆ° Redis ä¸­ã€‚</li><li><strong>åˆ é™¤ç¼“å­˜</strong>ï¼šåˆ é™¤ Redis ä¸­å¯¹åº”çš„æ•°æ®ã€‚</li></ul></li></ul></li><li><p><strong>åº”ç”¨ç¨‹åºè¯»å– Redis</strong>ï¼š</p><ul><li>åº”ç”¨ç¨‹åºä» Redis ä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœ Redis ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä» MySQL ä¸­è¯»å–ï¼Œå¹¶å°†æ•°æ®å†™å…¥ Redisã€‚</li></ul></li></ol><p>è¿™ç§æ–¹æ¡ˆä¹Ÿæœ‰å…¶ä¼˜ç¼ºç‚¹ï¼š</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li><strong>å®æ—¶æ€§é«˜</strong>ï¼šCanal èƒ½å¤Ÿå®æ—¶åœ°å°† MySQL çš„æ•°æ®å˜æ›´åŒæ­¥åˆ° Redisï¼Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>å¯é æ€§é«˜</strong>ï¼šCanal æ¨¡æ‹Ÿ MySQL Slaveï¼Œèƒ½å¤Ÿå¯é åœ°æ¥æ”¶ binlog æ—¥å¿—ï¼Œé¿å…äº†æ•°æ®ä¸¢å¤±ã€‚</li><li><strong>å¯æ‰©å±•æ€§å¼º</strong>ï¼šCanal æ”¯æŒå¤šç§æ•°æ®åŒæ­¥æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œé€‰æ‹©ã€‚</li><li><strong>è§£è€¦</strong>ï¼šå°†æ•°æ®åŒæ­¥çš„é€»è¾‘ä»åº”ç”¨ç¨‹åºä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé™ä½äº†åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li><strong>å®ç°å¤æ‚</strong>ï¼šéœ€è¦å®‰è£…ã€é…ç½®å’Œç»´æŠ¤ Canal æœåŠ¡ã€‚</li><li><strong>å­˜åœ¨å»¶è¿Ÿ</strong>ï¼šè™½ç„¶ Canal èƒ½å¤Ÿå®æ—¶åœ°åŒæ­¥æ•°æ®ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚</li><li><strong>éœ€è¦è€ƒè™‘ Canal çš„é«˜å¯ç”¨</strong>ï¼šä¸ºäº†ä¿è¯ Canal æœåŠ¡çš„å¯ç”¨æ€§ï¼Œéœ€è¦è€ƒè™‘ Canal çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚</li><li><strong>éœ€è¦ç›‘æ§Canal</strong>ï¼šéœ€è¦å¯¹ Canal æœåŠ¡è¿›è¡Œç›‘æ§ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜</li></ul><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNptlFtPGkEUx7_KZhLf0HJV4aGJAt7x3jTpwsO2bJWUi0FoaoEEjQotFNYGBaGitqI0raKpVQRaPkx3BnjyK3R2ZlHauA-bmTm__zlnzpmZAHjhsfPAABa83NIiM2-yuhn8DbCwFoYnMRvT3f2YGWQtK3MzE9KSUHrucDs9CzbKDRK7MdA4PBPre9SEDmqwlhTLldmpp6h4iMchChslOIgypSBjYo2cm3NiM4rtE-fMnJN7zctuTcStmUJQ2KKEhVv28V6Y3Gr-vG7W8yhRaJau0cWaLDIT0RDbCWMGpa7-wYYINvwfVmyFV-X00wVYTzequyS4LBomohE5a-K0k5apEUKNUqp58gXlhQeoUUKNBWAyg3KXjYsqzMdwUcRqWLyJ3tb25WrR_xip2ejknHl2_tGTadPAvDnIjLPwfJPKoZBoZNfR9jn6cIanaOccRs9nebtj2dbpwGSeMEvKCRZGD1q7R4QQy6ewdAMrqTsPWENV4yRHCysZU8VGMQYrSbGaILJmqQqTO3cCCZ-geFttIdPJQDsK-vSO4lBI329w8v44TLHNegrm8pTCtadxbZ0gFI6DzDSLsyCdeyCLaRJ2RiqOHG5zF24UOqsxQ5CpdqJdXQz6UWxF3t_Wsuj0COZ-w4vtxlFFrGzC4zXx1zaMfsV50CbCj3Ha_r0CPusovkryEMu0KuJNrJW-lDeQXRfL4WbkEoVP_oTX7mK1wtlmPdLIbUHhOxFjUPadzMD4zm0tDm-upN5uXEEhjk4L7WbiIkrGJD4lBVLNKEoKrW8ZufH7-CZ8xouNRATHAwp8mx12YPB5_bwCuHivi5OmICBlYgW-Rd7FW4EBD-2c95UVWN0hrFni3M88Hldb5vX4FxaB4SXnXMYz_5Kd8_EmB4ffiXuEd9t5r9Hjd_uAQU88AEMAvAEGtV7To9MqlVqNSq_S63qVWgVYAYZulU7bo9Wp-vt0GqWmV93f1x9SgLckqqpH3avHSzq1tq9fqe7TYAneus_jtdAXijxUob-wZiEi"><img src="https://i-blog.csdnimg.cn/img_convert/cf3fd99e6604f3c14e07bc42461a959d.jpeg"></a></p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™æ˜¯åç«¯é¢è¯•å¸¸é—®çš„é—®é¢˜ï¼Œå»ºè®®å„ä½ç»“åˆè‡ªå·±çš„é¡¹ç›®è¿›è¡Œå›ç­”ï¼Œé¢è¯•å®˜é—®ä½ çš„ä¼˜åŒ–æ–¹æ³•ä¹Ÿå¯ä»¥æœ‰æ›´å¤šçš„æ€è·¯ã€‚å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>åå°ç¼“å­˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>åå°ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£å•ä¾‹æ¨¡å¼</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>è¿™æ˜¯è®¾è®¡æ¨¡å¼ä¸“æ çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨è¿™ä¸ªä¸“æ é‡Œé¢ä¼šè®²åˆ°æˆ‘ä»¬åœ¨å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä¼šç”¨å¿ƒå°†å®ƒä»¬è§£æï¼Œç„¶åè®²ç»™ä½ ä»¬å¬ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥æŒç»­å…³æ³¨è¿™ä¸ªä¸“æ â¤ï¸</p><p>è¿™æ¬¡æˆ‘ä»¬è¦è®²çš„æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿™ä¸ªåœ¨å¤§å‚é¢è¯•ä¸­ååˆ†å¸¸è§ï¼Œæœ‰çš„é¢è¯•å®˜ä¼šè®©ä½ <strong>æ‰‹æ’•ä¸€ä¸ªå•ä¾‹æ¨¡å¼</strong>ã€‚æŠ›å»é¢è¯•ä¸è°ˆï¼Œå•ä¾‹æ¨¡å¼ä¹Ÿæ˜¯æˆ‘ä»¬å¼€å‘ä¸­å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œè®¸å¤šæ¡†æ¶çš„åº•å±‚è®¾è®¡éƒ½æ˜¯è¿ç”¨åˆ°è¿™ä¸ªè®¾è®¡æ€è·¯ï¼Œæ‰€ä»¥æŒæ¡å¥½å•ä¾‹æ¨¡å¼ååˆ†æœ‰å¿…è¦</p><h1 id="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ğŸ¤“"><a href="#ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ğŸ¤“" class="headerlink" title="ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ğŸ¤“"></a>ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ğŸ¤“</h1><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§<strong>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼</strong>ï¼Œå®ƒç¡®ä¿<strong>ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹</strong>ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¿™ä¸ªå®ä¾‹ã€‚</p><p>ä½¿ç”¨å•ä¾‹æ¨¡å¼çš„åœºæ™¯æœ‰å“ªäº›å‘¢ï¼Ÿ</p><ul><li>æ•°æ®åº“è¿æ¥æ± </li><li>æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰</li><li>é…ç½®ç®¡ç†å™¨</li><li>çº¿ç¨‹æ± </li><li>ç¼“å­˜æœåŠ¡</li></ul><p>è¿™äº›å¯¹è±¡åªéœ€è¦ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºé€ æˆèµ„æºæµªè´¹æˆ–çŠ¶æ€ä¸ä¸€è‡´ã€‚</p><h1 id="å•ä¾‹æ¨¡å¼çš„ç‰¹ç‚¹ğŸ¥±"><a href="#å•ä¾‹æ¨¡å¼çš„ç‰¹ç‚¹ğŸ¥±" class="headerlink" title="å•ä¾‹æ¨¡å¼çš„ç‰¹ç‚¹ğŸ¥±"></a>å•ä¾‹æ¨¡å¼çš„ç‰¹ç‚¹ğŸ¥±</h1><ol><li><strong>ç§æœ‰æ„é€ å‡½æ•°</strong>ï¼šé˜²æ­¢å¤–éƒ¨é€šè¿‡ <code>new</code> åˆ›å»ºå®ä¾‹ã€‚</li><li><strong>é™æ€ç§æœ‰å®ä¾‹</strong>ï¼šç±»å†…éƒ¨ç»´æŠ¤å”¯ä¸€çš„å®ä¾‹ã€‚</li><li><strong>å…¬å¼€çš„é™æ€æ–¹æ³•</strong>ï¼šç”¨äºè¿”å›å”¯ä¸€å®ä¾‹ã€‚</li></ol><p>å•ä¾‹æ¨¡å¼åˆ›å»ºåˆ†ä¸ºé¥¿æ±‰å¼å’Œæ‡’æ±‰å¼ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€ä¸€è§£æ</p><h1 id="é¥¿æ±‰å¼ğŸ˜ˆ"><a href="#é¥¿æ±‰å¼ğŸ˜ˆ" class="headerlink" title="é¥¿æ±‰å¼ğŸ˜ˆ"></a>é¥¿æ±‰å¼ğŸ˜ˆ</h1><p>ä¸ºä»€ä¹ˆå«é¥¿æ±‰å¼å‘¢ï¼Ÿå› ä¸º<strong>ç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»ºã€‚</strong></p><p>é‚£ç±»åŠ è½½åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨ Java ä¸­ï¼Œ<strong>ç±»åŠ è½½</strong> æ˜¯æŒ‡å°† <code>.class</code> æ–‡ä»¶ï¼ˆå­—èŠ‚ç æ–‡ä»¶ï¼‰åŠ è½½åˆ° JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰ä¸­ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºä¸€ä¸ª <code>java.lang.Class</code> å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”± <strong>ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰</strong> å®Œæˆçš„ã€‚</p><p>ä½†æ˜¯JVMä¸ä¼šåœ¨ä¸€å¼€å§‹å°±åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æŸä¸ªç±»ç¬¬ä¸€æ¬¡è¢«ä¸»åŠ¨ä½¿ç”¨æ—¶æ‰ä¼šè§¦å‘ç±»åŠ è½½ã€‚ä¾‹å¦‚ï¼š</p><ul><li>åˆ›å»ºç±»çš„å®ä¾‹ï¼ˆ<code>new</code>ï¼‰</li><li>è®¿é—®ç±»çš„é™æ€å˜é‡æˆ–è°ƒç”¨é™æ€æ–¹æ³•</li><li>ä½¿ç”¨å­ç±»æ—¶ä¼šå…ˆåŠ è½½çˆ¶ç±»</li><li>å¯åŠ¨ç±»ï¼ˆmain æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼‰</li></ul><p>è¿˜æœ‰ä¸€äº›è¢«åŠ¨å¼•ç”¨çš„æƒ…å†µä¸ä¼šè§¦å‘ç±»åŠ è½½ï¼Œæ¯”å¦‚è®¿é—®é™æ€å¸¸é‡ï¼ˆç¼–è¯‘æœŸç¡®å®šçš„ final static å¸¸é‡ï¼‰ï¼Œå°±ä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ã€‚</p><p>ä¸‹é¢è®²è®²é¥¿æ±‰å¼æ€ä¹ˆåˆ›å»ºå•ä¾‹ï¼š</p><h2 id="æ–¹æ³•ä¸€ï¼šé™æ€æˆå‘˜å˜é‡æ–¹å¼è·å–å¯¹è±¡"><a href="#æ–¹æ³•ä¸€ï¼šé™æ€æˆå‘˜å˜é‡æ–¹å¼è·å–å¯¹è±¡" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé™æ€æˆå‘˜å˜é‡æ–¹å¼è·å–å¯¹è±¡"></a>æ–¹æ³•ä¸€ï¼šé™æ€æˆå‘˜å˜é‡æ–¹å¼è·å–å¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>&#123;<br>    <span class="hljs-comment">//1. ç§æœ‰æ— å‚æ„é€ æ–¹æ³•</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span>&#123;&#125;<br>    <br>    <span class="hljs-comment">//2. åˆ›å»ºå¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>    <br>    <span class="hljs-comment">//3. å‘å¤–æä¾›å…¬å…±æ–¹æ³•ï¼Œå¯ä»¥è·å–å•ä¾‹å¯¹è±¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•äºŒï¼šé™æ€ä»£ç å—åˆ›å»º"><a href="#æ–¹æ³•äºŒï¼šé™æ€ä»£ç å—åˆ›å»º" class="headerlink" title="æ–¹æ³•äºŒï¼šé™æ€ä»£ç å—åˆ›å»º"></a>æ–¹æ³•äºŒï¼šé™æ€ä»£ç å—åˆ›å»º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>&#123;<br>    <span class="hljs-comment">//1. ç§æœ‰æ— å‚æ„é€ æ–¹æ³•</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span>&#123;&#125;<br>    <br>    <span class="hljs-comment">//2. åˆ›å»ºå¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;<br>    <br>    <span class="hljs-comment">//3. é™æ€ä»£ç å—è¿›è¡Œèµ‹å€¼</span><br>    <span class="hljs-keyword">static</span>&#123;<br>        instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>    &#125;<br>    <br>    <span class="hljs-comment">//4. å‘å¤–æä¾›å…¬å…±æ–¹æ³•ï¼Œå¯ä»¥è·å–å•ä¾‹å¯¹è±¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•ä¸‰ï¼šæšä¸¾"><a href="#æ–¹æ³•ä¸‰ï¼šæšä¸¾" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šæšä¸¾"></a>æ–¹æ³•ä¸‰ï¼šæšä¸¾</h2><p>æšä¸¾ç±»å‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”åªä¼šè£…è½½ä¸€æ¬¡ã€‚æšä¸¾æ˜¯å•ä¾‹å®ç°ä¸­å”¯ä¸€ä¸€ç§ä¸ä¼šè¢«ç ´åçš„å•ä¾‹å®ç°æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton</span>&#123;<br>    INSTANCE;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ‡’æ±‰å¼ğŸ¥±"><a href="#æ‡’æ±‰å¼ğŸ¥±" class="headerlink" title="æ‡’æ±‰å¼ğŸ¥±"></a>æ‡’æ±‰å¼ğŸ¥±</h1><p>æ‡’æ±‰å¼ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ï¼Œæ„æ€å°±æ˜¯éœ€è¦åˆ›å»ºçš„æ—¶å€™å†åˆ›å»ºã€‚ç±»åŠ è½½å¹¶ä¸ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>&#123;<br>    <span class="hljs-comment">//1. ç§æœ‰æ— å‚æ„é€ æ–¹æ³•</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span>&#123;&#125;<br>    <br>    <span class="hljs-comment">//2. åˆ›å»ºå¯¹è±¡,ä½¿ç”¨volatileå…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’åºä¸ä¿è¯å˜é‡å¯è§æ€§</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;<br>    <br>    <span class="hljs-comment">//3. å‘å¤–æä¾›å…¬å…±æ–¹æ³•ï¼Œå¯ä»¥è·å–å•ä¾‹å¯¹è±¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">//synchronizedå…³é”®å­—ä¿®é¥°ä»£ç å—ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå•ä¾‹å¯¹è±¡</span><br>            <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™å°±æ˜¯å•ä¾‹æ¨¡å¼çš„è§£æï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§ã€‚</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£è´£ä»»é“¾æ¨¡å¼</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>è¿™æ˜¯è®¾è®¡æ¨¡å¼ä¸“æ çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œåœ¨è¿™ä¸ªä¸“æ é‡Œé¢ä¼šè®²åˆ°æˆ‘ä»¬åœ¨å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä¼šç”¨å¿ƒå°†å®ƒä»¬è§£æï¼Œç„¶åè®²ç»™ä½ ä»¬å¬ï¼Œå¦‚æœæ„Ÿå…´è¶£å¯ä»¥æŒç»­å…³æ³¨è¿™ä¸ªä¸“æ â¤ï¸</p><p>è¿™æ¬¡æˆ‘ä»¬è¦è®²çš„æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼Œè¿™æ˜¯åœ¨å®é™…çš„å¼€å‘ä¸­éå¸¸å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿåˆå¾—è®²åˆ°é‚£ä¸ªéå¸¸ç»å…¸çš„ä¾‹å­äº†ï¼Œä½ æ˜¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œä»Šå¤©ä¸´æ—¶èµ·æ„æƒ³è¦æš‚æ—¶è¿œç¦»ä¸€ä¸‹è¿™ç§æ¯ç‡¥ç”Ÿæ´»ï¼Œå»æ—…æ¸¸æˆ–è€…ä¼‘æ¯ï¼Œäºæ˜¯ä½ åœ¨OAç³»ç»Ÿæèµ·äº†ä¸ƒå¤©çš„å‡æœŸç”³è¯·ï¼Œéœ€è¦æµç¨‹å®¡æ‰¹ã€‚é¦–å…ˆä½ çš„ç»„é•¿ä¼šçœ‹åˆ°è¿™ä¸ªå®¡æ‰¹ï¼Œä½†æ˜¯ä»–æ²¡æœ‰æƒé™å®¡æ‰¹ä¸ƒå¤©çš„å‡æœŸï¼Œåˆåˆ°ä½ çš„Leaderå®¡æ‰¹ï¼Œä½†æ˜¯ä»–ä¹ŸåŒæ ·æ²¡æœ‰è¿™ä¹ˆå¤§çš„æƒé™ï¼Œè¿™ä¸ªå®¡æ‰¹ä¸€ç›´æµè½¬ï¼Œç»ˆäºæµåˆ°äº†æœ‰èƒ½åŠ›å®¡æ‰¹ä¸ƒå¤©å‡æœŸçš„éƒ¨é—¨å¤§ä½¬â€¦.</p><p>è¿™ç§åƒä¸€ä¸ªé“¾å­ä¸€æ ·çš„ï¼Œå…è®¸å¤šä¸ªå¯¹è±¡å¤„ç†è¯·æ±‚ï¼Œè¯·æ±‚ä¼šæ²¿ç€å»ºé€ å¥½çš„é“¾å­å‰è¿›ï¼Œä¸€ç›´è¾¾åˆ°æœ‰èƒ½åŠ›å¤„ç†çš„èŠ‚ç‚¹ï¼Œè¿™ç§å°±æ˜¯è´£ä»»é“¾æ¨¡å¼ã€‚</p><h1 id="è´£ä»»é“¾æ¨¡å¼çš„å®šä¹‰ğŸ˜¯"><a href="#è´£ä»»é“¾æ¨¡å¼çš„å®šä¹‰ğŸ˜¯" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼çš„å®šä¹‰ğŸ˜¯"></a>è´£ä»»é“¾æ¨¡å¼çš„å®šä¹‰ğŸ˜¯</h1><p>ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆè´£ä»»é“¾æ¨¡å¼å®šä¹‰åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰æ˜¯ä¸€ç§<strong>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</strong>ï¼Œå®ƒå…è®¸å¤šä¸ªå¯¹è±¡æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆã€‚è¯·æ±‚æ²¿ç€ä¸€æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ </p><h2 id="è´£ä»»é“¾æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³"><a href="#è´£ä»»é“¾æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³"></a>è´£ä»»é“¾æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³</h2><ul><li><strong>å°†å¤šä¸ªå¤„ç†å™¨è¿æ¥æˆä¸€æ¡é“¾</strong>ã€‚</li><li>è¯·æ±‚ä»é“¾çš„ä¸€ç«¯å‘èµ·ï¼Œæ²¿ç€é“¾ä¼ é€’ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚æˆ–å°†å…¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œåˆ™å°†è¯·æ±‚è½¬å‘ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li></ul><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ol><li><strong>è¯·æ±‚çš„å¤„ç†æœ‰å¤šä¸ªæ­¥éª¤æˆ–æ¡ä»¶</strong>ï¼Œä¾‹å¦‚å®¡æ‰¹æµç¨‹ã€æƒé™æ§åˆ¶ç­‰ã€‚</li><li><strong>è¯·æ±‚çš„å¤„ç†è€…ä¸ç¡®å®šæ˜¯è°</strong>ï¼Œå¸Œæœ›åŠ¨æ€æŒ‡å®šã€‚</li><li><strong>è§£è€¦è¯·æ±‚å‘é€è€…å’Œå¤„ç†è€…</strong>ï¼Œä½¿ç³»ç»Ÿæ›´çµæ´»ã€å¯æ‰©å±•ã€‚</li></ol><h2 id="ç»“æ„ç»„æˆ"><a href="#ç»“æ„ç»„æˆ" class="headerlink" title="ç»“æ„ç»„æˆ"></a>ç»“æ„ç»„æˆ</h2><ul><li><strong>Handlerï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰</strong> ï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œé€šå¸¸åŒ…å«ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†è€…çš„å¼•ç”¨ã€‚</li><li><strong>ConcreteHandlerï¼ˆå…·ä½“å¤„ç†è€…ï¼‰</strong> ï¼šå®ç°å¤„ç†é€»è¾‘ã€‚å¯ä»¥å†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚æˆ–å°†è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…ã€‚</li><li><strong>Clientï¼ˆå®¢æˆ·ç«¯ï¼‰</strong> ï¼šåˆ›å»ºå¤„ç†é“¾å¹¶æäº¤è¯·æ±‚ã€‚</li></ul><h1 id="è´£ä»»é“¾æ¨¡å¼çš„å…·ä½“ä½¿ç”¨ğŸ˜"><a href="#è´£ä»»é“¾æ¨¡å¼çš„å…·ä½“ä½¿ç”¨ğŸ˜" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼çš„å…·ä½“ä½¿ç”¨ğŸ˜"></a>è´£ä»»é“¾æ¨¡å¼çš„å…·ä½“ä½¿ç”¨ğŸ˜</h1><p>ä¸Šé¢çš„å®šä¹‰å¤ªæ¯ç‡¥äº†ï¼Œç›´æ¥æ¥çœ‹æ€ä¹ˆä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å§ï¼Œè¿™é‡Œç¬”è€…é€‰å–äº†è‡ªå·±æœ€ç†Ÿæ‚‰ä¹Ÿæ˜¯è§‰å¾—æœ€å¥½ç”¨çš„å®ç°æ–¹å¼æ¥ç»™å¤§å®¶çœ‹çœ‹ï¼Œå¦‚æœæœ‰ä½¬è§‰å¾—è¿˜æœ‰æ›´å¥½çš„å®ç°æ–¹å¼æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€æˆ–è€…ç§ä¿¡äº¤æµğŸ¤“</p><p>psï¼šç¬”è€…åªå±•ç¤ºæœ€ä¸»è¦çš„éƒ¨åˆ†ï¼Œè¯·å¤§å®¶é›†ä¸­æ³¨æ„åŠ›å…³æ³¨ä¸»è¦éƒ¨åˆ†</p><h2 id="è´£ä»»é“¾è£…è½½æ¥å£"><a href="#è´£ä»»é“¾è£…è½½æ¥å£" class="headerlink" title="è´£ä»»é“¾è£…è½½æ¥å£"></a>è´£ä»»é“¾è£…è½½æ¥å£</h2><p>è¿™é‡Œæ˜¯è´£ä»»é“¾çš„è£…è½½æ¥å£ï¼ŒappendNextè´Ÿè´£æ·»åŠ ä¸‹ä¸€ä¸ªè´£ä»»é“¾èŠ‚ç‚¹ï¼Œnext()è´Ÿè´£è¿”å›è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ILogicChainArmory</span> &#123;<br><br>    ILogicChain <span class="hljs-title function_">appendNext</span><span class="hljs-params">(ILogicChain next)</span>;<br><br>    ILogicChain <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è´£ä»»é“¾æ¥å£"><a href="#è´£ä»»é“¾æ¥å£" class="headerlink" title="è´£ä»»é“¾æ¥å£"></a>è´£ä»»é“¾æ¥å£</h2><p>è¿™ä¸ªè´£ä»»é“¾æ¥å£ï¼Œå°±æ˜¯å¯¹åº”çš„èŠ‚ç‚¹ç±»å‹ï¼Œlogicæ–¹æ³•å°±æ˜¯æ¯ä¸ªå…·ä½“èŠ‚ç‚¹éƒ½è¦å®ç°çš„é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ILogicChain</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ILogicChainArmory</span>&#123;<br>    <br>    DefaultChainFactory.StrategyAwardVO <span class="hljs-title function_">logic</span><span class="hljs-params">(String userId, Long strategyId)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è´£ä»»é“¾æŠ½è±¡ç±»"><a href="#è´£ä»»é“¾æŠ½è±¡ç±»" class="headerlink" title="è´£ä»»é“¾æŠ½è±¡ç±»"></a>è´£ä»»é“¾æŠ½è±¡ç±»</h2><p>ç”±äºILogicChain extends ILogicChainArmoryï¼Œå®ç°å­æ¥å£çš„ç±»ä¹Ÿå¿…é¡»æä¾›è¿™äº›æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</p><p>ä½†æ˜¯å› ä¸ºAbstractLogicChainæ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥å®ç°ä»»æ„ä¸€éƒ¨åˆ†å°±è¡Œäº†ï¼ˆç”šè‡³å¯ä»¥ä¸å®ç°ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å®ç°è´£ä»»é“¾çš„è£…è½½æ–¹æ³•ï¼Œè®©å…·ä½“è´£ä»»é“¾å®ç°èŠ‚ç‚¹ç±»åªéœ€è¦è´Ÿè´£å®ç°å…·ä½“é€»è¾‘logicå°±è¡Œï¼Œä¸éœ€è¦å…³æ³¨å…¶ä»–å¤šä½™å®ç°ï¼ˆè®¾è®¡æ¨¡å¼çš„å„å¸å…¶èŒï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractLogicChain</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ILogicChain</span>&#123;<br><br><br>    <span class="hljs-keyword">private</span> ILogicChain next;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ILogicChain <span class="hljs-title function_">appendNext</span><span class="hljs-params">(ILogicChain next)</span> &#123;<br>        <span class="hljs-built_in">this</span>.next = next;<br>        <span class="hljs-keyword">return</span> next;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ILogicChain <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> next;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="è´£ä»»é“¾å…·ä½“èŠ‚ç‚¹ï¼ˆé»‘åå•èŠ‚ç‚¹ç¤ºä¾‹ï¼‰"><a href="#è´£ä»»é“¾å…·ä½“èŠ‚ç‚¹ï¼ˆé»‘åå•èŠ‚ç‚¹ç¤ºä¾‹ï¼‰" class="headerlink" title="è´£ä»»é“¾å…·ä½“èŠ‚ç‚¹ï¼ˆé»‘åå•èŠ‚ç‚¹ç¤ºä¾‹ï¼‰"></a>è´£ä»»é“¾å…·ä½“èŠ‚ç‚¹ï¼ˆé»‘åå•èŠ‚ç‚¹ç¤ºä¾‹ï¼‰</h2><p>è¿™é‡Œæ˜¯ä¸€ä¸ªè´£ä»»é“¾çš„å…·ä½“èŠ‚ç‚¹ï¼Œç»§æ‰¿äº†ä¸Šé¢çš„æŠ½è±¡ç±»ï¼Œå®ç°å…·ä½“é€»è¾‘å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component(&quot;rule_blacklist&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BackListLogicChain</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractLogicChain</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> IStrategyRepository repository;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> DefaultChainFactory.StrategyAwardVO <span class="hljs-title function_">logic</span><span class="hljs-params">(String userId, Long strategyId)</span> &#123;<br>        <span class="hljs-comment">//è·å¾—å¯¹åº”ç­–ç•¥ï¼Œé»‘åå•çš„ç”¨æˆ·é…ç½®å’Œå¥–å“é…ç½®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ruleValue</span> <span class="hljs-operator">=</span> repository.queryStrategyRuleValue(strategyId, ruleModel());<br><br><br>        String[] splitRuleValue = ruleValue.split(Constants.COLON);<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">awardId</span> <span class="hljs-operator">=</span> Integer.parseInt(splitRuleValue[<span class="hljs-number">0</span>]);<br><br>        String[] userBlackIds = splitRuleValue[<span class="hljs-number">1</span>].split(Constants.SPLIT);<br><br>        <span class="hljs-comment">// é»‘åå•åˆ¤æ–­</span><br>        <span class="hljs-keyword">for</span> (String userBlackId : userBlackIds) &#123;<br>            <span class="hljs-keyword">if</span> (userId.equals(userBlackId)) &#123;<br>                <span class="hljs-keyword">return</span> DefaultChainFactory.StrategyAwardVO.builder()<br>                        .awardId(awardId)<br>                        .logicModel(ruleModel())<br>                        .build();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// è¿‡æ»¤å…¶ä»–è´£ä»»é“¾</span><br>        <span class="hljs-keyword">return</span> next().logic(userId, strategyId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é»˜è®¤èŠ‚ç‚¹"><a href="#é»˜è®¤èŠ‚ç‚¹" class="headerlink" title="é»˜è®¤èŠ‚ç‚¹"></a>é»˜è®¤èŠ‚ç‚¹</h2><p>è¿™æ˜¯ä¸€ä¸ªé»˜è®¤çš„è´£ä»»é“¾èŠ‚ç‚¹ï¼Œä»£è¡¨è¯·æ±‚æœ€ç»ˆä¸€å®šå¯ä»¥å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component(&quot;default&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultLogicChain</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractLogicChain</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">protected</span> IStrategyDispatch strategyDispatch;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> DefaultChainFactory.StrategyAwardVO <span class="hljs-title function_">logic</span><span class="hljs-params">(String userId, Long strategyId)</span> &#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">awardId</span> <span class="hljs-operator">=</span> strategyDispatch.getRandomAwardId(strategyId);<br>        <br>        <span class="hljs-keyword">return</span> DefaultChainFactory.StrategyAwardVO.builder()<br>                .awardId(awardId)<br>                .logicModel(ruleModel())<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è´£ä»»é“¾å·¥å‚"><a href="#è´£ä»»é“¾å·¥å‚" class="headerlink" title="è´£ä»»é“¾å·¥å‚"></a>è´£ä»»é“¾å·¥å‚</h2><p>è¿™é‡Œæ˜¯è´£ä»»é“¾å·¥å‚ï¼Œè´Ÿè´£è£…è½½è´£ä»»é“¾ã€‚é€šè¿‡Springçš„ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°æ‰€æœ‰å®ç°äº†ILogicChainçš„å…·ä½“å®ç°ç±»ï¼Œé€šè¿‡ä¸€ä¸ªmapç±»å‹æ¥æ‰¿è½½ï¼ˆåªæœ‰æ‰“ä¸Šæ³¨è§£<code>@Component</code>çš„å…·ä½“èŠ‚ç‚¹å®ç°ç±»æ‰å¯ä»¥è¢«Springçš„beanå®¹å™¨ç®¡ç†ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultChainFactory</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, ILogicChain&gt; logicChainGroup;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IStrategyRepository repository;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultChainFactory</span><span class="hljs-params">(Map&lt;String, ILogicChain&gt; logicChainGroup, IStrategyRepository repository)</span> &#123;<br>        <span class="hljs-built_in">this</span>.logicChainGroup = logicChainGroup;<br>        <span class="hljs-built_in">this</span>.repository = repository;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ILogicChain <span class="hljs-title function_">openLogicChain</span><span class="hljs-params">(Long strategyId)</span> &#123;<br>        <span class="hljs-type">StrategyEntity</span> <span class="hljs-variable">strategy</span> <span class="hljs-operator">=</span> repository.queryStrategyEntityByStrategyId(strategyId);<br>        <span class="hljs-comment">//è·å¾—è¯¥ç­–ç•¥å¯¹åº”çš„ruleModels</span><br>        String[] ruleModels = strategy.ruleModels();<br><br>        <span class="hljs-comment">// å¦‚æœæœªé…ç½®ç­–ç•¥è§„åˆ™ï¼Œåˆ™åªè£…å¡«ä¸€ä¸ªé»˜è®¤è´£ä»»é“¾</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == ruleModels || <span class="hljs-number">0</span> == ruleModels.length) <span class="hljs-keyword">return</span> logicChainGroup.get(<span class="hljs-string">&quot;default&quot;</span>);<br><br>        <span class="hljs-comment">// æŒ‰ç…§é…ç½®é¡ºåºè£…å¡«ç”¨æˆ·é…ç½®çš„è´£ä»»é“¾</span><br>        <span class="hljs-type">ILogicChain</span> <span class="hljs-variable">logicChain</span> <span class="hljs-operator">=</span> logicChainGroup.get(ruleModels[<span class="hljs-number">0</span>]);<br>        <span class="hljs-type">ILogicChain</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> logicChain;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; ruleModels.length; i++) &#123;<br>            <span class="hljs-type">ILogicChain</span> <span class="hljs-variable">nextChain</span> <span class="hljs-operator">=</span> logicChainGroup.get(ruleModels[i]);<br>            current = current.appendNext(nextChain);<br>        &#125;<br><br>        <span class="hljs-comment">// è´£ä»»é“¾çš„æœ€åè£…å¡«é»˜è®¤è´£ä»»é“¾</span><br>        current.appendNext(logicChainGroup.get(<span class="hljs-string">&quot;default&quot;</span>));<br><br>        <span class="hljs-keyword">return</span> logicChain;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æµ‹è¯•ä½¿ç”¨ğŸ˜ˆ"><a href="#æµ‹è¯•ä½¿ç”¨ğŸ˜ˆ" class="headerlink" title="æµ‹è¯•ä½¿ç”¨ğŸ˜ˆ"></a>æµ‹è¯•ä½¿ç”¨ğŸ˜ˆ</h1><p>é€šè¿‡openLogicChainæˆ‘ä»¬å°±å¯ä»¥è·å¾—è´£ä»»é“¾çš„å¤´èŠ‚ç‚¹ï¼Œè¯·æ±‚æ”¾è¿›å»å°±å¯ä»¥åœ¨é‡Œé¢æµè½¬ï¼Œæœ€ç»ˆä¸€å®šä¼šè¢«å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test_LogicChain_rule_blacklist</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">ILogicChain</span> <span class="hljs-variable">logicChain</span> <span class="hljs-operator">=</span> defaultChainFactory.openLogicChain(<span class="hljs-number">100001L</span>);<br>    DefaultChainFactory.<span class="hljs-type">StrategyAwardVO</span> <span class="hljs-variable">awardId</span> <span class="hljs-operator">=</span> logicChain.logic(<span class="hljs-string">&quot;user001&quot;</span>, <span class="hljs-number">100001L</span>);<br>    log.info(<span class="hljs-string">&quot;æµ‹è¯•ç»“æœï¼š&#123;&#125;&quot;</span>, awardId);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™å°±æ˜¯è´£ä»»é“¾æ¨¡å¼çš„è§£æï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§ã€‚</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç«™å¼äº†è§£CDN</title>
    <link href="/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3CDN/"/>
    <url>/2025/06/22/%E4%B8%80%E7%AB%99%E5%BC%8F%E4%BA%86%E8%A7%A3CDN/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨æ‰‹æœºç”µè„‘éƒ½è¦è®¿é—®é™æ€èµ„æºï¼Œå¦‚å›¾ç‰‡ã€CSSæ–‡ä»¶å’ŒJavaScriptæ–‡ä»¶ç­‰ï¼Œå¦‚æœæ¯ä¸€ä¸ªé™æ€èµ„æºçš„è¯·æ±‚éƒ½éœ€è¦åˆ°è¾¾æœåŠ¡å™¨ï¼Œé‚£åŠ¿å¿…ä¼šåŠ é‡æœåŠ¡å™¨çš„å‹åŠ›ï¼Œé‚£æœ‰ä»€ä¹ˆæ–¹æ³•è§£å†³å‘¢ï¼Ÿæœ‰çš„ï¼Œå…„å¼Ÿï¼Œé‚£å°±æ˜¯ä»Šå¤©è¦è®²çš„CDNã€‚</p><h1 id="CDNæ˜¯ä»€ä¹ˆï¼ŸğŸ˜¯"><a href="#CDNæ˜¯ä»€ä¹ˆï¼ŸğŸ˜¯" class="headerlink" title="CDNæ˜¯ä»€ä¹ˆï¼ŸğŸ˜¯"></a>CDNæ˜¯ä»€ä¹ˆï¼ŸğŸ˜¯</h1><p>CDNï¼Œå…¨ç§°Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡äº’è”ç½‘åè®®ï¼ˆInternet Protocolï¼‰å°†ç½‘ç«™å†…å®¹åˆ†å‘è‡³å…¨çƒå¤šä¸ªåœ°ç†ä½ç½®ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯æé«˜ç”¨æˆ·è®¿é—®ç½‘ç«™çš„é€Ÿåº¦å’Œæ€§èƒ½ï¼ŒåŒæ—¶æé«˜å†…å®¹çš„å¯ç”¨æ€§å’Œå¯é æ€§ã€‚</p><ol><li><strong>èŠ‚ç‚¹ï¼ˆPoP - Point of Presenceï¼‰</strong> ï¼šæŒ‡çš„æ˜¯CDNæä¾›å•†åœ¨å…¨çƒå„åœ°è®¾ç«‹çš„æ•°æ®ä¸­å¿ƒæˆ–æœåŠ¡å™¨ä½ç½®ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨æœ‰æºç«™çš„éƒ¨åˆ†æˆ–å…¨éƒ¨å†…å®¹å‰¯æœ¬ã€‚</li><li><strong>ç¼“å­˜ï¼ˆCachingï¼‰</strong> ï¼šä¸ºäº†åŠ é€Ÿå†…å®¹ä¼ é€’é€Ÿåº¦ï¼ŒCDNä¼šå°†ç”¨æˆ·çš„è¯·æ±‚æŒ‡å‘æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œå¹¶ä»è¯¥èŠ‚ç‚¹æä¾›å†…å®¹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½ä»æºç«™è·å–ã€‚è¿™éœ€è¦åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šå¯¹é™æ€èµ„æºè¿›è¡Œç¼“å­˜ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰</strong> ï¼šé€šè¿‡æ™ºèƒ½ç®—æ³•å°†æµé‡åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œç¡®ä¿æ²¡æœ‰å•ä¸ªæœåŠ¡å™¨è¿‡è½½ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</li><li><strong>å›æºï¼ˆOrigin Pullï¼‰</strong> ï¼šå½“CDNèŠ‚ç‚¹æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„å†…å®¹æ—¶ï¼Œä¼šå‘æºç«™å‘èµ·è¯·æ±‚ï¼Œå°†å†…å®¹æ‹‰å–åˆ°æœ¬åœ°å¹¶æä¾›ç»™ç”¨æˆ·ï¼ŒåŒæ—¶ç¼“å­˜ä¸€ä»½ä»¥å¤‡åç»­ä½¿ç”¨ã€‚</li><li><strong>è¾¹ç¼˜è®¡ç®—ï¼ˆEdge Computingï¼‰</strong> ï¼šéšç€æŠ€æœ¯çš„å‘å±•ï¼ŒCDNä¸ä»…é™äºå†…å®¹åˆ†å‘ï¼Œè¿˜æ¶‰åŠåˆ°åœ¨é è¿‘ç”¨æˆ·çš„ç½‘ç»œè¾¹ç¼˜æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œä»¥å‡å°‘å»¶è¿Ÿã€æé«˜æ•ˆç‡ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šCDNä¹Ÿèƒ½æä¾›é¢å¤–çš„å®‰å…¨å±‚ï¼Œæ¯”å¦‚DDoSæ”»å‡»é˜²æŠ¤ã€SSLåŠ å¯†ç­‰ï¼Œä¿æŠ¤æºç«™å…å—æ¶æ„æ”»å‡»ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨CDNï¼Œå¯ä»¥æ˜¾è‘—æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›æ‹¥æœ‰å…¨çƒç”¨æˆ·åŸºç¡€çš„ç½‘ç«™å’ŒæœåŠ¡æ¥è¯´ï¼Œèƒ½å¤Ÿæå¤§åœ°å‡å°‘åŠ è½½æ—¶é—´ï¼Œæå‡æ•´ä½“æ€§èƒ½</p><h1 id="ä½¿ç”¨CDNçš„å¥½å¤„æ˜¯ä»€ä¹ˆğŸ¥±"><a href="#ä½¿ç”¨CDNçš„å¥½å¤„æ˜¯ä»€ä¹ˆğŸ¥±" class="headerlink" title="ä½¿ç”¨CDNçš„å¥½å¤„æ˜¯ä»€ä¹ˆğŸ¥±"></a>ä½¿ç”¨CDNçš„å¥½å¤„æ˜¯ä»€ä¹ˆğŸ¥±</h1><p>ä½¿ç”¨CDNä¸»è¦æ˜¯ä¸ºäº†é€šè¿‡å°†é™æ€èµ„æºå¦‚å›¾ç‰‡ã€CSSæ–‡ä»¶å’ŒJavaScriptæ–‡ä»¶ç­‰åˆ†å¸ƒå­˜å‚¨åœ¨å…¨çƒå„åœ°çš„æœåŠ¡å™¨ä¸Šï¼ŒCDNä½¿å¾—è¿™äº›èµ„æºæ›´æ¥è¿‘æœ€ç»ˆç”¨æˆ·ï¼Œä»è€Œå‡å°‘æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p><p>è¿˜æœ‰ä»¥ä¸‹çš„å¥½å¤„ï¼š</p><ol><li><strong>å‡å°‘å»¶è¿Ÿ</strong>ï¼šç”±äºé™æ€èµ„æºä»åœ°ç†ä½ç½®ä¸Šæ›´æ¥è¿‘ç”¨æˆ·çš„æœåŠ¡å™¨è·å–ï¼Œæ•°æ®ä¼ è¾“çš„è·ç¦»ç¼©çŸ­ï¼Œå› æ­¤å¯ä»¥æ˜¾è‘—å‡å°‘è¯·æ±‚å“åº”æ—¶é—´ï¼Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦ã€‚</li><li><strong>é™ä½æºæœåŠ¡å™¨è´Ÿè½½</strong>ï¼šå½“ç”¨æˆ·è¯·æ±‚é™æ€èµ„æºæ—¶ï¼Œå¯ä»¥ç›´æ¥ä»æœ€è¿‘çš„CDNèŠ‚ç‚¹è·å–ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½è®¿é—®æºæœåŠ¡å™¨ã€‚è¿™å‡å°‘äº†ç›´æ¥å¯¹æºæœåŠ¡å™¨çš„è¯·æ±‚æ•°é‡ï¼Œä»è€Œå‡è½»äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå¹¶é™ä½äº†å¸¦å®½æˆæœ¬ã€‚</li><li><strong>æé«˜å¯ç”¨æ€§å’Œå†—ä½™æ€§</strong>ï¼šCDNé€šå¸¸ç”±åˆ†å¸ƒåœ¨ä¸åŒåœ°ç†ä½ç½®çš„å¤šä¸ªæœåŠ¡å™¨ç»„æˆã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå…¶ä»–èŠ‚ç‚¹ä»ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œç¡®ä¿äº†é«˜å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚</li><li><strong>å¢å¼ºå®‰å…¨æ€§</strong>ï¼šè®¸å¤šCDNæœåŠ¡è¿˜æä¾›é¢å¤–çš„å®‰å…¨åŠŸèƒ½ï¼Œæ¯”å¦‚DDoSæ”»å‡»é˜²æŠ¤ã€SSL&#x2F;TLSåŠ å¯†ç­‰ï¼Œæœ‰åŠ©äºä¿æŠ¤ç½‘ç«™å…å—æ¶æ„æ”»å‡»ï¼ŒåŒæ—¶ä¿æŠ¤æ•æ„Ÿæ•°æ®çš„å®‰å…¨ã€‚</li><li><strong>æ”¹å–„ç”¨æˆ·ä½“éªŒ</strong>ï¼šæ›´å¿«çš„å†…å®¹åŠ è½½é€Ÿåº¦æ„å‘³ç€æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè¿™å¯¹äºä¿æŒè®¿å®¢çš„æ»¡æ„åº¦å’Œå‚ä¸åº¦è‡³å…³é‡è¦ã€‚</li></ol><h1 id="CDN-Nginx-ğŸ˜µ"><a href="#CDN-Nginx-ğŸ˜µ" class="headerlink" title="CDN &amp; Nginx ğŸ˜µ"></a>CDN &amp; Nginx ğŸ˜µ</h1><p>é‚£ä¹ˆæˆ‘ä»¬è¯´äº†CDNæœ‰ç›´æ¥ç»™ç”¨æˆ·æ´¾å‘é™æ€èµ„æºçš„ä½œç”¨ï¼Œé‚£ä¹ˆNginxä¹Ÿæœ‰ç›´æ¥è¿”å›é™æ€èµ„æºç»™ç”¨æˆ·çš„ä½œç”¨å‘€ï¼Œé‚£ä¹ˆä¸¤è€…ä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>Nginxä¾§é‡ä¸ºæœåŠ¡å™¨æä¾›é™æ€èµ„æºçš„ç¼“å­˜ï¼Œå½“è¯·æ±‚æ¥åˆ™å¯ä»¥ç›´æ¥è¿”å›ï¼Œè€ŒCDNåˆ™ä¾§é‡å…¨çƒèŒƒå›´æä¾›é™æ€èµ„æºï¼Œå‡å°‘Nginxå’Œæºç«™çš„å‹åŠ›</p><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><ul><li><strong>é™æ€èµ„æºæœåŠ¡</strong>ï¼šNginxå¯ä»¥é«˜æ•ˆåœ°ç›´æ¥æä¾›é™æ€èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€CSSã€JSæ–‡ä»¶ç­‰ï¼‰ï¼Œå®ƒå¯ä»¥ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–è¿™äº›èµ„æºï¼Œå¹¶è¿…é€Ÿå“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚è¿™ä½¿å¾—Nginxéå¸¸é€‚åˆç”¨ä½œå‰ç«¯WebæœåŠ¡å™¨ã€‚</li><li><strong>ç¼“å­˜åŠŸèƒ½</strong>ï¼šè™½ç„¶Nginxæœ¬èº«ä¸»è¦ä¸æ˜¯ä½œä¸ºç¼“å­˜è§£å†³æ–¹æ¡ˆè®¾è®¡çš„ï¼Œä½†å®ƒç¡®å®æ”¯æŒé…ç½®ç¼“å­˜æœºåˆ¶æ¥å­˜å‚¨åç«¯æœåŠ¡å™¨çš„å“åº”ç»“æœï¼ˆåŒ…æ‹¬åŠ¨æ€å†…å®¹ï¼‰ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥å‡å°‘å¯¹åç«¯æœåŠ¡å™¨çš„è¯·æ±‚æ¬¡æ•°ï¼Œæé«˜å“åº”é€Ÿåº¦å¹¶å‡è½»åç«¯æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</li><li><strong>çµæ´»æ€§å’Œæ§åˆ¶</strong>ï¼šNginxæä¾›äº†å¼ºå¤§çš„é…ç½®é€‰é¡¹ï¼Œå…è®¸ä½ ç²¾ç»†åœ°æ§åˆ¶å¦‚ä½•å¤„ç†è¯·æ±‚ã€ç®¡ç†ä¼šè¯ã€è®¾ç½®å“åº”å¤´ç­‰ï¼Œé€‚ç”¨äºéœ€è¦é«˜åº¦å®šåˆ¶åŒ–éœ€æ±‚çš„åœºæ™¯ã€‚</li></ul><h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><ul><li><strong>å…¨çƒåˆ†å‘</strong>ï¼šCDNçš„ä¸»è¦ä½œç”¨æ˜¯å°†é™æ€èµ„æºåˆ†å¸ƒåˆ°å…¨çƒå„åœ°çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·æ— è®ºç”¨æˆ·ä½äºä¸–ç•Œä½•å¤„ï¼Œéƒ½å¯ä»¥ä»åœ°ç†ä½ç½®æœ€è¿‘çš„èŠ‚ç‚¹å¿«é€Ÿè·å–æ‰€éœ€çš„å†…å®¹ã€‚è¿™ç§æ–¹å¼ä¸ä»…èƒ½å‡å°‘å»¶è¿Ÿï¼Œè¿˜èƒ½æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>å‡å‹æºç«™</strong>ï¼šé€šè¿‡åœ¨è¾¹ç¼˜èŠ‚ç‚¹ç¼“å­˜æºç«™çš„å†…å®¹ï¼ŒCDNå‡å°‘äº†ç›´æ¥è®¿é—®æºç«™çš„éœ€æ±‚ï¼Œä»è€Œé™ä½äº†æºç«™æœåŠ¡å™¨çš„å‹åŠ›ä»¥åŠå¸¦å®½æ¶ˆè€—ã€‚å½“ä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚åˆ°è¾¾CDNèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœè¯¥èµ„æºå·²è¢«ç¼“å­˜ï¼Œåˆ™ç›´æ¥ç”±CDNèŠ‚ç‚¹è¿”å›ç»™ç”¨æˆ·ï¼›å¦‚æœæ²¡æœ‰è¢«ç¼“å­˜ï¼Œåˆ™CDNä¼šå›æºç«™æ‹‰å–èµ„æºå¹¶ç¼“å­˜ä»¥ä¾›åç»­ä½¿ç”¨ã€‚</li><li><strong>å¢å¼ºçš„å¯é æ€§å’Œå®‰å…¨æ€§</strong>ï¼šé™¤äº†åŠ é€Ÿå†…å®¹ä¼ è¾“å¤–ï¼ŒCDNè¿˜æä¾›äº†æ”¹è¿›çš„å¯é æ€§å’Œé¢å¤–çš„å®‰å…¨å±‚ï¼Œæ¯”å¦‚é˜²æ­¢DDoSæ”»å‡»çš„èƒ½åŠ›ã€‚</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><strong>Nginx</strong> æ›´ä¾§é‡äºä½œä¸ºé«˜æ•ˆçš„WebæœåŠ¡å™¨æˆ–åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥å¤„ç†é™æ€èµ„æºè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥é…ç½®ç¼“å­˜ç­–ç•¥å‡è½»åç«¯æœåŠ¡å™¨çš„å‹åŠ›ã€‚</li><li><strong>CDN</strong> åˆ™ä¸“æ³¨äºåœ¨å…¨çƒèŒƒå›´å†…ä¼˜åŒ–é™æ€èµ„æºçš„åˆ†å‘ï¼Œé€šè¿‡åˆ©ç”¨å…¶å¹¿æ³›çš„èŠ‚ç‚¹ç½‘ç»œå‡å°‘å»¶è¿Ÿï¼ŒåŒæ—¶ä¹Ÿèƒ½æœ‰æ•ˆåˆ†æ•£æºç«™çš„è´Ÿè½½å‹åŠ›ã€‚</li></ul><p>ä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼ŒNginxå¯ä»¥ä½œä¸ºæºç«™æœåŠ¡å™¨å¤„ç†åŠ¨æ€è¯·æ±‚å’Œéƒ¨åˆ†é™æ€èµ„æºï¼Œè€ŒCDNåˆ™ç”¨æ¥åŠ é€Ÿé™æ€èµ„æºçš„å…¨çƒåˆ†å‘å’ŒæœåŠ¡ï¼Œä»¥æ­¤è¾¾åˆ°æœ€ä½³çš„æ€§èƒ½å’Œå¯é æ€§</p><h1 id="é™æ€èµ„æºæ˜¯å¦‚ä½•ç¼“å­˜åˆ°CDNèŠ‚ç‚¹çš„ï¼ŸğŸ˜ª"><a href="#é™æ€èµ„æºæ˜¯å¦‚ä½•ç¼“å­˜åˆ°CDNèŠ‚ç‚¹çš„ï¼ŸğŸ˜ª" class="headerlink" title="é™æ€èµ„æºæ˜¯å¦‚ä½•ç¼“å­˜åˆ°CDNèŠ‚ç‚¹çš„ï¼ŸğŸ˜ª"></a>é™æ€èµ„æºæ˜¯å¦‚ä½•ç¼“å­˜åˆ°CDNèŠ‚ç‚¹çš„ï¼ŸğŸ˜ª</h1><p>ä¸€èˆ¬éœ€è¦ç›¸å…³äººå‘˜ä¸»åŠ¨å°†é™æ€èµ„æºå…ˆé¢„çƒ­åˆ°CDNèŠ‚ç‚¹ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¼è‡´ç”¨æˆ·è¯·æ±‚åˆ°æœåŠ¡å™¨ä¸­å–ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨å‹åŠ›ã€‚</p><p>å¦‚æœè®¿é—®CDNèŠ‚ç‚¹ï¼Œå‘ç°æ‰€éœ€çš„é™æ€èµ„æºä¸åœ¨ï¼Œåˆ™éœ€è¦è®¿é—®å¯¹åº”çš„æœåŠ¡å™¨è·å–èµ„æºï¼Œé¡ºä¾¿å†ç»™CDNèŠ‚ç‚¹ç¼“å­˜ä¸Šå¯¹åº”çš„é™æ€èµ„æºï¼Œè¿™å°±æ˜¯å›æº</p><p><a href="https://mermaid-live.nodejs.cn/edit#pako:eNp1kstKw0AUhl8lnHUsuTbJLARt1JWuXJm4CGZ6AZOUmIBauykutFAvtIhFUVwIoogIar37Mk6Sx3CS1EsXzmrO5fv_w8xpwJJnY0BQ8a16lZnXTZehZ8KIexfR1iC5GUS3reR-M3reW2TGxsaZSaOkzyXtVtx6ik7Po-33-LVLrg8Xc24y7dkg-2-fj9d5YYMpGfHRXbRznnz0yNFJrhW_9HODES46vhxF9V8zilIu2RmQ3YPhPDmqZ2NNGanqVT867pD2GelfkG6HPPfI08Nf2yEylSHTv-K530jPdNYzY_w_NbD00Wo2oMAPMQsO9h0rDaGRVk0IqtjBJiB6tXHZCpcDE0y3SbG65S54nvNN-l5YqQIqW8srNArrthVgvWbRH3F-sj52beyXvNANAPFipgGoAauAZKkg8KKoaLzKFQVN5WUW1gBJcoGTNVHiZFURVEHmmyysZ65cQVU0TeYkTuKLCq_IVA7btcDzZ_NdyFai-QWyQ-rg"><img src="https://mermaid.ink/img/pako:eNp1kstKw0AUhl8lnHUsuTbJLARt1JWuXJm4CGZ6AZOUmIBauykutFAvtIhFUVwIoogIar37Mk6Sx3CS1EsXzmrO5fv_w8xpwJJnY0BQ8a16lZnXTZehZ8KIexfR1iC5GUS3reR-M3reW2TGxsaZSaOkzyXtVtx6ik7Po-33-LVLrg8Xc24y7dkg-2-fj9d5YYMpGfHRXbRznnz0yNFJrhW_9HODES46vhxF9V8zilIu2RmQ3YPhPDmqZ2NNGanqVT867pD2GelfkG6HPPfI08Nf2yEylSHTv-K530jPdNYzY_w_NbD00Wo2oMAPMQsO9h0rDaGRVk0IqtjBJiB6tXHZCpcDE0y3SbG65S54nvNN-l5YqQIqW8srNArrthVgvWbRH3F-sj52beyXvNANAPFipgGoAauAZKkg8KKoaLzKFQVN5WUW1gBJcoGTNVHiZFURVEHmmyysZ65cQVU0TeYkTuKLCq_IVA7btcDzZ_NdyFai-QWyQ-rg?type=png"></a></p><p>CDNç¼“å­˜ä¸æ˜¯æ°¸ä¹…æœ‰æ•ˆçš„ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼æ¥è¿›è¡Œæ›´æ–°æˆ–è€…å¤±æ•ˆç¼“å­˜ï¼š</p><ul><li><strong>è‡ªç„¶è¿‡æœŸ</strong>ï¼šæ ¹æ® <code>Cache-Control</code> æˆ– <code>Expires</code> æ—¶é—´è‡ªåŠ¨å¤±æ•ˆ</li><li><strong>ä¸»åŠ¨åˆ·æ–°</strong>ï¼šæ‰‹åŠ¨è°ƒç”¨ CDN æ¥å£æ¸…é™¤ç‰¹å®š URL æˆ–ç›®å½•çš„ç¼“å­˜</li><li><strong>ç‰ˆæœ¬æ§åˆ¶æ›´æ–°</strong>ï¼šä¿®æ”¹æ–‡ä»¶åæˆ–æ·»åŠ ç‰ˆæœ¬å·ï¼ˆå¦‚ <code>style-v2.css</code>ï¼‰ï¼Œé¿å…æ—§ç¼“å­˜å½±å“</li></ul><h1 id="CDNå¤šçº§ç¼“å­˜æ¶æ„ğŸ¤“"><a href="#CDNå¤šçº§ç¼“å­˜æ¶æ„ğŸ¤“" class="headerlink" title="CDNå¤šçº§ç¼“å­˜æ¶æ„ğŸ¤“"></a>CDNå¤šçº§ç¼“å­˜æ¶æ„ğŸ¤“</h1><p>ä¸€äº›å¤§å‹ CDN è¿˜æœ‰ <strong>å¤šçº§ç¼“å­˜æ¶æ„</strong>ï¼š</p><ul><li><strong>è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆEdge Nodeï¼‰</strong> ï¼šæœ€é è¿‘ç”¨æˆ·çš„èŠ‚ç‚¹ï¼Œç¼“å­˜çƒ­é—¨èµ„æº</li><li><strong>ä¸­é—´èŠ‚ç‚¹ï¼ˆMid-Tier Nodeï¼‰</strong> ï¼šåŒºåŸŸä¸­å¿ƒèŠ‚ç‚¹ï¼Œç”¨äºé›†ä¸­ç¼“å­˜éçƒ­é—¨ä½†å¸¸ç”¨èµ„æº</li><li><strong>æºç«™ï¼ˆOrigin Serverï¼‰</strong> ï¼šæœ€ç»ˆæ•°æ®æ¥æº</li></ul><p>è¿™æ ·è®¾è®¡å¯ä»¥å‡å°‘å›æºæ¬¡æ•°ï¼Œæé«˜æ•´ä½“æ•ˆç‡</p><h1 id="å¦‚ä½•å¯»æ‰¾æœ€åˆé€‚çš„CDNèŠ‚ç‚¹ğŸ˜£"><a href="#å¦‚ä½•å¯»æ‰¾æœ€åˆé€‚çš„CDNèŠ‚ç‚¹ğŸ˜£" class="headerlink" title="å¦‚ä½•å¯»æ‰¾æœ€åˆé€‚çš„CDNèŠ‚ç‚¹ğŸ˜£"></a>å¦‚ä½•å¯»æ‰¾æœ€åˆé€‚çš„CDNèŠ‚ç‚¹ğŸ˜£</h1><p><strong>GSLBï¼ˆå…¨å±€è´Ÿè½½å‡è¡¡ï¼‰</strong> èµ·äº†é‡è¦ä½œç”¨ï¼Œç”¨äºæ™ºèƒ½åœ°å°†ç”¨æˆ·è¯·æ±‚å¯¼å‘åˆ°æœ€ä¼˜çš„ CDN èŠ‚ç‚¹ã€‚</p><p><strong>GSLB å¦‚ä½•å·¥ä½œï¼Ÿ</strong></p><ol><li><p><strong>DNS æŸ¥è¯¢è§£æ</strong></p><ul><li>å½“ç”¨æˆ·å°è¯•è®¿é—®ä¸€ä¸ªä½¿ç”¨äº† CDN çš„ç½‘ç«™æ—¶ï¼Œé¦–å…ˆä¼šå‘èµ· DNS æŸ¥è¯¢æ¥è§£æåŸŸåå¯¹åº”çš„ IP åœ°å€ã€‚</li><li>è¿™ä¸ªæŸ¥è¯¢ä¼šè¢«å¯¼å‘åˆ°æ”¯æŒ GSLB çš„ DNS æœåŠ¡å™¨ã€‚</li></ul></li><li><p><strong>åŸºäºç­–ç•¥çš„è·¯ç”±</strong></p><ul><li><strong>åœ°ç†ä½ç½®</strong>ï¼šGSLB ç³»ç»Ÿé€šå¸¸ä¼šæ ¹æ®å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·çš„åœ°ç†ä½ç½®æ¥é€‰æ‹©æœ€è¿‘çš„ CDN èŠ‚ç‚¹ã€‚è¿™æ¶‰åŠåˆ°ä½¿ç”¨æ•°æ®åº“æˆ–æœåŠ¡æ¥ç¡®å®šç”¨æˆ·çš„å¤§æ¦‚ä½ç½®ã€‚</li><li><strong>ç½‘ç»œæ€§èƒ½</strong>ï¼šä¸€äº›é«˜çº§çš„ GSLB å®ç°è¿˜ä¼šè€ƒè™‘å®æ—¶ç½‘ç»œæ¡ä»¶ï¼Œå¦‚å»¶è¿Ÿã€ä¸¢åŒ…ç‡ç­‰ï¼Œä»¥é€‰æ‹©æä¾›æœ€ä½³æ€§èƒ½çš„èŠ‚ç‚¹ã€‚</li><li><strong>è´Ÿè½½æƒ…å†µ</strong>ï¼šGSLB å¯ä»¥ç›‘æ§å„ä¸ª CDN èŠ‚ç‚¹çš„å½“å‰è´Ÿè½½ï¼Œå¹¶å°†æµé‡åˆ†é…ç»™è´Ÿè½½è¾ƒä½çš„èŠ‚ç‚¹ï¼Œç¡®ä¿èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨å’Œå“åº”æ—¶é—´çš„ä¼˜åŒ–ã€‚</li><li><strong>å¥åº·æ£€æŸ¥</strong>ï¼šæŒç»­ç›‘æµ‹å„èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼Œè‡ªåŠ¨é¿å¼€æ•…éšœæˆ–è¡¨ç°ä¸ä½³çš„èŠ‚ç‚¹ã€‚</li></ul></li><li><p><strong>åŠ¨æ€è°ƒæ•´</strong></p><ul><li>åŸºäºä¸Šè¿°å› ç´ ï¼ŒGSLB ç³»ç»Ÿèƒ½å¤ŸåŠ¨æ€è°ƒæ•´å…¶è·¯ç”±å†³ç­–ï¼Œå³ä½¿åœ¨ç½‘ç»œçŠ¶å†µå˜åŒ–æˆ–è€…æŸäº›èŠ‚ç‚¹å‡ºç°æ•…éšœçš„æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿è¯ç”¨æˆ·è¢«å¼•å¯¼è‡³æœ€ä½³çš„æœåŠ¡èŠ‚ç‚¹ã€‚</li></ul></li></ol><p>ç„¶åGSIBå°†æœ€åˆé€‚çš„CDNèŠ‚ç‚¹IPåœ°å€å‘å›ç»™æµè§ˆå™¨ï¼Œè®©ä»–å»è®¿é—®ã€‚</p><h1 id="æ€»ç»“â¤ï¸"><a href="#æ€»ç»“â¤ï¸" class="headerlink" title="æ€»ç»“â¤ï¸"></a>æ€»ç»“â¤ï¸</h1><p>è¿™å°±æ˜¯ç›¸å…³CDNçš„è§£æ</p><p>å¦‚æœä½ çœ‹äº†è¿™ç¯‡æ–‡ç« æœ‰æ”¶è·å¯ä»¥ç‚¹èµ+å…³æ³¨+æ”¶è—ğŸ¤©ï¼Œè¿™æ˜¯å¯¹ç¬”è€…æ›´æ–°çš„æœ€å¤§é¼“åŠ±ï¼å¦‚æœä½ æœ‰æ›´å¤šæ–¹æ¡ˆæˆ–è€…æ–‡ç« ä¸­æœ‰é”™æ¼ä¹‹å¤„ï¼Œè¯·åœ¨è¯„è®ºåŒºæå‡ºå¸®åŠ©ç¬”è€…å‹˜è¯¯ï¼Œç¥ä½ æ‹¿åˆ°æ›´å¥½çš„offerï¼</p>]]></content>
    
    
    <categories>
      
      <category>æ¶æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>æ¶æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
